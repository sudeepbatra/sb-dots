"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[7831],{48298:(e,t,s)=>{s.d(t,{kn:()=>p,kj:()=>g,Tr:()=>h});var i=s(58129),r=s(75246),o=s(19889),n=s(50906),a=s(54642),l=s(76464),d=s(9953),u=s(30149),m=s(14133),c=s(98905);const p=async e=>{const{environment:t,store:s,accessRequestStore:i,forActor:r,status:a,from:m}=e,c=t.currentUser.id;if("approved"===a){const e={type:"existingUser",value:r,spaceRole:"read_and_write"};if(!(await l.n_({environment:t,store:s,inviteTargets:[e],inviteRole:"read_and_write",isOnboarding:!1,invite:{inviteOrigin:"membership_request"}})).success)return}u.createAndCommit({userAction:"GrantAccessActivityAction.handleGrantAccess",environment:t,perform:e=>{d.sW({store:i,transaction:e,data:{granted_time:Date.now(),granted_by_table:o.KJ,granted_by_id:c,resolved_time:Date.now(),resolved_by_table:o.KJ,resolved_by_id:c,status:a}})}}),n.trackResolveMembershipRequest(t,{status:a,request_id:i.id,from:m,for_actor_id:r.id,space_role:s.getRole()})};async function g(e){if(c.Z.reset(),!e.canAdmin)return;const{environment:t,spaceId:s}=e,i=await a.getUnreadAccessRequestCount(t,{parentTable:r.bx,parentId:s,size:1});"success"===i.type&&c.Z.setState({spaceId:s,count:i.data.count})}function h(e,t){const s=new Map;for(const r of t){const t=(0,m.Kv)(e,{table:i.J8,id:r}),n=t.getValue();if(!n)continue;if(n.for_actor_table!==o.KJ||n.created_by_table!==o.KJ)continue;const a=(0,m.Kv)(e,{table:n.for_actor_table,id:n.for_actor_id}).getValue();if(!a)continue;const l=(0,m.Kv)(e,{table:n.created_by_table,id:n.created_by_id}).getValue();if(l)if(s.has(n.for_actor_id)){const e=s.get(n.for_actor_id);if(!e)continue;n.created_time>e.latestRequestTime?s.set(n.for_actor_id,{...e,createdByActorsWithReason:[{actor:l,reason:n.message},...e.createdByActorsWithReason],accessRequest:n,accessRequestStore:t,latestRequestTime:n.created_time}):s.set(n.for_actor_id,{...e,createdByActorsWithReason:[...e.createdByActorsWithReason,{actor:l,reason:n.message}]})}else s.set(n.for_actor_id,{forActor:a,createdByActorsWithReason:[{actor:l,reason:n.message}],accessRequest:n,accessRequestStore:t,latestRequestTime:n.created_time})}return Array.from(s.values())}},86125:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(77094),r=s.n(i),o=s(67294),n=s(5366),a=s(74136);function l(e){return o.createElement(a.Z,e,"membership_admin"===e.role?r()(n.FormattedMessage,{id:"spacePermissionsSettings.user.membershipAdmin",defaultMessage:"Membership admin",description:"Label that shows on a user that is a workspace membership admin."}):r()(n.FormattedMessage,{id:"spacePermissionsSettings.user.workspaceOwner",defaultMessage:"Workspace owner",description:"Label that shows on a user that is a workspace owner."}))}},21752:(e,t,s)=>{s.d(t,{K:()=>p,Z:()=>g});var i=s(77094),r=s.n(i),o=s(67294),n=s(19889),a=s(5366),l=s(86125),d=s(22368),u=s(64369),m=s(25383);function c(){return o.createElement(o.Fragment,null,r()(d.B,{}),r()("span",{style:{marginLeft:2,marginRight:2}},void 0," • "))}function p(e){return"membership_admin"===e?"membership_admin":"editor"===e?"admin":"none"===e?"guest":void 0}const g=function(e){const t=(0,a.useIntl)(),{userValue:s,containerStyle:i,id:o,spaceRole:d,avatarBadge:p,isLarge:g}=e,h="guest"===d,b="admin"===d||"membership_admin"===d;return r()("div",{style:{display:"flex",alignItems:"center",maxWidth:g?"unset":300,marginLeft:g?2:0,...i}},void 0,r()("div",{style:{position:"relative",...!g&&{height:28,width:28}}},void 0,r()(m.Z,{userValue:s,size:g?32:28}),p),r()("div",{style:{minWidth:0,marginLeft:g?10:6,marginRight:g?10:6}},void 0,r()("div",{id:o,style:{display:"flex",gap:4}},void 0,r()(u.Z,{className:"notranslate"},void 0,(0,n.Nz)(t,s)),b&&r()(l.Z,{role:d})),r()(u.Z,{isSmall:!0,style:{display:"flex"}},void 0,h&&r()(c,{}),r()(u.Z,{isSmall:!0},void 0,null==s?void 0:s.email))))}},64131:(e,t,s)=>{s.d(t,{Z:()=>U});var i=s(77094),r=s.n(i),o=s(97464),n=s.n(o),a=s(67294),l=s(480),d=s(16489),u=s(24405),m=s(8848),c=s(53397),p=s(70203),g=s(82990),h=s(5366),b=s(50906),f=s(98724),v=s(60709),S=s(98742),y=s(89086),M=s(52689),C=s(63334),w=s(24666),k=s(41216),R=s(47323),T=s(31945),Z=s(56940),I=s(58261),P=s(78140),F=s(32163),B=s(40721),x=s(72495),q=s(58032);const G=a.Fragment;const U=function(e){const{disabled:t,style:s}=e,i=(0,d.qz)(e.ignoreSelectionAreaStore,C.Z),o=(0,l.O7)(),U=(0,h.useIntl)(),_=(0,u.F)(),A=(0,a.useCallback)((()=>{f.aS({environment:o,annotation:["h",M.Z.state.color]}),b.trackRichTextMenuClick(o,{action:"h",color:M.Z.state.color})}),[o]),L=(0,a.useCallback)((e=>{b.trackRichTextMenuClick(o,{action:"h"})}),[o]),D=(0,a.useCallback)((()=>{w.default.emit()}),[]),E=(0,a.useCallback)((e=>{f.mX({environment:o,annotationType:"h"}),"default"!==e&&(M.Z.setHighlightColor(e),A())}),[o,A]),O=(0,a.useCallback)(((e,t,s,i)=>({key:t||e,action:()=>{s(),E(e),i.close()},render:s=>a.createElement(k.Z,n()({},s,{color:e,overrideDisplayName:t}))})),[E]),V=(0,d.VK)((()=>{const e=(0,y.Ld)("h");return e?p.zI(e):"default"}),[]),K=(0,u.y)((e=>({colorIcon:{display:"inline-flex",alignItems:"center",justifyContent:"center",height:18,textAlign:"center",fontSize:15,borderRadius:2,...!o.device.isMobile&&{width:18,fontWeight:g.Z.fontWeight.medium,marginBottom:2},...(0,m.A_)(V,e)}})),[o.device.isMobile,V]);return r()(T.Z,{popupType:o.device.isMobile?T.Z.PopupType.SlideUp:T.Z.PopupType.Popup,originGap:4,onClose:D,onClick:L,renderOrigin:e=>r()(q.Z,{renderTooltip:()=>r()(G,{},void 0,r()("div",{},void 0,r()(h.FormattedMessage,{defaultMessage:"Text color",id:"highlightSelectionButton.textColor.tooltip"})),r()("div",{},void 0,r()(I.Z,{style:{color:_.mediumInvertedTextColor},name:"toggleHighlight"}))),render:i=>a.createElement(R.Z,n()({style:{display:"flex",alignItems:"center",paddingLeft:7,paddingRight:6,whiteSpace:"nowrap",...s},disabled:t,disabledFeedback:t},(0,S.Z)(e,i)),r()("div",{style:K.colorIcon},void 0,o.device.isMobile?r()(h.FormattedMessage,{defaultMessage:"Color",id:"highlightSelectionButton.mobileColorIcon.label"}):"A"),c.Z.chevronDown({width:10,marginLeft:o.device.isMobile?4:3,fill:"dark"===_.mode?m.ZP.white:_.lightIconColor}))}),render:e=>{let t;return t=o.device.isMobile?{menuType:v.o.Modal,title:r()(h.FormattedMessage,{defaultMessage:"Text color",id:"highlightSelectionButton.mobileTextColor.label"}),right:r()(B.CancelMenuText,{}),onClickRight:()=>{e.close()}}:{menuType:v.o.Popup},a.createElement(P.Z,t,r()(Z.Z,{capture:o.device.isMobile,store:i,ignoreBlockSelection:!1,restoreSelection:!0,focusOffscreenInput:!1,render:t=>{const s=m.CY.map((s=>O(s,void 0,t,e))),i=[O("default",U.formatMessage({defaultMessage:"Default background",id:"highlightSelectionButton.defaultBackground.label"}),t,e),...m._K.map((s=>O(s,void 0,t,e)))],o=M.Z.state.color;return r()(F.Z,{type:F.i.Vertical,sections:[{key:0,items:[{key:0,action:()=>{t(),E(o),e.close()},render:e=>a.createElement(k.Z,n()({},e,{color:o,shortcuts:["toggleHighlight"]}))}],render:e=>a.createElement(x.Z,n()({},e,{title:r()(h.FormattedMessage,{defaultMessage:"Last used",id:"highlightSelectionButton.lastUsedSection.label"}),isTitleUppercase:!0}))},{key:1,items:s,render:e=>a.createElement(x.Z,n()({},e,{title:r()(h.FormattedMessage,{defaultMessage:"Color",id:"highlightSelectionButton.colorSection.label"}),isTitleUppercase:!0}))},{key:2,items:i,render:e=>a.createElement(x.Z,n()({},e,{title:r()(h.FormattedMessage,{defaultMessage:"Background",id:"highlightSelectionButton.backgroundSection.label"}),isTitleUppercase:!0}))}],initialFocus:void 0})}}))}})}},82945:(e,t,s)=>{s.d(t,{Z:()=>S});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(83355),d=s(53397),u=s(5366),m=s(50906),c=s(7476),p=s(77505),g=s(24666),h=s(47323),b=s(58261),f=s(58032);class v extends l.Z{constructor(){super(...arguments),this.handleClick=e=>{let t;const s=g.default.state;"empty"!==s.mode&&(t=p.UQ(),c.WD({environment:this.environment,blockStore:this.props.blockStore,multiSelection:s.multiSelection})),m.trackRichTextMenuClick(this.environment,{action:"comment",from:t?"simple_table_cell":void 0})}}renderComponent(){const{device:e}=this.environment,t=e.isMobile;return n()(f.Z,{renderTooltip:()=>n()(a.Fragment,{},void 0,n()("div",{},void 0,n()(u.FormattedMessage,{defaultMessage:"Comment on selected text",id:"inlineCommentButton.tooltip"})),n()("div",{},void 0,n()(b.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"comment"}))),render:e=>a.createElement(h.Z,r()({style:{display:"flex",alignItems:"center",padding:"0 10px",whiteSpace:"nowrap",...this.props.style},disabled:this.props.disabled,disabledFeedback:this.props.disabled,onClick:this.handleClick},e),d.Z.speechBubbleThin({width:t?18:16,height:t?18:16,marginTop:t?0:1,marginRight:4}),!t&&n()(u.FormattedMessage,{defaultMessage:"Comment",id:"inlineCommentButton.commentLabel"}))})}}const S=v},40464:(e,t,s)=>{s.d(t,{Z:()=>v});var i=s(77094),r=s.n(i),o=s(97464),n=s.n(o),a=s(67294),l=s(480),d=s(16489),u=s(24405),m=s(8848),c=s(50906),p=s(98724),g=s(89086),h=s(24666),b=s(47323),f=s(58032);const v=function(e){const{disabled:t,type:s,tooltipLabel:i,children:o,style:v,onClick:S}=e,y=(0,l.O7)(),M=(0,a.useCallback)((e=>{p.aS({environment:y,annotation:[s]}),S&&S(),c.trackRichTextMenuClick(y,{action:s})}),[y,s,S]),C=(0,d.VK)((()=>t||"editing"!==h.default.state.mode),[t]),w=(0,d.VK)((()=>Boolean((0,g.Ld)(s))),[s]),k=(0,u.y)((e=>({button:{display:"flex",alignItems:"center",padding:"0 8px",color:w?m.ZP.blue:e.regularTextColor,...v}})),[w,v]);return r()(f.Z,{renderTooltip:()=>i,render:e=>a.createElement(b.Z,n()({style:k.button,disabled:C,disabledFeedback:C,onClick:M},e),o)})}},32404:(e,t,s)=>{s.d(t,{Z:()=>S});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(83355),d=s(70203),u=s(5366),m=s(36280),c=s(89086),p=s(66949),g=s(24666),h=s(47323),b=s(58261),f=s(58032);class v extends l.Z{constructor(){super(...arguments),this.renderMenuTooltip=()=>{const e=this.getThemeColors();return n()(a.Fragment,{},void 0,n()("div",{},void 0,n()(u.FormattedMessage,{id:"richTextMenu.equationButton.tooltip",defaultMessage:"Create equation"})),n()("div",{},void 0,n()(b.Z,{style:e.keyboardShortcut,name:"openEquationMenu"})))},this.handleButtonPopupClick=e=>{const{onClick:t}=this.props;m.qn({environment:this.environment,analyticsFrom:"rich_text_menu"}),t&&t(e)},this.isSelected=()=>(0,c.Ld)(d.GK.Equation),this.isDisabled=()=>{const{disabled:e}=this.props;if(e)return!0;if("editing"!==g.default.state.mode&&!p.Z.isOpen())return!0;const t={[d.GK.User]:d.GK.User,[d.GK.Page]:d.GK.Page,[d.GK.Comment]:d.GK.Comment,[d.GK.Bot]:d.GK.Bot,[d.GK.Date]:d.GK.Date,[d.GK.ExternalObjectInstance]:d.GK.ExternalObjectInstance,[d.GK.TemporaryPage]:d.GK.TemporaryPage,[d.GK.TemplateVariable]:d.GK.TemplateVariable,[d.GK.FormulaPageProperty]:d.GK.FormulaPageProperty,[d.GK.FormulaUserProperty]:d.GK.FormulaUserProperty,[d.GK.FormulaContextValue]:d.GK.FormulaContextValue};for(const s of Object.values(t))if((0,c.J6)(s))return!0;return!1},this.styles={equationButton:{display:"flex",alignItems:"center",borderRadius:0,paddingLeft:7,paddingRight:8}}}renderComponent(){const{style:e,children:t}=this.props,s=this.getThemeColors(),i=this.isDisabled();return n()(f.Z,{renderTooltip:this.renderMenuTooltip,render:o=>a.createElement(h.Z,r()({style:{...this.styles.equationButton,...s.equationButton,...e},disabled:i,disabledFeedback:i,onClick:this.handleButtonPopupClick},o),t)})}getThemeColors(){return{equationButton:{color:this.isSelected()?this.theme.blueColor:this.theme.regularTextColor},keyboardShortcut:{color:this.theme.mediumInvertedTextColor}}}}const S=(0,u.injectIntl)(v)},73383:(e,t,s)=>{s.d(t,{Z:()=>y});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(83355),d=s(70203),u=s(5366),m=s(50906),c=s(45990),p=s(89086),g=s(23178),h=s(24666),b=s(47323),f=s(58261),v=s(58032);class S extends l.Z{constructor(){super(...arguments),this.handleButtonPopupClick=()=>{c.dz({type:"focusOnly",focus:!0}),m.trackRichTextMenuClick(this.environment,{action:d.GK.Link})}}renderComponent(){const e=(0,p.Ld)(d.GK.Link),t=this.isDisabled();return n()(v.Z,{renderTooltip:()=>n()(a.Fragment,{},void 0,n()("div",{},void 0,n()(u.FormattedMessage,{defaultMessage:"Add link",id:"selectionLinkButton.addLink.tooltip",description:"Prompt for the user to add a URL to link to from the selected text."})),n()("div",{},void 0,n()(f.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"openLinkMenu"}))),render:s=>a.createElement(b.Z,r()({style:{display:"flex",alignItems:"center",borderRadius:0,paddingLeft:7,paddingRight:8,...e&&{color:this.theme.blueColor},whiteSpace:"nowrap",...this.props.style},disabled:t,disabledFeedback:t},s,{onClick:this.handleButtonPopupClick}),this.props.children)})}isDisabled(){return!!this.props.disabled||("editing"!==h.default.state.mode&&!g.Z.state.open||!!((0,p.J6)(d.GK.User)||(0,p.J6)(d.GK.Bot)||(0,p.J6)(d.GK.Date)||(0,p.J6)(d.GK.Page)))}}const y=(0,u.injectIntl)(S)},46721:(e,t,s)=>{s.d(t,{Z:()=>Vt});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(96486),l=s.n(a),d=s(67294),u=s(83355),m=s(31942),c=s(53397),p=s(27006),g=s(75246),h=s(19889),b=s(2438),f=s(97880),v=s(5366),S=s(48298),y=s(50906),M=s(54642),C=s(25186),w=s(47307),k=s(92625),R=s(76464),T=s(29974),Z=s(21325),I=s(30149),P=s(4708),F=s(67669),B=s(33665),x=s(38755),q=s(21115),G=s(8323),U=s(23537),_=s(77907),A=s(27832),L=s(88632),D=s(10161),E=s(14133),O=s(72087),V=s(64404),K=s(92083),N=s(78291),z=s(98905),W=s(12318),H=s(21752),j=s(42922),Q=s(47323),J=s(61519),$=s(74194),Y=s(68785),X=s(63296),ee=s(77137),te=s(72495),se=s(62385),ie=s(24006),re=s(58032),oe=s(64369),ne=s(21202),ae=s(26111),le=s(15010),de=s(84210),ue=s(60709),me=s(61766),ce=s(31945),pe=s(78140),ge=s(28992),he=s(32163),be=s(43765),fe=s(91941),ve=s(11470);const Se=(0,v.defineMessages)({removingGuest:{id:"guestPagesPopup.removeGuest.updatingMessage",defaultMessage:"Updating…"},addingMember:{id:"guestPagesPopup.addMemberPermission.updatingMessage",defaultMessage:"Updating…"}});class ye extends u.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:me.Z},this.renderPopup=()=>{const{device:e}=this.environment,{store:t,guest:s}=this.props,i=t.canEditMembership(),o=s.guestPageIds.map((e=>{const s=E.G.createChildStore(t,{table:ne.iU,id:e});return{key:e,render:e=>d.createElement(ve.Z,r()({},e,{store:s,placeholder:n()(v.FormattedMessage,{id:"guestPagesPopup.privatePagePlaceholder",defaultMessage:"Private page"})})),action:()=>{const s=E.G.createChildStore(t,{table:ne.iU,id:e}),i=(0,de.Z)({store:s,fullyQualified:!1});ae.navigate({environment:this.environment,url:i,metaClick:!0})}}}));let a,l;return a=e.isMobile?{menuType:ue.o.ActionSheet}:{menuType:ue.o.Popup,width:300},(0,q.qF)(this.environment)&&(l=n()(re.Z,{renderTooltip:()=>this.isSubscribed()?n()(v.FormattedMessage,{id:"guestPagesPopup.addMemberPermissionButton.tooltip",defaultMessage:"This guest will become a member of this workspace."}):n()(v.FormattedMessage,{id:"guestPagesPopup.addAdminPermissionButton.tooltip",defaultMessage:"This guest will become an admin of this workspace."}),render:e=>d.createElement(X.Z,r()({isLarge:!0,onClick:this.handleConvertToMemberClick},e),this.isSubscribed()?n()(v.FormattedMessage,{id:"guestPagesPopup.addMemberPermissionButton.label",defaultMessage:"Convert to member"}):n()(v.FormattedMessage,{id:"guestPagesPopup.addAdminPermissionButton.label",defaultMessage:"Convert to admin"}))})),d.createElement(pe.Z,a,i&&n()(ge.Z,{title:n()("div",{style:{paddingTop:12,paddingBottom:8,display:"flex",alignItems:"flex-start"}},void 0,l,n()(re.Z,{renderTooltip:()=>n()(v.FormattedMessage,{id:"guestPagesPopup.removeGuestButton.tooltip",defaultMessage:"This guest will be removed from all pages in this Workspace."}),render:e=>d.createElement(X.Z,r()({isLarge:!0,isRed:!0,style:{marginLeft:l?8:0},onClick:this.handleRemoveClick},e),n()(v.FormattedMessage,{id:"guestPagesPopup.removeGuestButton.label",defaultMessage:"Remove"}))}))}),i&&n()(be.Z,{title:n()(v.FormattedMessage,{id:"guestPagesPopup.guestAccessiblePagesCaption",defaultMessage:"This guest can access these pages"})}),n()(he.Z,{type:he.i.Vertical,initialFocus:0,sections:[{key:"pages",render:e=>d.createElement(te.Z,e),items:o}]}))},this.handleRemoveClick=()=>{w.showDialog({showCancel:!0,keepFocus:!1,message:n()(v.FormattedMessage,{id:"guestPagesPopup.removeGuestModal.confirmationMessage",defaultMessage:"Are you sure you want to remove this person? They will lose access to all shared pages."}),items:[{label:n()(v.FormattedMessage,{id:"guestPagesPopup.removeGuestModal.removeButton.label",defaultMessage:"Remove"}),color:"red",onAccept:async()=>{const{guest:e,store:t}=this.props;this.stores.buttonPopupStore.setState({...this.stores.buttonPopupStore.state,open:!1}),k.j({message:Se.removingGuest});"success"===(await M.removeUsersFromSpace(this.environment,{userIds:[e.userId],spaceId:t.id,removePagePermissions:!0,revokeUserTokens:!1})).type&&(await Z.bi(this.environment),y.trackRemoveGuest(this.environment)),k.x()}}]})},this.handleConvertToMemberClick=async()=>{const{store:e,guest:t,guestStore:s,isSubscribed:i}=this.props,r=i?"read_and_write":"editor",o=[{type:"user_permission",role:r,user_id:t.userId}],{serverCommitResult:n}=I.createAndCommit({userAction:"GuestPagesPopup.handleConvertToMemberClick",environment:this.environment,perform:t=>{R.ep({environment:this.environment,store:e,permissionItems:o,transaction:t,from:"convert_to_member"})}});this.stores.buttonPopupStore.setState({...this.stores.buttonPopupStore.state,open:!1}),k.j({message:Se.addingMember});try{await n,await Z.bi(this.environment),y.trackConvertGuestToMember(this.environment,{member_user_id:t.userId}),y.trackEmailInvite(this.environment,{role:r,is_space:!0,invite_targets:[{type:"existingUser",value:{id:s.id,version:s.getKeyStore("version").getValue()||0,email:s.getEmail()||""},spaceRole:"none"}],is_onboarding:!1,invite_origin:"convert_to_member",permission_items:o,invite_message_length:0,domainType:(0,le.JF)()})}finally{k.x()}}}renderComponent(){const{device:e}=this.environment,{buttonPopupStore:t}=this.stores,{store:s,guest:i}=this.props;return i.guestPageIds.map((e=>{E.G.createChildStore(s,{table:ne.iU,id:e}).load()})),0===i.guestPageIds.length?n()(v.FormattedMessage,{id:"guestPagesPopup.permissionsForUserGuest.label",defaultMessage:"Guest"}):n()(ce.Z,{popupType:e.isMobile?ce.Z.PopupType.SlideUp:ce.Z.PopupType.Popup,renderOrigin:e=>d.createElement(fe.Z,e,n()(v.FormattedMessage,{id:"guestPagesButton.label",defaultMessage:"{numberOfAccessiblePages, plural, one {{numberOfAccessiblePages} page} other {{numberOfAccessiblePages} pages}}",values:{numberOfAccessiblePages:i.guestPageIds.length}}),c.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})),buttonPopupStore:t,render:this.renderPopup})}isSubscribed(){const{data:e}=N.default.state;return Boolean(e&&(0,q.YK)(e))}}const Me=(0,v.injectIntl)(ye);var Ce=s(74523),we=s(42402),ke=s(7567),Re=(s(41817),s(480)),Te=s(16489),Ze=s(24405),Ie=s(5851),Pe=s(53680),Fe=s(93963),Be=s(40235),xe=s(57269),qe=s(2072),Ge=s(82990),Ue=s(29302),_e=s(25383);function Ae(e){const{store:t,request:s}=e,{forActor:i,accessRequestStore:r}=s,o=(0,Re.O7)(),[a,l]=(0,d.useState)(!1),u=(0,Ze.y)((e=>({actionButtons:{display:"flex",alignItems:"center",gap:12},email:{display:"flex",gap:4},requestMetadata:{minWidth:0,marginLeft:6,marginRight:6},tooltip:{marginBottom:2},tooltipHeader:{color:e.mediumInvertedTextColor,fontSize:10,textTransform:"uppercase",letterSpacing:"0.015em",marginBottom:2},viewReasonsButton:{marginLeft:28,marginTop:2,border:"none"},tooltipUserRow:{display:"flex",justifyContent:"space-between",marginBottom:4},tooltipUserRowEmail:{marginLeft:5}})),[]),m=(0,v.useIntl)(),c=(0,Te.VK)((()=>{var e;const t=[],i=new Set;return null===(e=s.createdByActorsWithReason)||void 0===e||e.forEach((e=>{i.has(e.actor.id)||t.push(e.actor),i.add(e.actor.id)})),t}),[s.createdByActorsWithReason]);if(!s||!s.forActor||!s.createdByActorsWithReason.length)return null;const p=qe.CQ(s.latestRequestTime,qe.x7),g=(0,xe.ZV)({value:p,date_format:"relative",userTimeZone:qe.x7,intl:m,allowRelativeDates:!0}),h={environment:o,store:t,accessRequestStore:r,forActor:i},b=c.filter((e=>e.email!==s.forActor.email)),f=b.length!==c.length,y=()=>1===c.length?n()(v.FormattedMessage,f?{defaultMessage:"Guest self request",id:"spaceSettingsRequests.requestRowAction.requestedBySingularGuestSelfRequest",description:"Describes that a request came from a guest self request."}:{defaultMessage:"From {actorName}",id:"spaceSettingsRequests.requestRowAction.requestedBySingular",description:"Describes the user that a request came from",values:{actorName:c[0].name}}):n()(v.FormattedMessage,f?{defaultMessage:"{numberOfOtherActors, plural, one {Guest self request and from {secondActorName}} other {Guest self request and from {numberOfOtherActors} more}}",id:"spaceSettingsRequests.requestRowAction.requestedByPluralIncludingGuestSelfRequest",description:"Describes the guest self request and the multiple users that a request came from",values:{secondActorName:b[0].name,numberOfOtherActors:b.length}}:{defaultMessage:"{numberOfOtherActors, plural, one {From {firstActorName} and {secondActorName}} other {From {firstActorName} and {numberOfOtherActors} more}}",id:"spaceSettingsRequests.requestRowAction.requestedByPlural",description:"Describes multiple users that a request came from",values:{firstActorName:c[0].name,secondActorName:c[1].name,numberOfOtherActors:c.length-1}});return n()("div",{style:{width:"100%"}},void 0,n()("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},void 0,n()("div",{},void 0,n()("div",{style:{display:"flex",alignItems:"center"}},void 0,n()(_e.Z,{userValue:s.forActor,size:28,borderStyle:"dashed"}),n()("div",{style:u.requestMetadata},void 0,n()("div",{style:u.email},void 0,n()(oe.Z,{className:"notranslate"},void 0,s.forActor.email)),n()(oe.Z,{isSmall:!0},void 0,n()(re.Z,{renderTooltip:()=>n()("div",{style:u.tooltip},void 0,n()(oe.Z,{style:u.tooltipHeader},void 0,n()(v.FormattedMessage,{defaultMessage:"Requested by",id:"spaceSettingsRequests.requestRowAction.requestedByMoreThanTwo.tooltip",description:"Describes multiple user emails that a request came from"})),c.map((e=>n()("div",{style:u.tooltipUserRow},e.id,n()(Ue.Z,{avatarSize:18,userValue:e}),n()("div",{style:u.tooltipUserRowEmail},void 0,e.email))))),render:e=>d.createElement("span",e,n()(y,{}))})," · ",g)))),n()("div",{style:u.actionButtons},void 0,n()(fe.Z,{isGray:!0,onClick:async()=>{await(0,S.kn)({...h,status:"rejected",from:"requests_center"})}},void 0,n()(v.FormattedMessage,{defaultMessage:"Decline",id:"spaceSettingsRequests.requestRowAction.declineButton.label",description:"Label for button that allows user to reject a pending membership request"})),n()(X.Z,{isBlue:!0,onClick:async()=>{await(0,S.kn)({...h,status:"approved",from:"requests_center"})}},void 0,n()(v.FormattedMessage,{defaultMessage:"Approve",id:"spaceSettingsRequests.requestRowAction.acceptButton.label",description:"Label for button that allows user to approve a pending membership request"})))),s.createdByActorsWithReason.some((e=>{let{reason:t}=e;return Boolean(t)}))&&n()(X.Z,{isSmall:!0,isBlue:!0,style:u.viewReasonsButton,onClick:()=>l(!a)},void 0,n()(v.FormattedMessage,a?{id:"spaceSettingsRequests.requestRowAction.closeReasonsButton.label",defaultMessage:"Close reasons",description:"Button to collapse reasons in view for a membership request."}:{id:"spaceSettingsRequests.requestRowAction.viewReasonsButton.label",defaultMessage:"View reasons",description:"Button to expand reasons for a membership request."})),a&&n()("div",{style:{marginLeft:34,marginTop:2,fontSize:Ge.Z.fontSize.UIRegular.desktop}},void 0,s.createdByActorsWithReason.filter((e=>{let{reason:t}=e;return Boolean(t)})).map((e=>n()("div",{},e.actor.id,e.actor.name," · ",e.reason)))))}function Le(e){const{spaceStore:t,accessRequestRenderValues:s,lastOpenedRequestCenterTime:i}=e,r=(0,Te.VK)((()=>s.filter((e=>"pending"===e.accessRequestStore.getKeyStore("status").getValue())).sort(((e,t)=>t.latestRequestTime-e.latestRequestTime))),[s]),o=(0,Ze.y)((e=>({requestColumn:{width:"100%"},zeroStateContainer:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",padding:40,color:e.mediumTextColor,borderStyle:"solid",borderColor:e.regularDividerColor,borderWidth:1,borderRadius:3},mailIcon:{height:12,width:17,color:e.mediumIconColor,marginRight:6}})),[]),a={key:"request",header:void 0,style:o.requestColumn};return 0===r.length?n()("div",{style:o.zeroStateContainer},void 0,c.Z.mailRound(o.mailIcon),n()(v.FormattedMessage,{id:"spaceSettingsRequests.emptyRequests.message",defaultMessage:"No invite requests yet",description:"Message in requests inbox telling user there are no requests yet."})):n()(Be.Z,{hideHeader:!0,columns:[a],rows:r.map(((e,s)=>({key:`request${s.toString()}`,columns:[n()("div",{style:{display:"flex",alignItems:"center"}},e.accessRequest.id,i<e.accessRequest.created_time&&n()("div",{style:{marginLeft:-18,marginRight:10}},void 0,n()(Fe.z,{size:8})),n()(Ae,{store:t,request:e}))]})))})}function De(e){const{spaceStore:t,accessRequestsStore:s}=e,i=(0,Re.O7)(),[r,o]=(0,d.useState)(Date.now()),[,,a]=(0,Te.oR)(void 0,Pe.Z),l=(0,Te.VK)((()=>a.getValueForSpace(t)),[t,a]),u=Boolean(null==l?void 0:l.disableMembershipRequests),m=Boolean(null==l?void 0:l.disableGuestMembershipRequests),c=(0,Te.VK)((()=>t.getKeyStore("settings").getKeyStore("seen_guest_membership_requests").getValue()&&(0,P.Ye)(i)),[i,t]),[p,,]=(0,Te.oR)(s),g=(0,Ze.y)((e=>({errorContainer:{display:"flex",justifyContent:"center",alignItems:"center",padding:40,color:e.mediumTextColor}})),[]);(0,d.useEffect)((()=>{const{currentSpaceViewStore:e}=A.default.state;if(!e)return;const t=e.getKeyStore("settings").getKeyStore("last_opened_request_center").getValue();t&&o(t),I.createAndCommit({userAction:"SpaceSettingsRequests.updateLastOpened",environment:i,perform:t=>{I.applyOperation({store:e,operation:{pointer:e.pointer,path:["settings","last_opened_request_center"],command:"set",args:Date.now()},transaction:t})}})}),[]);return h=p.error,b=p.result,p.ready?h||!b?n()("div",{style:g.errorContainer},void 0,n()(v.FormattedMessage,{defaultMessage:"Something went wrong.",id:"notificationUpdates.unknownErrorMessage"})):d.createElement(d.Fragment,null,n()(Ee,{spaceStore:t,securitySettingsStoreState:l,disabled:u}),c&&n()(Oe,{spaceStore:t,securitySettingsStoreState:l,disabled:m}),n()(Le,{spaceStore:t,accessRequestRenderValues:b,lastOpenedRequestCenterTime:r})):n()("div",{style:g.errorContainer},void 0,n()(Y.Z,{}));var h,b}function Ee(e){const t=(0,Re.O7)(),{spaceStore:s,securitySettingsStoreState:i,disabled:r}=e,o=(0,Ze.y)((()=>({toggleContainer:{display:"flex",alignItems:"center",cursor:"pointer",marginBottom:14},titleDescription:{fontSize:14,marginRight:8,flexGrow:1},description:{marginTop:2,width:"80%"}})),[]);return n()("div",{style:o.toggleContainer,onClick:function(){i&&(0,Ie.n)(t,{securitySettingsState:{...i,disableMembershipRequests:!i.disableMembershipRequests},spaceStore:s})}},void 0,n()("div",{style:o.titleDescription},void 0,n()(v.FormattedMessage,{id:"spaceSettingsRequests.allowMembersToRequestMembers.title",description:"Title for a setting that, when on, will allow workspace members to request users to become workspace members.",defaultMessage:"Allow members to request adding other members"}),n()(oe.Z,{isSmall:!0,isMultiline:!0,style:o.description},void 0,n()(v.FormattedMessage,{id:"spaceSettingsRequests.allowMembersToRequestMembers.description",description:"Description for a setting that, when on, will allow workspace members to request users to become workspace members.",defaultMessage:"Members can submit requests to admins to add more members"}))),n()(ie.Z,{on:!r}))}function Oe(e){const t=(0,Re.O7)(),{spaceStore:s,securitySettingsStoreState:i,disabled:r}=e,o=(0,Ze.y)((()=>({toggleContainer:{display:"flex",alignItems:"center",cursor:"pointer",marginBottom:14},titleDescription:{fontSize:14,marginRight:8,flexGrow:1},description:{marginTop:2,width:"80%"}})),[]);return n()("div",{style:o.toggleContainer,onClick:function(){i&&(0,Ie.n)(t,{securitySettingsState:{...i,disableGuestMembershipRequests:!i.disableGuestMembershipRequests},spaceStore:s})}},void 0,n()("div",{style:o.titleDescription},void 0,n()(v.FormattedMessage,{id:"spaceSettingsRequests.allowGuestsToSelfRequest.title",description:"Title label for workspace toggle that enables guest self-request membership feature.",defaultMessage:"Allow page guests to request to be added as members to the workspace"}),n()(oe.Z,{isSmall:!0,isMultiline:!0,style:o.description},void 0,n()(v.FormattedMessage,{id:"spaceSettingsRequests.allowGuestsToSelfRequest.description",description:"Description of label for workspace toggle that enables guest self-request membership feature.",defaultMessage:"Guests of the workspace can submit requests to admins to be added as members"}))),n()(ie.Z,{on:!r}))}var Ve=s(29825),Ke=s(83890),Ne=s(98707),ze=s(27386),We=s(23189),He=s(40394),je=s(33929),Qe=s(33846),Je=s(31194),$e=s(48690),Ye=s(30397),Xe=s(48019),et=s(52275),tt=s(68894),st=s(93686);const it=(0,v.defineMessages)({filterTeams:{defaultMessage:"Filter teamspaces…",id:"teamsDropdownForGroupMenu.filterForTeams.placeholder",description:"Placeholder text for filtering teamspaces within a group."}});function rt(e){const t=(0,Re.O7)(),s=(0,Ze.y)((()=>({teamMenuItem:{fontWeight:400}})),[]),[i,o]=(0,Te.oR)(void 0,Qe.Z),[,a]=(0,Te.oR)($e.Z),l=(0,d.useCallback)((e=>{a((t=>({...t,open:!0,tab:$e.a.Members,selectedTeamId:e})))}),[a]),u=(0,Te.VK)((()=>[{key:"teams for group",render:e=>d.createElement(te.Z,e),actions:e.teamStores.map((e=>({key:e.id,displayName:e.getName(),analyticsName:e.getName()||"team_unknown",searchName:e.getName(),render:t=>d.createElement(et.Z,r()({icon:n()(st.p,{disabled:!0,store:e}),title:n()(oe.Z,{style:s.teamMenuItem},void 0,e.getName()),right:n()(v.FormattedMessage,{defaultMessage:"{numMembers} {numMembers, plural, one {member} other {members}}",id:"teamsInGroupMenu.filterForTeams.numMembers",description:"Number of members in a teamspace, displayed in a popup showing teamspaces connected to a group.",values:{numMembers:e.getUserIdsInTeam().length}})},t)),action:()=>{l(e.id)},closeParentMenu:!0})))}]),[s,e.teamStores,l]),m=i.inputValue,c=n()(Xe.Z,{filter:m,context:{blocks:[],environment:t,publicEditMode:void 0},sections:u,initialFocus:0}),p=n()(te.Z,{isInput:!0},void 0,n()(tt.ZP,{value:m,onChange:(0,d.useCallback)((e=>{o({inputValue:e.target.value,focus:!1})}),[o]),focus:!0,focusAfterAnimation:!0,placeholder:je.default.formatMessage(it.filterTeams)})),g={menuType:ue.o.Popup,width:280,maxHeight:"50vh",header:e.teamStores.length>5?p:void 0};return d.createElement(pe.Z,g,c)}const ot=function(e){const t=(0,Te.qz)(void 0,me.Z),[s]=(0,Te.oR)(Ye.Z),i=(0,Ze.y)((e=>({button:{marginRight:8},noTeams:{marginRight:8,color:e.lightTextColor},chevron:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),o=(0,Te.VK)((()=>s.teams.filter((t=>t.getMembers().some((t=>"group"===t.entity_type&&t.group_id===e.group.id))))),[s,e.group]);return n()(ce.Z,{popupType:ce.Z.PopupType.Popup,renderOrigin:e=>d.createElement(fe.Z,r()({disabled:0===o.length,style:0===o.length?i.noTeams:i.button},e),0===o.length?n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.userGroup.teamsCountNone",defaultMessage:"None",description:"Button for displaying that this group is not part of any teamspaces."}):n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.userGroup.teamsCount",defaultMessage:"{numberOfTeams, plural, one {{numberOfTeams} teamspace} other {{numberOfTeams} teamspaces}}",description:"Button for displaying how many teamspaces this group is a part of.",values:{numberOfTeams:o.length}}),o.length>0&&c.Z.chevronDown(i.chevron)),buttonPopupStore:t,placementToOrigin:Je.Iw.Bottom,render:e=>n()(rt,{parent:e,teamStores:o}),onClose:(0,d.useCallback)((()=>{t.reset()}),[t])})};var nt=s(38363),at=s(19522),lt=s(93405),dt=s(73063),ut=s(44532);function mt(e){const{group:t,spaceStore:s,settingsStore:i}=e,o=(0,Te.qz)(void 0,me.Z);return n()(ce.Z,{popupType:ut.kQ.Popup,render:()=>n()(ct,{group:t,spaceStore:s,popupStore:o,settingsStore:i}),buttonPopupStore:o,renderOrigin:e=>d.createElement(dt.Z,r()({icon:c.Z.dots},e))})}function ct(e){const{group:t,spaceStore:s,popupStore:i,settingsStore:o}=e,a=(0,U.Gc)(),u=(0,Te.VK)((()=>s.canAdmin()),[s]),m=(0,Re.O7)(),c=(0,Ze.y)((e=>({deleteButton:{color:e.redBadgeBackground}})),[]),p=(0,d.useCallback)((async()=>{i.setState({open:!1});await w.confirmUserAction({message:n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.deleteGroupModal.confirmationMessage",defaultMessage:"Are you sure you want to delete this group? Any pages that are private to this group will be transferred to you."}),acceptLabel:n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.deleteGroupModal.confirmationButton.label",defaultMessage:"Yes"})})&&(await I.createAndCommitAsync({environment:m,userAction:"SpacePermissionGroup.handleDelete",waitForServerCommit:!1,perform:async e=>{await T.Xv({environment:m,spaceStore:s,group:t,transaction:e})}}),y.trackPermissionGroupDelete(m))}),[t,m,s,i]),g=(0,d.useCallback)((()=>{o.setState({...o.state,editingNameGroupId:t.id,groupNameInputValue:t.name||""}),i.setState({open:!1}),y.trackPermissionGroupRename(m)}),[t,m,i,o]),h=(0,d.useCallback)((()=>{at.Z.setState({...at.Z.state,name:t.name||"",defaultInviteTargets:[{type:"group",value:t}]}),nt.lo("group_settings")}),[t]),b={key:"action_menu",render:e=>d.createElement(te.Z,e),items:l().compact([{key:"rename",render:e=>d.createElement(lt.Z,r()({},e,{title:n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.groupList.actionMenu.renameItem",defaultMessage:"Rename"})})),action:g},a?{key:"create_team_from_group",render:e=>d.createElement(lt.Z,r()({},e,{title:n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.groupList.actionMenu.createTeamFromGroup",defaultMessage:"Create teamspace from group",description:"Button text shown when you click on the three-dot menu of a group in group settings. Clicking on it allows you to create a teamspace using the group's information."})})),action:h}:void 0,u&&{key:"delete",render:e=>d.createElement(lt.Z,r()({},e,{title:n()("div",{style:c.deleteButton},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.groupList.actionMenu.deleteItem",defaultMessage:"Delete"}))})),action:p}])};return n()(pe.Z,{menuType:ue.o.Popup},void 0,n()(he.Z,{type:he.i.Vertical,initialFocus:0,sections:[b],onAccept:()=>{i.setState({open:!1})}}))}var pt=s(8848),gt=s(16639),ht=s(49085);class bt extends ht.Z{getInitialState(){return{userInputValue:"",temporaryUserIds:[],limitUsers:!0}}}const ft=bt;var vt=s(86125),St=s(33728),yt=s(31299),Mt=s(92864),Ct=s(47082),wt=s(97680);function kt(e){const{group:t,spaceStore:s,groupStore:i}=e,o=(0,Te.qz)(void 0,me.Z),a=(0,Ze.y)((()=>({popup:{width:400},button:{marginTop:4}})),[]);return n()(ce.Z,{popupType:ut.kQ.Popup,render:()=>n()(Rt,{spaceStore:s,group:t,popupStore:o,groupStore:i}),buttonPopupStore:o,onClose:()=>i.setState({userInputValue:"",temporaryUserIds:[],limitUsers:!0}),style:a.popup,renderOrigin:e=>n()("div",{},void 0,d.createElement(fe.Z,r()({isGray:!0,icon:c.Z.plus,style:a.button},e),n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.groupList.addMemberButton.label",defaultMessage:"Add members"})))})}function Rt(e){const t=(0,Re.O7)(),s=(0,v.useIntl)(),{group:i,spaceStore:r,popupStore:o,groupStore:a}=e,u=(0,Te.VK)((()=>a.state.temporaryUserIds.map((e=>{const t=r.getRecordValue({table:h.KJ,id:e});return n()(Mt.vw,{userValue:t,format:Mt.vw.Format.Medium,showRemoveButton:!0,onClickRemove:()=>{const t=a.state.temporaryUserIds.filter((t=>t!==e));a.setState({...a.state,temporaryUserIds:t})},shouldShrink:!0,isSingle:!1},e)}))),[r,a]),m=(0,Te.VK)((()=>()=>{const{temporaryUserIds:e}=a.state,s=i.user_ids||[],n=l().union(s,e),d={...i,user_ids:n,last_edited_time:Date.now()};I.createAndCommit({userAction:"SpacePermissionGroup.handleAddDoneClick",environment:t,perform:e=>{T.jF({spaceStore:r,group:d,transaction:e})}}),a.setState({userInputValue:"",temporaryUserIds:[],limitUsers:!0}),o.setState({open:!1}),y.trackPermissionGroupAddMembers(t,{add_member_count:e.length})}),[i,t,a,o,r]),c=(0,d.useCallback)((()=>{const{temporaryUserIds:e}=a.state,t=e.slice(0,e.length-1);a.setState({...a.state,temporaryUserIds:t})}),[a]),p=(0,d.useCallback)((e=>{const t=e.target.value,{extractedEmails:s,newInputValue:i}=(0,St.zI)(t),{currentSpaceStore:r}=A.default.state,{data:o}=N.default.state;if(!o||!r)return;const n=(0,q.CM)(o).map((e=>e.userId)),d=l().compact(n.map((e=>E.U6.createChildStore(r,{table:h.KJ,id:e}).getValue()))).filter((e=>s.includes(e.email)&&!a.state.temporaryUserIds.includes(e.id)));a.setState({...a.state,temporaryUserIds:[...a.state.temporaryUserIds,...d.map((e=>e.id))],userInputValue:i})}),[a]),g=(0,Te.VK)((()=>a.state.userInputValue),[a]),b=(0,Te.VK)((()=>a.state.temporaryUserIds),[a]);return n()(pe.Z,{menuType:ue.o.Popup,tokenInputHeader:!0,header:n()(Ct.Z,{focus:!0,disabled:!1,focusAfterAnimation:!0,format:Ct.Z.Format.Group,tokens:u,placeholder:s.formatMessage({id:"spacePermissionsSettings.groupsTab.userGroup.userSearchInput.placeholder",defaultMessage:"Search for a person…"}),onRemoveLastToken:c,value:g,onChange:p,inputAndTokenWrapRightStyle:{paddingTop:t.device.isMobile?0:6,paddingBottom:t.device.isMobile?0:6},right:n()(j.Z,{isLarge:!0,onClick:m},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.userGroup.addUserButton.label",defaultMessage:"Add"}))})},void 0,n()(ee.Z,{request:{query:g,temporaryUserIds:b},performRequest:async s=>{let{query:i,temporaryUserIds:r}=s;const o=e.group.user_ids||[];return(await yt.O$({environment:t,query:i,membersOnly:!0})).filter((e=>o.indexOf(e.id)<0&&r.indexOf(e.id)<0)).slice(0,20)},render:(e,t)=>n()(Tt,{results:t,spaceStore:r,groupStore:a})}))}function Tt(e){const{spaceStore:t,groupStore:s}=e,[i,o]=(0,Te.oR)(s,ft),a=(e.results||[]).map((e=>{let{id:t}=e;return t})),l=(0,Te.VK)((()=>a.map((e=>{const s=E.U6.createChildStore(t,{table:h.KJ,id:e}).getValue();return{key:e,render:e=>d.createElement(wt.Z,r()({},e,{user:s,useEmailAsTooltip:!0})),action:()=>{const t=[...i.temporaryUserIds,e];o({...i,temporaryUserIds:t,userInputValue:""})}}}))),[t,o,i,a]);if(0===a.length)return n()(te.Z,{},void 0,n()(be.Z,{title:n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.userGroup.searchUserDropdown.noResultsMessage",defaultMessage:"No results"})}));{const e={key:"user_menu",render:e=>d.createElement(te.Z,e),items:l};return n()(he.Z,{type:he.i.Vertical,initialFocus:0,sections:[e]})}}function Zt(e){const{group:t,canEdit:s,spaceStore:i,settingsStore:o}=e,a=(0,Te.qz)(void 0,ft),{groupMembers:l,remainingMembers:u}=(0,Te.VK)((()=>{const{countRemainingUsers:e,totalNumberMembers:s,limitedUserValues:r}=(0,gt.rm)({group:t,spaceStore:i,limit:a.state.limitUsers&&!o.state.groupsFilter?10:void 0});return{groupMembers:(0,gt.N5)({userValues:r,spaceValue:{permissions:i.getPermissionItems()}}),remainingMembers:e,totalMembers:s}}),[t,i,o,a]);return n()("div",{style:{padding:"4px 42px 8px"}},void 0,l.map((t=>d.createElement(It,r()({key:t.id,userValue:t},e)))),u>0&&n()(fe.Z,{isGray:!0,style:{marginTop:4},onClick:()=>{a.setState({...a.state,limitUsers:!1})}},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.showMoreUsersButton.label",defaultMessage:"{numberOfHiddenUsers, plural, one {Show {numberOfHiddenUsers} more} other {Show {numberOfHiddenUsers} more}}",values:{numberOfHiddenUsers:u}})),s?n()(kt,{group:t,spaceStore:i,groupStore:a}):l.length<1&&n()(fe.Z,{disabled:!0,isGray:!0},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.groupList.noMembersInside",defaultMessage:"No members inside",description:"A label saying that there are no members inside this group."})))}function It(e){const{spaceStore:t,userValue:s,group:i,canEdit:r}=e,o=(0,Re.O7)(),a=(0,Te.VK)((()=>t.isDefined()?(0,F.su)({permissions:t.getPermissionItems()},s.id):"none"),[t,s]);return n()("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},s.id,n()("div",{style:{display:"flex"}},void 0,n()(Ue.Z,{userValue:s,style:{fontSize:14,fontWeight:400,lineHeight:"17px",paddingRight:6,minHeight:34,width:"100%"},avatarSize:22}),(0,p.Bc)(a)&&n()(vt.Z,{role:"membership_admin"===a?"membership_admin":"admin"})),r&&n()(fe.Z,{isGray:!0,hoveredStyle:{color:pt.ZP.red},onClick:async()=>{if(await w.confirmUserAction({message:n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.removeMemberFromGroupDialog.confirmationMessage",defaultMessage:"Are you sure you want to remove this member?"}),acceptLabel:n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.removeMemberFromGroupDialog.confirmationButton.label",defaultMessage:"Yes"})})){const e=(i.user_ids||[]).filter((e=>e!==s.id)),r={...i,user_ids:e,last_edited_time:Date.now()};I.createAndCommit({userAction:"SpacePermissionGroup.renderUser",environment:o,perform:e=>{T.jF({spaceStore:t,group:r,transaction:e})}}),y.trackPermissionGroupRemoveMember(o)}}},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.removeMemberFromGroupButton.label",defaultMessage:"Remove"})))}var Pt=s(13991),Ft=s(22808),Bt=s(49312),xt=s(12793),qt=s(3386),Gt=s(31278),Ut=s(5210);function _t(e){const{row:t,canEdit:s,open:i,toggleOpenState:o,spaceStore:a,settingsStore:l}=e,u=t.group,m=(0,v.useIntl)(),p=(0,Ze.F)(),g=(0,Re.O7)(),h=gt.kF({intl:m,group:u}),b=(0,Ze.y)((e=>({container:{display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%"},toggle:{flexShrink:0,marginRight:2},chevron:{width:12,height:12,transition:"transform 200ms ease-out",transform:`rotateZ(${i?0:-90}deg)`,fill:"inherit",opacity:.5,marginRight:4},name:{fontFamily:Ge.Z.getCompositeFontFamily(Pt.SP).sans,fontSize:14,lineHeight:"17px",marginRight:4},input:{fontWeight:Ge.Z.fontWeight.medium,padding:"4px 6px",background:e.contentBackgroundTransparent},icon:{marginRight:9}})),[i]),f=(0,d.useCallback)((e=>{const t={...u,icon:e,last_edited_time:Date.now()};I.createAndCommit({userAction:"SpacePermissionGroup.handleIconChange",environment:g,perform:e=>{T.jF({spaceStore:a,group:t,transaction:e})}}),y.trackPermissionGroupSetIcon(g,{is_emoji:(0,Ft.Z)(e)})}),[u,a,g]),S=(0,d.useCallback)((()=>{l.setState({...l.state,editingNameGroupId:void 0,groupNameInputValue:""})}),[l]),M=(0,d.useCallback)((e=>{l.setState({...l.state,groupNameInputValue:e.target.value})}),[l]),C=(0,d.useCallback)((()=>{const{editingNameGroupId:e,groupNameInputValue:t}=l.state,s=t.trim();if(e===u.id){if(s!==u.name){const e={...u,name:s,last_edited_time:Date.now()};I.createAndCommit({userAction:"SpacePermissionGroup.handleNameAccept",environment:g,perform:t=>{T.jF({spaceStore:a,group:e,transaction:t})}})}l.setState({...l.state,editingNameGroupId:void 0,groupNameInputValue:""})}}),[u,g,a,l]),w=(0,Te.VK)((()=>l.state.editingNameGroupId===u.id),[u,l]),k=(0,Te.VK)((()=>l.state.groupNameInputValue),[l]);function R(e){const t={width:e-4,height:e-4,fill:p.mediumIconColor},s={width:12,height:12,fill:p.mediumIconColor};return n()("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"}},void 0,c.Z.random(t),c.Z.plusThick(s))}return n()("div",{style:b.container},void 0,n()(Ut.Z,{isSidebar:!1,fill:!0,icon:"chevron",open:i,color:p.mediumIconColor,onClick:()=>o(u.id),style:b.toggle}),n()(xt.Z,{size:28,style:b.icon}),w?n()(qt.Z,{capture:!0,onEsc:S},void 0,n()($.Z,{disabled:!s,type:Bt.Z.Type.Inline,style:b.input,placeholder:m.formatMessage({id:"spacePermissionsSettings.groupsTab.userGroup.groupNameInput.placeholder",defaultMessage:"Untitled"}),focus:!0,value:k,onChange:M,onBlur:C,onSubmit:C})):n()(oe.Z,{style:b.name,showTooltipWhenTruncated:!0},void 0,h),(Z=t.isRowHovered,u.icon?n()(Gt.Z,s?{disabled:!1,bucket:"public",icon:u.icon?{pointer:a.pointer,icon:u.icon}:void 0,size:18,isEmptyPage:!1,title:h,onChange:f,style:b.icon}:{disabled:!0,bucket:"public",icon:u.icon?{pointer:a.pointer,icon:u.icon}:void 0,size:18,isEmptyPage:!1,title:h,style:b.icon}):Z&&s?n()(re.Z,{renderTooltip:()=>n()(v.FormattedMessage,{defaultMessage:"Add icon",id:"spacePermissionsSettings.groupsTab.userGroup.groupIcon.tooltip",description:"Tooltip explaining that user can add an icon for a group"}),render:e=>d.createElement(Gt.Z,r()({disabled:!1,bucket:"public",icon:u.icon?{pointer:a.pointer,icon:u.icon}:void 0,size:18,isEmptyPage:!1,title:h,onChange:f,style:{...b.icon,width:30},defaultIcon:R(18)},e))}):void 0));var Z}function At(e){let{groups:t,canEdit:s,spaceStore:i,permissionsSettingsStore:r}=e;const[o,a]=(0,d.useState)([]),l=(0,Ze.F)(),u=(0,U.Gc)(),c=(0,Te.VK)((()=>(0,m.ZP)(r.state.groupsFilter,t,(e=>e.name||""))),[r,t]),p=(0,d.useCallback)((e=>{a((t=>t.includes(e)?t.filter((t=>t!==e)):t.concat(e)))}),[a]),g=(0,d.useMemo)((()=>function(e){return e.map((e=>({id:e.id,group:e,isClickable:!1})))}(c)),[c]),h=(0,d.useMemo)((()=>function(e){let{openRowIds:t,toggleOpenRowId:s,canEdit:i,spaceStore:r,settingsStore:o,isTeamEnabled:a}=e;const l={id:"title",headerTitle:n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.spaceGroupsTable.groups",defaultMessage:"Group",description:"Title of the groups column of the groups table."}),renderCell:e=>n()(_t,{row:e,open:t.includes(e.id),toggleOpenState:s,canEdit:i,spaceStore:r,settingsStore:o}),widthData:{width:120},hasClickableContents:!1,sortable:!1},d={id:"teams",headerTitle:n()("div",{style:{paddingLeft:8}},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.spaceGroupsTable.teams",defaultMessage:"Teamspaces",description:"Title of the teamspaces column of the groups table."})),renderCell:e=>n()("div",{style:Ge.Z.textOverflowStyle},void 0,n()(ot,{group:e.group})),widthData:{width:40},hasClickableContents:!1,sortable:!1},u={id:"members",headerTitle:n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.spaceGroupsTable.member",defaultMessage:"Members",description:"Title of the members column of the groups table."}),renderCell:e=>{var t;return n()("div",{style:Ge.Z.textOverflowStyle},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.userGroup.memberCount",defaultMessage:"{numberOfGroupMembers, plural, one {{numberOfGroupMembers} member} other {{numberOfGroupMembers} members}}",values:{numberOfGroupMembers:(null===(t=e.group.user_ids)||void 0===t?void 0:t.length)||0}}))},widthData:{width:40},hasClickableContents:!1,sortable:!1},m={id:"menu",headerTitle:null,renderCell:e=>n()(mt,{group:e.group,spaceStore:r,settingsStore:o}),widthData:{width:20},hasClickableContents:!0,sortable:!1};return[l,...a?[d]:[],u,...i?[m]:[]]}({openRowIds:o,toggleOpenRowId:p,canEdit:s,spaceStore:i,settingsStore:r,isTeamEnabled:u})),[o,p,s,i,r,u]),b=(0,He.b)({columnRenderInfo:h,theme:l});return n()(He.D,{showRowBorders:!0,hideHeaderRowPadding:!0,columnRenderInfo:h,rows:g,styles:b,renderNoRowsComponent:()=>n()(oe.Z,{isSmall:!0,style:{marginLeft:5,marginTop:10,marginBottom:20}},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.spaceGroupsTable.noGroupsFound",defaultMessage:"No groups found.",description:"Message displayed on the groups table in space settings when there are no groups matching the user's search query."})),renderRowChild:e=>o.includes(e.id)?n()(Zt,{group:e.group,canEdit:s,spaceStore:i,settingsStore:r}):void 0})}var Lt=s(66957),Dt=s(88775),Et=s(69435);class Ot extends u.Z{constructor(){super(...arguments),this.storeTypes={spacePermissionsSettingsStore:V.Z,getRecoverableSpaceUserContentRequestStore:O.Z,accessRequestsStore:O.Z},this.userIdsWithContentBeingReprovisioned=new W.default([]),this.renderReprovisioningData=(e,t,s)=>t?n()(Be.Z,{columns:[{key:"user",header:n()(v.FormattedMessage,{id:"spacePermissionsSettings.userTable.userColumn.header",defaultMessage:"User"}),style:{width:"50%"}},{key:"count",header:n()(v.FormattedMessage,{id:"spacePermissionsSettings.userTable.pageCountColumn.header",defaultMessage:"Private pages",description:"Column header for number of private pages each user has"}),style:{width:"25%"}},{key:"action",header:n()(v.FormattedMessage,{id:"spacePermissionsSettings.userTable.actionLevelColumn.header",defaultMessage:"Action"}),style:{width:"25%"}}],rows:t.recentSpaceRecoverPages.map((e=>{let{userId:t,privatePagesCount:s}=e;const i=E.U6.createChildStore(this.props.store,{table:h.KJ,id:t}).getValue();return{key:t,columns:[this.renderMember(i),s,this.userIdsWithContentBeingReprovisioned.state.includes(t)?n()(Y.Z,{}):n()("div",{style:{marginLeft:-4}},void 0,n()(Ke.Z,{mode:Ne.z.Button,focused:!1,title:n()(v.FormattedMessage,{id:"spacePermissionsSettings.reprovision.toUser.title",defaultMessage:"Transfer private pages"}),parentStore:this.props.store,userIds:this.userIdsWithContentBeingReprovisioned.state,onChange:e=>{let[s]=e;this.handleReprovisionToUserChange(t,s)},disabled:0===s||void 0}))]}}))}):!s&&n()(Y.Z,{}),this.handleUpdateClick=()=>{const e=(0,v.defineMessages)({updatingPermissions:{id:"spacePermissionsSettings.updatePermissionsMessage",defaultMessage:"Updating…"}});k.j({message:e.updatingPermissions})},this.handleUpdateComplete=()=>{k.x()},this.handleTabClick=(e,t)=>{const s=this.getCurrentTabs(t)[e];switch(s){case V.Q.Members:y.trackPermissionsSettingsTabClick(this.environment,{tab:"members"});break;case V.Q.Groups:y.trackPermissionsSettingsTabClick(this.environment,{tab:"groups"});break;case V.Q.Guests:y.trackPermissionsSettingsTabClick(this.environment,{tab:"guests"});break;case V.Q.Reprovisioning:y.trackPermissionsSettingsTabClick(this.environment,{tab:"reprovisioning"});break;case V.Q.Requests:y.trackPermissionsSettingsTabClick(this.environment,{tab:"requests"});break;default:(0,f.t1)(s)}this.stores.spacePermissionsSettingsStore.state.currentTab===V.Q.Requests&&s!==V.Q.Requests&&z.Z.reset(),this.stores.spacePermissionsSettingsStore.setState({...this.stores.spacePermissionsSettingsStore.state,currentTab:s})},this.handleCreateGroupClick=()=>{I.createAndCommit({userAction:"SpacePermissionsSettings.handleCreateGroupClick",environment:this.environment,perform:e=>{const t=T.mo({environment:this.environment,spaceStore:this.props.store,transaction:e});t&&this.stores.spacePermissionsSettingsStore.setState({...this.stores.spacePermissionsSettingsStore.state,editingNameGroupId:t.id,groupNameInputValue:""})}}),y.trackPermissionGroupCreate(this.environment)},this.handleFilterChange=e=>{this.stores.spacePermissionsSettingsStore.setState({...this.stores.spacePermissionsSettingsStore.state,groupsFilter:e.target.value})},this.handleMembersShowMoreClick=()=>{this.stores.spacePermissionsSettingsStore.setState({...this.stores.spacePermissionsSettingsStore.state,limitMembers:!1})},this.handleGuestsShowMoreClick=()=>{this.stores.spacePermissionsSettingsStore.setState({...this.stores.spacePermissionsSettingsStore.state,limitGuests:!1})},this.handleInviteLinkClick=()=>{const e=!this.getInviteLinkEnabled();y.trackInviteLinkUpdated(this.environment,{enabled:e}),I.createAndCommit({userAction:"SpacePermissionsSettings.handleInviteLinkClick",environment:this.environment,perform:t=>{T.ys({transaction:t,spaceStore:this.props.store,inviteLinkEnabled:Boolean(e)})}})},this.handleSortClick=(e,t)=>{const s=this.stores.spacePermissionsSettingsStore.state.sorts[e];let i;i=!(!s||s.by!==t)&&s.asc,this.stores.spacePermissionsSettingsStore.update((s=>({...s,sorts:{...s.sorts,[e]:{by:t,asc:!i}}})))},this.handleMemberPermissionRoleChange=async(e,t,s)=>{const{store:i}=this.props,r=this.environment.currentUser.id;if(e.userId!==r||"none"!==t)this.handleUpdateClick(),"none"===t?(await M.removeUsersFromSpace(this.environment,{userIds:[e.userId],spaceId:i.id,removePagePermissions:!0,revokeUserTokens:!0}),await Z.bi(this.environment)):I.createAndCommit({userAction:"SpacePermissionsSettings.handleMemberPermissionRoleChange",environment:this.environment,perform:s=>R.ep({environment:this.environment,store:i,permissionItems:[{type:"user_permission",role:t,user_id:e.userId}],transaction:s,from:"space_permission_setting_table"})}),this.handleUpdateComplete();else{await T.bf({environment:this.environment,spaceId:i.id,userSettingsStore:s})&&K.Z.setState({...K.Z.state,open:!1})}},this.handleReprovisionToUserChange=async(e,t)=>{if(!(await w.confirmUserAction({message:n()("span",{},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.reprovisionPrivatePagesConfirmationDialog.confirmationMessage",defaultMessage:"Are you sure you want to transfer their private pages? This action cannot be undone."})),acceptLabel:n()(v.FormattedMessage,{id:"spacePermissionsSettings.reprovisionPrivatePagesConfirmationDialog.confirmButton.label",defaultMessage:"Transfer private pages"})})))return;this.userIdsWithContentBeingReprovisioned.setState([...this.userIdsWithContentBeingReprovisioned.state,e]);const s=await M.transferSpaceUserContent(this.environment,{spaceId:this.props.store.id,fromUserId:e,toUserId:t});"failed"===s.type&&w.showError(s),await this.stores.getRecoverableSpaceUserContentRequestStore.refresh(),this.userIdsWithContentBeingReprovisioned.setState(this.userIdsWithContentBeingReprovisioned.state.filter((t=>t!==e)))}}willMount(){this.setInitialSubtabOnMount()}renderComponent(){const{store:e,isMobile:t}=this.props;if(!L.Z.state.online)return this.renderOfflineMessage();const{data:s}=N.default.state;if(!s)return this.renderLoadingSpinner();const i=q.CM(s);if(!l().every(i.map((t=>E.U6.createChildStore(e,{table:h.KJ,id:t.userId}).isReady()))))return this.renderLoadingSpinner();const r=i.filter(b.CF),o=i.filter(b.du),{currentTab:a}=this.stores.spacePermissionsSettingsStore.state;if(t)return n()(d.Fragment,{},void 0,this.canEditMembership()&&n()(te.Z,{shouldShowBottomDivider:!0},void 0,this.renderMobileInviteButton(),n()("div",{style:this.mobileMenuItemStyle()},void 0,this.renderInviteLink())),n()(te.Z,{},void 0,this.renderSpaceMembers(r)));const u={[V.Q.Members]:n()(v.FormattedMessage,{id:"spacePermissionsSettings.membersTab.title",defaultMessage:"Members ({numberOfMembers})",values:{numberOfMembers:r.length}}),[V.Q.Groups]:n()(v.FormattedMessage,{id:"spaceBasicSettings.groupsTab.title",defaultMessage:"Groups"}),[V.Q.Guests]:n()(v.FormattedMessage,{id:"spacePermissionsSettings.guestsTab.title",defaultMessage:"Guests ({numberOfGuests})",values:{numberOfGuests:o.length}}),[V.Q.Reprovisioning]:n()(v.FormattedMessage,{id:"spaceBasicSettings.reprovisioningTab.title",defaultMessage:"Recently left"}),[V.Q.Requests]:d.createElement(d.Fragment,null,n()(v.FormattedMessage,{id:"spaceBasicSettings.requestsTab.title",defaultMessage:"Requests",description:"Label for a tab that shows a list of requests waiting for approval"}),this.renderNumberOfRequests(),this.renderUnreadRequestDot())},m=this.getCurrentTabs(o),c=m.map((e=>u[e]));return n()(ze.Z,{},void 0,n()(Lt.Z,{tabs:c,selectedIndex:m.indexOf(a),onChange:e=>this.handleTabClick(e,o),style:{paddingLeft:0,paddingRight:0,marginTop:-6,marginBottom:14},tabTitleStyle:{fontSize:16}}),this.renderTab(a,r,o))}renderLoadingSpinner(){return n()(Y.Z,{style:{margin:"calc(50% - 1em) auto"}})}renderOfflineMessage(){return n()(oe.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.offlineMessage",defaultMessage:"Please go online to manage members."}))}renderHelp(){return n()("div",{style:{marginTop:24,marginBottom:24}},void 0,n()(Ce.Z,{title:n()(v.FormattedMessage,{id:"spacePermissionsSettings.helpButton.caption",defaultMessage:"Learn about adding members to your workspace"}),href:(0,B.UY)("guides.members"),analyticsFrom:"members_settings"}))}renderTab(e,t,s){return e===V.Q.Members?n()(d.Fragment,{},void 0,this.renderSpaceMembers(t)):e===V.Q.Guests?n()(d.Fragment,{},void 0,this.renderSpaceGuests(s)):e===V.Q.Groups?this.renderGroupsTab():e===V.Q.Reprovisioning?this.renderReprovisioning():e===V.Q.Requests?this.renderRequestsTab():void(0,f.t1)(e)}renderUnreadRequestDot(){if(this.props.unreadAccessRequests&&this.props.unreadAccessRequests>0)return n()(Fe.z,{color:this.theme.redBadgeBackground,style:{marginLeft:6}})}renderGroupsTab(){const{store:e}=this.props,{groupsFilter:t}=this.stores.spacePermissionsSettingsStore.state,s=this.canUseGroups(),i=this.canAdmin(),o=n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.workspaceOwnersOnly",defaultMessage:"Only workspace owners can add a permission group.",description:"Caption that restricts groups creation to workspace owners"});if(e.isDefined()){const a=e.getPermissionGroups();return n()("div",{},void 0,s?n()(oe.Z,{isMultiline:!0,style:{width:"80%"}},void 0,(0,U.bq)()?n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.captionWithTeamsV2",defaultMessage:"Set up groups to streamline page permissions from the share menu and manage teamspace members in bulk.",description:"Describes the purpose of groups with the context of teamspaces."}):n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.caption",defaultMessage:"Set up groups to conveniently control page permissions from the share menu.",description:"Describes the purpose of groups."})):n()(Et.Z,{for:"team",from:"permission_groups",icon:c.Z.group,title:n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.upgradeTitle",defaultMessage:"Upgrade to create groups"}),caption:n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.upgradeCaption.plus",defaultMessage:"Upgrade to the Plus Plan to set up groups and control permissions from the share menu.",description:"Shown as an upsell if user wants more permission control from the share menu."}),learnMoreRoute:"guides.groups"}),n()(J.Z,{size:24,isHidden:!0}),n()("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},void 0,s&&n()(re.Z,{renderTooltip:()=>!i&&o,render:e=>d.createElement(j.Z,r()({isLarge:!0,onClick:this.handleCreateGroupClick,disabled:!i},i?void 0:e),n()(v.FormattedMessage,{id:"spacePermissionsSettings.groupsTab.createGroupButton.label",defaultMessage:"Create a group"}))}),a.length>0&&n()($.Z,{placeholder:this.props.intl.formatMessage({id:"spacePermissionsSettings.groupsTab.filterGroupNamesInput.placeholder",defaultMessage:"Filter by group name…",description:"Search input placeholder shown above a table that displays all groups."}),left:c.Z.searchThick(this.getSearchIconStyle()),showClearButton:!0,format:$.Z.Format.Small,value:t,style:{...Ot.filterStyle,marginRight:0},onChange:this.handleFilterChange})),a.length>0&&n()(At,{spaceStore:e,permissionsSettingsStore:this.stores.spacePermissionsSettingsStore,groups:a,canEdit:this.canEditGroups()}))}}renderSpaceMembers(e){return this.props.isMobile?this.renderMobileMemberList(e):n()("div",{},void 0,!this.shouldRenderUpsell()&&this.renderHelp(),this.shouldRenderUpsell()&&this.renderUpsell(),this.renderInviteLink(),this.renderDesktopMemberList(e))}renderInviteLink(){if(!this.canUseInviteLink())return;const e=this.getInviteLink(),t=this.getInviteLinkEnabled();if(!e)return;const{spacePermissionsSettingsStore:s}=this.stores;return n()("div",{},void 0,n()("div",{style:{display:"flex",alignItems:"flex-start",cursor:"pointer"}},void 0,n()("div",{style:{marginRight:8,flexGrow:1}},void 0,n()(We.Z,{},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.spaceMembers.inviteLink.title",defaultMessage:"Invite link"})),n()(oe.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"85%"}},void 0,n()(v.FormattedMessage,{id:"spacePermissionSettings.spaceMembers.inviteLink.caption",defaultMessage:"Share this secret link to invite people to this workspace. Only users who can invite members can see this.",description:"Label that is shown above the invite link."})," ",!this.props.isMobile&&this.renderInviteLinkReset())),n()("div",{style:{marginTop:5}},void 0,n()(ie.Z,{on:t,onClick:this.handleInviteLinkClick}))),s&&t&&e&&this.renderInviteLinkUrl(e),n()(J.Z,{size:40}))}renderInviteLinkReset(){const{store:e}=this.props;if(e.isDefined())return n()(v.FormattedMessage,{id:"spacePermissionSettings.spaceMembers.inviteLink.resetLink",defaultMessage:"You can <resetlink>reset the link</resetlink> for all space members to generate a new invite link.",values:{resetlink:t=>n()(we.Z,{onClick:()=>{w.showDialog({message:n()(v.FormattedMessage,{id:"spacePermissionsSettings.inviteLinkRefreshModal.description",defaultMessage:"Are you sure you want to reset the invite link for all space members? Your old one will no longer be able to be used."}),showCancel:!0,keepFocus:!1,handleCancel:w.dismissDialog,items:[{label:n()(v.FormattedMessage,{id:"spacePermissionsSettings.inviteLinkRefreshModal.accept",defaultMessage:"Reset"}),color:"red",onAccept:async()=>{await M.refreshInviteLink(this.environment,{spaceId:e.id}),Z.bi(this.environment)}}]})}},void 0,t)}})}renderInviteLinkUrl(e){const{mobileNative:t}=this.environment,s=n()(v.FormattedMessage,{id:"spacePermissionsSettings.spaceMembers.inviteLink.copyButton",defaultMessage:"Copy link"}),i=()=>{C.RD({environment:this.environment,stringValue:e,copiedMessage:C.tq.copiedLinkToClipboard}),y.trackWorkspaceInviteCopyLink(this.environment)},r=()=>{t&&t.share(e),y.trackWorkspaceInviteCopyLink(this.environment)};return this.props.isMobile?n()("div",{},void 0,n()($.Z,{type:"text",format:$.B.Default,value:e,disabled:!0}),t?n()(X.Z,{onClick:r,style:{marginTop:10,width:"100%"}},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.spaceMembers.inviteLink.shareButton",defaultMessage:"Share link"})):n()(X.Z,{onClick:i,style:{marginTop:10,width:"100%"}},void 0,s)):n()("div",{},void 0,n()("div",{style:{display:"flex",alignItems:"flex-start",marginTop:12}},void 0,n()($.Z,{type:"text",format:$.B.Default,value:e,disabled:!0,style:{borderTopRightRadius:0,borderBottomRightRadius:0,width:"calc(100% - 90px)",height:32}}),n()(j.Z,{onClick:i,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},isLarge:!0},void 0,s)))}renderMobileMemberList(e){const{store:t}=this.props;return n()(d.Fragment,{},void 0,e.map((e=>{const s=E.U6.createChildStore(t,{table:h.KJ,id:e.userId}),i=s.getValue();return n()("div",{style:{display:"flex",alignItems:"center",padding:10,borderBottom:`1px solid ${this.theme.lightDividerColor}`,background:this.theme.cardContentBackground}},e.userId,this.renderMember(i),n()("div",{style:{textAlign:"center",marginLeft:"auto"}},void 0,this.renderUserPermission(e,s)))})))}renderUpsell(){const{data:e}=N.default.state,t=!e||"unsubscribed_guest"!==e.type&&q.Ln(this.environment,e)||"subscribed_admin"===e.type?"team":"team_free",s=G.Aw();return d.createElement(d.Fragment,null,n()(Et.Z,{for:t,from:"members_settings",icon:c.Z.membersFilled,title:n()(v.FormattedMessage,{id:"spacePermissionSettings.memberUpsell.title",defaultMessage:"Share with unlimited members"}),caption:n()(v.FormattedMessage,s?{id:"spacePermissionSettings.memberUpsell.caption.fromSinglePlayerPlus",defaultMessage:"Your workspace currently has a 1-member limit. Upgrade to a collaborative Plus Plan workspace to invite more people.",description:"Shown to contextualize upsell"}:{id:"spacePermissionSettings.memberUpsell.caption",defaultMessage:"Try Notion for Teams for a collaborative workspace, unlimited team members, and advanced permissions."}),learnMoreRoute:"guides.members",upgradeMessage:n()(v.FormattedMessage,s?{id:"spacePermissionSettings.memberUpsell.alternativeSinglePlayerUpgradeLabel",defaultMessage:"Upgrade",description:"Shown as an upsell to full plus plan for users on single-player plus plan variants"}:{id:"spacePermissionSettings.memberUpsell.alternativePlusUpgradeLabel",defaultMessage:"Upgrade to Plus Plan",description:"Shown as an upsell to plus plan if user wants space permission settings."})}),n()(J.Z,{size:48}))}renderDesktopMemberList(e){const{spacePermissionsSettingsStore:t}=this.stores,{membersFilter:s,limitMembers:i}=t.state,r=this.getFilteredMembers(e,s),o=this.sortUsers("members",r),a=i?o.slice(0,Ot.defaultLimit):o;return n()(d.Fragment,{},void 0,n()("div",{style:{marginRight:8,flexGrow:1}},void 0,n()(We.Z,{},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.spaceMembers.members.title",defaultMessage:"Members"}))),this.renderInviteViaDomainCaption(),n()(J.Z,{size:16,isHidden:!0}),n()("div",{},void 0,n()("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}},void 0,this.renderInviteButton(),n()($.Z,{placeholder:this.props.intl.formatMessage({id:"spacePermissionsSettings.membersTab.filterMembersInput.placeholder",defaultMessage:"Filter by email or name…"}),left:c.Z.searchThick(this.getSearchIconStyle()),showClearButton:!0,format:$.Z.Format.Small,value:s,style:Ot.filterStyle,onChange:e=>{t.setState({...t.state,membersFilter:e.target.value,limitMembers:!0})}})),this.renderUserTable("members",a),o.length>Ot.defaultLimit&&i&&n()(se.Z,{style:Ot.showMoreButtonStyle,onClick:this.handleMembersShowMoreClick},void 0,n()(v.FormattedMessage,{defaultMessage:"Show {moreMembersCount} more",id:"spacePermissionsSettings.membersTab.showMore.message",values:{moreMembersCount:o.length-Ot.defaultLimit}}))))}renderSpaceGuests(e){const{spacePermissionsSettingsStore:t}=this.stores,{guestsFilter:s,limitGuests:i}=t.state,r=this.getFilteredMembers(e,s),o=this.sortUsers("guests",r),a=i?o.slice(0,Ot.defaultLimit):o;return n()("div",{},void 0,n()("div",{},void 0,n()("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}},void 0,n()($.Z,{placeholder:this.props.intl.formatMessage({id:"spacePermissionsSettings.membersTab.filterGuestsInput.placeholder",defaultMessage:"Filter by email or name…"}),left:c.Z.searchThick(this.getSearchIconStyle()),showClearButton:!0,format:$.Z.Format.Small,value:s,style:Ot.filterStyle,onChange:e=>{t.setState({...t.state,guestsFilter:e.target.value,limitGuests:!0})}})),this.renderUserTable("guests",a),o.length>Ot.defaultLimit&&i&&n()(se.Z,{style:Ot.showMoreButtonStyle,onClick:this.handleGuestsShowMoreClick},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.membersTab.showMoreGuestsButton.label",defaultMessage:"{numberOfHiddenGuests, plural, one {Show {numberOfHiddenGuests} more} other {Show {numberOfHiddenGuests} more}}",values:{numberOfHiddenGuests:o.length-Ot.defaultLimit}}))))}renderMobileInviteButton(){return n()(d.Fragment,{},void 0,n()("div",{style:this.mobileMenuItemStyle()},void 0,this.renderInviteButton({flex:1})),n()("div",{style:{borderBottom:`1px solid ${this.theme.regularDividerColor}`}}))}renderInviteButton(e){const{store:t}=this.props;return t.canEditMembership()||t.getDisableMembershipRequests()||!(0,P.p1)(this.environment)?n()(_.LazyPermissionsInviteWithModal,{disabled:!this.canEditMembership(),store:t,onInviteClick:this.handleUpdateClick,onInviteComplete:this.handleUpdateComplete,isSubscribed:this.isSubscribed(),membersOnly:!1,upgradeButtonName:"space_permission_settings",shouldGrow:!1,buttonStyle:e}):n()(Ve.Z,{store:t,analyticsFrom:"space_settings_add_members",origin:n()(j.Z,{isLarge:!0},void 0,n()(v.FormattedMessage,{id:"inviteUserButton.requestMemberLabel",defaultMessage:"Add members",description:"Button to invite new users to the workspace."}))})}renderInviteViaDomainCaption(){const{store:e}=this.props;return T.LV(e)?n()(oe.Z,{isSmall:!0,isMultiline:!0,style:{width:"80%"}},void 0,n()(v.FormattedMessage,{id:"spaceBasicSettings.membersTab.manageMembersWithLinkCaption",defaultMessage:"Manage members here."})):n()("div",{},void 0,n()(oe.Z,{isSmall:!0,isMultiline:!0,style:{width:"80%",marginBottom:6}},void 0,n()(v.FormattedMessage,{id:"spaceBasicSettings.membersTab.manageMembersWithoutLinkCaption",defaultMessage:"Manage members here, or <setupdomainlink>set up a domain</setupdomainlink>, so everyone with allowed email domains can join the workspace automatically.",values:{setupdomainlink:e=>n()(we.Z,{onClick:()=>{K.Z.setState({...K.Z.state,currentTab:"settings",defaultSubtab:void 0})}},void 0,e)}})),n()(oe.Z,{isSmall:!0,isMultiline:!0,style:{width:"80%"}},void 0,n()(v.FormattedMessage,{id:"spaceBasicSettings.membersTab.payPerMemberCaption",defaultMessage:"Note: you will be charged for each member added. Visit <billingguidelink>our guide</billingguidelink> for more information on how we bill.",values:{billingguidelink:e=>n()(we.Z,{href:(0,B.UY)("guides.billingGuide")},void 0,e)}})))}getFilteredMembers(e,t){const{store:s}=this.props;return t&&t.length>0?(0,m.ZP)(t,e,(e=>{const t=E.U6.createChildStore(s,{table:h.KJ,id:e.userId});return t.isDefined()?(0,h.of)({name:t.getName(),email:t.getEmail()}):""})):e}sortUsers(e,t){const s=this.stores.spacePermissionsSettingsStore.state.sorts[e];if(!s)return t;const{store:i}=this.props;switch(s.by){case"role":return t.sort(((e,t)=>(p.xm[t.role]-p.xm[e.role])*(s.asc?-1:1)));case"name":return t.map((e=>({user:e,store:E.U6.createChildStore(i,{table:h.KJ,id:e.userId})}))).sort(((e,t)=>{const i=e.store.getValue(),r=t.store.getValue(),o=(0,h.Nz)(this.props.intl,i),n=(0,h.Nz)(this.props.intl,r);return o.localeCompare(n)*(s.asc?1:-1)})).map((e=>e.user))}}renderSmallArrow(e){const{up:t}=e,s={width:10,height:10,marginLeft:4};return t?c.Z.arrowDownSmall({...s,transform:"rotate(180deg)"}):c.Z.arrowDownSmall(s)}renderUserTable(e,t){const{store:s}=this.props,i=this.stores.spacePermissionsSettingsStore.state.sorts[e],r={key:"user",header:n()(Q.Z,{disabled:!1,ignoreLocalHoverState:!0,onClick:()=>{this.handleSortClick(e,"name")},style:{display:"flex",alignItems:"center"}},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.userTable.userColumn.header",defaultMessage:"User"}),i&&"name"===i.by&&this.renderSmallArrow({up:i.asc})),style:{width:"60%"}},o={key:"teams",header:n()(Q.Z,{disabled:!1,ignoreLocalHoverState:!0,style:{display:"flex",alignItems:"center",paddingLeft:8}},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.userTable.teamsColumn.header",defaultMessage:"Teamspaces",description:"Label for a column shows the teamspaces that a user is part of."})),style:{width:"20%",textAlign:"center"},sortable:!1},a={key:"access_level",header:n()(Q.Z,{disabled:!1,ignoreLocalHoverState:!0,onClick:()=>{this.handleSortClick(e,"role")},style:{display:"flex",alignItems:"center",paddingLeft:8}},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.userTable.accessLevelColumn.header",defaultMessage:"Access level"}),i&&"role"===i.by&&this.renderSmallArrow({up:i.asc})),style:{width:"20%",textAlign:"center"}},l="members"===e&&(0,U.bq)()?[r,o,a]:[r,a];return n()(Be.Z,{columns:l,rows:t.map((e=>({member:e,store:E.U6.createChildStore(s,{table:h.KJ,id:e.userId})}))).filter((e=>void 0!==e.store.getValue())).map((t=>{const{member:s,store:i}=t,r=i.getValue(),o=[this.renderMember(r)];return"members"===e&&(0,U.bq)()&&o.push(d.createElement(d.Fragment,null,this.renderTeams(s))),o.push(d.createElement(d.Fragment,null,this.renderUserPermission(s,i))),{key:s.userId,columns:o}}))})}renderMember(e){return n()(H.Z,{userValue:e})}renderTeams(e){if("none"!==e.role)return n()(Dt.Z,{member:e})}renderUserPermission(e,t){return"none"===e.role?n()(Me,{store:this.props.store,guest:e,guestStore:t,isSubscribed:this.isSubscribed()}):this.renderMemberRoleSelect(e)}renderMemberRoleSelect(e){const t=this.environment.currentUser.id,{currentUserSettingsStore:s}=A.default.state;if(!s)return;const i=this.getAvailableRoleItems();let r=!0;return(this.canAdmin()||this.canEditMembership()&&(p.RN(e.role)||e.userId===t))&&(r=!1),n()(ke.Z,{role:e.role,table:g.bx,type:"user_permission",disabled:r,isUserPermission:e.userId===t,isSubscribed:this.isSubscribed(),upgradeButtonName:"space_permission_item",onChange:t=>this.handleMemberPermissionRoleChange(e,t,s),availableRoleItems:i})}renderReprovisioning(){return d.createElement(d.Fragment,null,n()(oe.Z,{isMultiline:!0,style:{width:"80%"}},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.reprovisioningTab.workspaceOwner.caption",defaultMessage:"View users that were previously part of the workspace in the past 30 days. Only workspace owners can see this.",description:"Description that shows on the transfer content tab in settings"})),n()(oe.Z,{isMultiline:!0,style:{width:"80%"}},void 0,n()(v.FormattedMessage,{id:"spacePermissionsSettings.reprovisioningTab.workspaceOwner.caption.disclaimer",defaultMessage:"Note: only users who had private pages will appear here.",description:"Disclaimer that shows under the caption describing the reprovisioning tab in the members panel in settings."})),n()(J.Z,{size:24,isHidden:!0}),n()(ee.Z,{requestStore:this.stores.getRecoverableSpaceUserContentRequestStore,request:{spaceId:this.props.store.id},performRequest:async e=>{const t=await M.getRecoverableSpaceUserContent(this.environment,{spaceId:e.spaceId});if("failed"===t.type)throw w.showError(t),t;return t.data},render:this.renderReprovisioningData}))}renderRequestsTab(){return n()(De,{spaceStore:this.props.store,accessRequestsStore:this.stores.accessRequestsStore})}renderNumberOfRequests(){return n()(ee.Z,{throttle:1e3,request:{parentTable:"space",parentId:this.props.store.id,size:100,status:"pending"},requestStore:this.stores.accessRequestsStore,performRequest:async e=>{const t=await M.getAccessRequests(this.environment,e);if("failed"===t.type)throw t.error;const s=t.data.accessRequestIds;return(0,S.Tr)(this.props.store,s)},render:(e,t,s)=>e||!t?n()("span",{}):t?n()("span",{},void 0," ","(",t.filter((e=>"pending"===e.accessRequestStore.getKeyStore("status").getValue())).length,")"):void 0})}setInitialSubtabOnMount(){K.Z.state.open&&"members"===K.Z.state.currentTab&&K.Z.state.defaultSubtab&&(this.stores.spacePermissionsSettingsStore.setState({...this.stores.spacePermissionsSettingsStore.state,currentTab:K.Z.state.defaultSubtab}),K.Z.setState({...K.Z.state,defaultSubtab:void 0}))}getAvailableRoleItems(){const e=this.props.intl.formatMessage({id:"spacePermissionSettings.memberRoleSelect.permissionitem.roleUpgradeDisabled",defaultMessage:"Cannot upgrade to a higher role than member",description:"Tooltip shown over disabled role upgrades"}),t=(0,F.U7)();return l().compact(p.an.map((s=>{if(t||"membership_admin"!==s)return{role:s,disabledInfo:!this.canAdmin()&&p.Bc(s)?{isDisabled:!0,disabledMessage:e}:void 0}})))}getCurrentTabs(e){return[V.Q.Members,V.Q.Groups,...e.length>0?[V.Q.Guests]:[],...this.canReprovisionContent()?[V.Q.Reprovisioning]:[],...this.shouldShowRequestsTab()?[V.Q.Requests]:[]]}isSubscribed(){const{data:e}=N.default.state;return Boolean(e&&q.YK(e))}canAdmin(){return this.props.store.canAdmin()}canEditMembership(){return this.props.store.canEditMembership()}canUseGroups(){return q.qF(this.environment)&&this.isSubscribed()}canEditGroups(){return this.canUseGroups()&&this.canEditMembership()}canUseInviteLink(){return this.canEditMembership()&&q.qF(this.environment)}canReprovisionContent(){return this.canAdmin()&&G.wP()&&"on"===D.default.getGroup("content-reprovisioning")}shouldShowRequestsTab(){return this.canEditMembership()&&(0,P.p1)(this.environment)}shouldRenderUpsell(){return Boolean("personal"===this.props.store.getPlanType()&&this.canAdmin())}getInviteLinkEnabled(){return Boolean(this.props.store.getKeyStore("invite_link_enabled").getValue())}getInviteLink(){if(!this.canEditMembership())return;const e=N.default.state.data,t=this.props.store.id,s=e&&("subscribed_admin"===e.type||"unsubscribed_admin"===e.type||"subscribed_membership_admin"===e.type)&&e.inviteLinkCode;return s?(0,x.createSpaceInviteLinkUrl)(this.environment,t,s):void 0}getSearchIconStyle(){return{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,fill:this.theme.mediumIconColor}}mobileMenuItemStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",paddingTop:14,paddingBottom:14,paddingLeft:14,paddingRight:e.getSafePaddingRightCSS(14),background:this.theme.cardContentBackground}}}Ot.defaultLimit=50,Ot.filterStyle={maxWidth:275,borderRadius:30},Ot.showMoreButtonStyle={marginTop:8};const Vt=(0,v.injectIntl)(Ot)},88775:(e,t,s)=>{s.d(t,{Z:()=>P});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(480),d=s(16489),u=s(24405),m=s(53397),c=s(5366),p=s(33929),g=s(60709),h=s(33846),b=s(48690),f=s(30397),v=s(48019),S=s(52275),y=s(31945),M=s(68894),C=s(78140),w=s(91941),k=s(72495),R=s(64369),T=s(93686);const Z=(0,c.defineMessages)({filterTeams:{defaultMessage:"Filter teamspaces…",id:"teamsDropdownForMember.filterForTeams.placeholder",description:"Placeholder text for filtering teamspaces within a group."}});function I(e){const t=(0,l.O7)(),s=(0,u.y)((()=>({teamMenuItem:{fontWeight:400,maxWidth:180}})),[]),[i,o]=(0,d.oR)(void 0,h.Z),[,m]=(0,d.oR)(b.Z),f=(0,a.useCallback)((e=>{m((t=>({...t,open:!0,tab:b.a.Members,selectedTeamId:e})))}),[m]),y=(0,d.VK)((()=>[{key:"teams for member",render:e=>a.createElement(k.Z,e),actions:e.teamStores.map((e=>({key:e.id,displayName:e.getName(),analyticsName:e.getName()||"team_unknown",searchName:e.getName(),render:t=>a.createElement(S.Z,r()({icon:n()(T.p,{disabled:!0,store:e}),title:n()(R.Z,{style:s.teamMenuItem},void 0,e.getName()),caption:n()(c.FormattedMessage,{defaultMessage:"{numMembers} {numMembers, plural, one {member} other {members}}",id:"teamsDropdownForMember.numMembers",description:"Number of members in a teamspace, displayed in a popup showing teamspaces that a member is part of.",values:{numMembers:e.getUserIdsInTeam().length}}),inline:!0},t)),action:()=>{f(e.id)},closeParentMenu:!1})))}]),[e.teamStores,s.teamMenuItem,f]),w=i.inputValue,I=n()(k.Z,{isInput:!0},void 0,n()(M.ZP,{value:w,onChange:(0,a.useCallback)((e=>{o({inputValue:e.target.value,focus:!1})}),[o]),focus:!0,focusAfterAnimation:!0,placeholder:p.default.formatMessage(Z.filterTeams)})),P={menuType:g.o.Popup,maxWidth:350,maxHeight:300,header:e.teamStores.length>5?I:void 0};return a.createElement(C.Z,P,n()(v.Z,{filter:w,context:{blocks:[],environment:t,publicEditMode:void 0},initialFocus:0,sections:y}))}const P=function(e){const[t]=(0,d.oR)(f.Z),s=(0,u.y)((e=>({button:{marginRight:8},noTeams:{marginRight:8,color:e.lightTextColor},chevron:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),i=(0,d.VK)((()=>t.teams.filter((t=>t.getMembers().some((t=>"user"===t.entity_type&&t.user_id===e.member.userId))))),[t,e.member]),o=i.length;return n()(y.Z,{popupType:y.Z.PopupType.Popup,renderOrigin:e=>a.createElement(w.Z,r()({disabled:0===o,style:0===o?s.noTeams:s.button},e),0===o?n()(c.FormattedMessage,{id:"teamsDropdownForMember.teamsCountNone.label",defaultMessage:"None",description:"Message to show a member is not part of any teamspaces."}):a.createElement(a.Fragment,null,n()(c.FormattedMessage,{id:"teamsDropdownForMember.teamsCount.label",defaultMessage:"{numberOfTeams, plural, one {{numberOfTeams} teamspace} other {{numberOfTeams} teamspaces}}",description:"Number of teamspaces that a member is part of.",values:{numberOfTeams:o}}),m.Z.chevronDown(s.chevron))),render:()=>n()(I,{member:e.member,teamStores:i})})}},69435:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(77094),r=s.n(i),o=(s(67294),s(83355)),n=s(82990),a=s(5366),l=s(50906),d=s(26111),u=s(93678),m=s(33665),c=s(42922),p=s(63296);class g extends o.Z{constructor(){super(...arguments),this.handleUpgradeClick=e=>{const{from:t,for:s,onUpgradeClick:i}=this.props;u.y(this.environment,{from:t,for:s}),i&&i(e)},this.handleLearnMoreClick=()=>{const{from:e,learnMoreRoute:t}=this.props;(0,d.navigateToExternalURL)({environment:this.environment,url:(0,m.UY)(t)}),l.trackClickHelpButton(this.environment,{from:e})}}renderComponent(){return r()("section",{style:this.getWrapStyle()},void 0,this.renderIcon(),this.renderTitle(),this.renderCaption(),this.renderActions())}renderIcon(){const{icon:e}=this.props;if(e)return e(this.getIconStyle())}renderTitle(){const{title:e}=this.props;return r()("header",{style:this.getTitleStyle()},void 0,e)}renderCaption(){const{caption:e}=this.props;return r()("p",{style:this.getCaptionStyle()},void 0,e)}renderActions(){return r()("footer",{},void 0,this.renderUpgradeButton(),this.renderLearnMoreButton())}renderUpgradeButton(){const{upgradeMessage:e}=this.props;return r()(c.Z,{onClick:this.handleUpgradeClick,isLarge:!0},void 0,e||r()(a.FormattedMessage,{defaultMessage:"Upgrade",id:"upsellCallout.upgradeButton.text"}))}renderLearnMoreButton(){return r()(p.Z,{onClick:this.handleLearnMoreClick,style:this.getLearnMoreButtonStyle()},void 0,r()(a.FormattedMessage,{defaultMessage:"Learn more",id:"upsellCallout.learnMoreButton.text"}))}getWrapStyle(){const{device:e}=this.environment;return{...this.props.style,fontSize:14,...!e.isMobile&&{maxWidth:340}}}getIconStyle(){return{width:32,height:"auto",fill:this.theme.mediumIconColor,marginBottom:8}}getTitleStyle(){return{fontWeight:n.Z.fontWeight.semibold}}getCaptionStyle(){return{color:this.theme.mediumTextColor,marginTop:4,marginBottom:16}}getLearnMoreButtonStyle(){return{marginLeft:12}}}const h=g},40394:(e,t,s)=>{s.d(t,{b:()=>h,D:()=>b});var i=s(77094),r=s.n(i),o=(s(85827),s(67294)),n=s(24405),a=s(53397),l=s(82990),d=s(45080),u=s(75024),m=s(97758),c=s(84787),p=s(91941),g=s(43145);function h(e){let{columnRenderInfo:t,theme:s,containerMarginTop:i}=e;return{container:{marginTop:null!=i?i:17,tableLayout:"fixed",borderCollapse:"collapse",width:"100%",minWidth:t.reduce(((e,t)=>e+k(t.widthData)+C),0)},tableHeaderRow:{borderTop:`1px solid ${s.tableDividerColor}`,borderBottom:`1px solid ${s.tableDividerColor}`},paddingRowCell:{height:8},firstColumn:{}}}function b(e){let{columnRenderInfo:t,sortState:s,onSortStateChanged:i,showRowBorders:a,hideHeaderRowPadding:l,renderRowChild:d,rows:u,onRowClick:m,renderNoRowsComponent:p,styles:h,getStyleForRow:b,multiselect:y,onScrollBottom:M,allowHorizontalScroll:C}=e;const[w,k]=(0,o.useState)(!1),R=(0,n.y)((e=>({horiztonalScrollContainer:{position:"relative",width:"100%"},scrollableContainer:{position:"relative",display:"grid",overflowX:"auto",width:"100%"},table:C?{...h.container,minWidth:"100%",width:void 0}:h.container})),[h.container,C]),T=(0,o.useCallback)((e=>{const t=e>10;!w&&t?k(!0):w&&!t&&k(!1)}),[w]),Z=(0,o.useCallback)((e=>{var t;if(!s)return;const r=e.id===(null===(t=s.column)||void 0===t?void 0:t.id)&&!s.sortAscending;i&&i({sortAscending:r,column:e})}),[s,i]),I=o.createElement(o.Fragment,null,r()("table",{style:R.table},void 0,r()("tr",{style:h.tableHeaderRow},void 0,t.map(((e,t)=>r()(v,{index:t,column:e,sortState:s,handleSortableColumnClick:Z,shouldShowSortIcon:0!==u.length,multiselect:y,allowHorizontalScroll:C,style:0===t?h.firstColumn:void 0},`header_${e.id}`)))),!l&&r()("tr",{},void 0,t.map((e=>r()("td",{style:h.paddingRowCell},`padding_row_${e.id}`)))),u.map((e=>r()(S,{columns:t,onRowClick:m,rowChild:null==d?void 0:d(e),showRowBorders:a,row:e,getStyleForRow:b,multiselect:y,allowHorizontalScroll:C,firstColumnStyle:h.firstColumn},`${e.id}_row`))),!C&&M&&r()(c.Z,{loading:!1,loadMoreOffsetThreshold:100,onLoadMore:M})),0===u.length&&p());return C?r()("div",{style:R.horiztonalScrollContainer},void 0,r()("div",{style:R.scrollableContainer},void 0,I,r()(g.Z,{horiztonal:!0,onChange:T})),r()(f,{hide:!w}),M&&r()(c.Z,{loading:!1,loadMoreOffsetThreshold:100,onLoadMore:M})):I}function f(e){let{hide:t}=e;const s=(0,n.y)((e=>({container:{position:"absolute",right:0,top:0,bottom:0,width:32,boxShadow:`inset -15px 0px 13px 0px ${e.modalBackground}`,opacity:t?0:1,transition:"opacity 200ms ease"}})),[t]);return r()("div",{style:s.container})}function v(e){let{column:t,index:s,sortState:i,handleSortableColumnClick:o,shouldShowSortIcon:d,multiselect:u,allowHorizontalScroll:c,style:g}=e;const h=0===s,b=1===s,f=(0,n.y)((e=>({th:{...R(t),...c&&h&&{position:"sticky",zIndex:2,left:0,background:e.modalBackground,boxShadow:`inset -1px 0px 0px ${e.tableDividerColor}`,paddingRight:15},...c&&b&&{paddingLeft:15},height:32,...g},innerDiv:{display:"flex",alignItems:"center",height:"100%",minWidth:k(t.widthData),maxWidth:t.widthData.maxWidth},text:{fontSize:l.Z.fontSize.UISmall.desktop,fontWeight:l.Z.fontWeight.regular,color:e.mediumTextColor,...l.Z.textOverflowStyle},sortButton:{padding:5,margin:-5},sortIcon:{color:e.mediumTextColor,width:12,height:12,marginLeft:4,fill:"currentColor"},multiselectCheckbox:{color:e.selectLightGray[300],marginRight:16,opacity:null!=u&&u.header.isDisabled?.5:1}})),[t,u,c,g,h,b]),v=r()("div",{style:f.text},void 0,t.headerTitle),S=t.sortable?r()(p.Z,{style:f.sortButton,onClick:()=>o(t)},void 0,v,(()=>{if(i&&d&&t.id===i.column.id)return a.Z.arrowDownSmall({...f.sortIcon,...i.sortAscending&&{transform:"rotate(180deg)"}})})()):v,y=void 0!==u&&0===s?r()(m.Z,{style:f.multiselectCheckbox,disabled:u.header.isDisabled,onClick:()=>u.header.onClick(),checked:u.header.isSelected,size:14}):null;return r()("th",{style:f.th},void 0,r()("div",{style:f.innerDiv},void 0,y,S))}function S(e){let{row:t,columns:s,onRowClick:i,rowChild:a,showRowBorders:l,getStyleForRow:d,allowHorizontalScroll:u,multiselect:m,firstColumnStyle:c}=e;const[p,g]=(0,o.useState)(!1),h=t.isClickable,b=(0,o.useCallback)((()=>g(!0)),[]),f=(0,o.useCallback)((()=>g(!1)),[]),v=(0,o.useCallback)((e=>{h&&void 0!==i&&M(e,(()=>i(t.id)))}),[h,i,t.id]),S=(0,n.y)((e=>({row:{height:1,...h&&{cursor:"pointer"},...l&&{borderBottom:`1px solid ${e.tableDividerColor}`},...d&&d(t)}})),[h,l,d,t]);return o.createElement(o.Fragment,null,r()("tr",{onMouseLeave:f,onMouseEnter:b,style:S.row,onClick:v},void 0,s.map(((e,i)=>r()(y,{isRowHovered:p,isRowClickable:h,columnIndex:i,numColumns:s.length,data:t,column:e,multiselect:m,allowHorizontalScroll:u,cellStyle:0===i?c:void 0},`cell_${t.id}_${e.id}`)))),a&&r()("tr",{style:S.row},void 0,r()("td",{colSpan:s.length},void 0,a)))}function y(e){let{data:t,column:s,columnIndex:i,numColumns:o,isRowHovered:a,isRowClickable:d,multiselect:c,allowHorizontalScroll:p,cellStyle:g}=e;const h=0===i,b=1===i,f=i===o-1,v=(0,n.y)((e=>({td:{...R(s),height:"inherit",...h&&{borderRadius:(0,u.wK)({topLeft:3,bottomLeft:3})},...f&&{borderRadius:(0,u.wK)({topRight:3,bottomRight:3})},...p&&h&&{position:"sticky",zIndex:2,left:0,background:e.modalBackground,boxShadow:`inset -1px 0px 0px ${e.tableDividerColor}`,paddingRight:15},...p&&b&&{paddingLeft:15},...a&&d&&{background:e.buttonHoveredBackground},...g},innerDiv:{minWidth:k(s.widthData),maxWidth:s.widthData.maxWidth,fontSize:l.Z.fontSize.UIRegular.desktop,color:e.regularTextColor,minHeight:42,display:"flex",alignItems:"center",height:"100%"},multiselectCheckbox:{color:e.selectLightGray[300],marginRight:16,opacity:null!=c&&c.row.getDisabledState(t)?.5:1}})),[s,h,b,f,a,d,c,t,p,g]),S=Boolean(s.hasClickableContents),y=c&&h?r()(m.Z,{style:v.multiselectCheckbox,checked:c.row.getSelectedState(t),onClick:()=>c.row.onClick(t),disabled:c.row.getDisabledState(t),size:14}):null;return r()("td",{style:v.td},void 0,r()("div",{style:v.innerDiv,onClick:S?M:void 0},void 0,y,s.renderCell({...t,isRowHovered:a})))}const M=(e,t)=>{(0,d.ZP)({event:e,context:d.Af.BaseTableRowClick,callback:t})},C=10,w={paddingLeft:C/2,paddingRight:C/2};function k(e){return"minWidth"in e?e.minWidth:e.width}function R(e){let t;return t="width"in e.widthData?{width:e.widthData.width}:{width:`${e.widthData.widthPercent}%`,minWidth:e.widthData.minWidth},{...w,...t}}},22368:(e,t,s)=>{s.d(t,{B:()=>d});var i=s(77094),r=s.n(i),o=s(67294),n=s(53397),a=s(26825),l=s(5366);function d(e){const{style:t}=e;return r()("span",{style:{display:"flex",alignItems:"center",...t}},void 0,n.Z.globe2({width:14,fill:"#CF8807",display:"inline",verticalAlign:"middle",marginRight:1}),r()("span",{style:{color:"#CF8807",fontWeight:500}},void 0,o.createElement(l.FormattedMessage,a.mq.guestLabel)))}},83890:(e,t,s)=>{s.d(t,{Z:()=>M});var i=s(97464),r=s.n(i),o=s(77094),n=s.n(o),a=s(67294),l=s(83355),d=s(66897),u=s(53397),m=s(19889),c=s(5366),p=s(31299),g=s(14133),h=s(92864),b=s(93044),f=s(255),v=s(97680),S=s(98707);class y extends l.Z{constructor(){super(...arguments),this.renderFilterListItem=(e,t)=>{let{disabled:s,onRemove:i,onClick:r}=t;const o=this.styles,a=this.getUserValue(e),l=n()(f.Z,{disabled:s,onClick:i});return n()(v.Z,{disabled:s,focused:!1,user:a,right:l,style:o.menuItem,desktopTitleStyle:o.menuItemTitle,onClick:r},e)},this.renderItemForSummary=e=>(0,m.Nz)(this.props.intl,this.getUserValue(e)),this.renderToken=(e,t)=>{const{userIds:s}=this.props,i=1===s.length,r=this.getUserValue(e);if(r)return n()(h.ZP,{format:this.environment.device.isMobile?b.Z.Format.Large:b.Z.Format.Small,showRemoveButton:!0,isSingle:i,onClickRemove:t.onRemove,actor:(0,d.m3)(r),shouldShrink:!0,backgroundColor:"transparent"},e)},this.renderResultMenuItem=(e,t)=>{const s=this.getUserValue(e);return a.createElement(v.Z,r()({},t,{key:e,user:s}))},this.performRequest=async e=>{let{query:t,current:s}=e;const i=new Set(s);return(await p.O$({environment:this.environment,query:t,membersOnly:!1})).filter((e=>!i.has(e.id))).slice(0,20).map((e=>e.id))},this.getUserValue=e=>this.createUserStore(e).getValue(),this.createUserStore=e=>{const{parentStore:t}=this.props;return g.U6.createChildStore(t,{table:m.KJ,id:e})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:2,fill:"currentColor"}}}renderComponent(){const{mode:e,title:t,userIds:s,onChange:i,disabled:r,focused:o,onMenuDismiss:a,intl:l}=this.props;return n()(S.Z,{mode:e,title:t,icon:u.Z.person,iconStyles:this.styles.recordIcon,items:s,onChange:i,disabled:r,focused:o,renderFilter:this.renderFilterListItem,renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:n()(c.FormattedMessage,{defaultMessage:"Add a person",id:"search.filterMenu.addAPersonButton.label"}),labelText:{title:t,tokenInputPlaceholder:l.formatMessage({defaultMessage:"Search people",id:"search.filterMenu.searchPeople.placeholder"}),componentDebugName:"SearchPersonFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,onMenuDismiss:a,hasItemsSelected:(null==s?void 0:s.length)>0})}}const M=(0,c.injectIntl)(y)},53680:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(49085);class r extends i.Z{getInitialState(){return{disablePublicAccess:!1,disableGuests:!1,disableMoveToSpace:!1,disableExport:!1,disableSpacePageEdits:!1,disablePublicAccessRequests:!1,disablePersonalBots:!1,disableTeamCreation:!1,disableMembershipRequests:!1,disableGuestMembershipRequests:!1,enableAiFeature:!1}}getValueForSpace(e){if(e.isDefined())return{disablePublicAccess:Boolean(e.getDisablePublicAccess()),disableGuests:Boolean(e.getDisableGuests()),disableMoveToSpace:Boolean(e.getDisableMoveToSpace()),disableExport:Boolean(e.getDisableExport()),disableSpacePageEdits:Boolean(e.getDisableSpacePageEdits()),disablePublicAccessRequests:Boolean(e.getDisablePublicAccessRequests()),disablePersonalBots:Boolean(e.getKeyStore("bot_settings").getKeyStore("disable_personal_bots").getValue()),disableTeamCreation:Boolean(e.getDisableTeamCreation()),disableMembershipRequests:Boolean(e.getKeyStore("settings").getKeyStore("disable_membership_requests").getValue()),disableGuestMembershipRequests:Boolean(e.getKeyStore("settings").getKeyStore("disable_guest_membership_requests").getValue()),enableAiFeature:Boolean(e.getKeyStore("settings").getKeyStore("enable_ai_feature").getValue())}}}const o=r},98905:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(49085);class r extends i.Z{getInitialState(){return{count:0}}}const o=new r}}]);