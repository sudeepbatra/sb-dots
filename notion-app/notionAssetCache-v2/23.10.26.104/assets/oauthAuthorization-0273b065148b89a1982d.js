"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[3370],{61695:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Pe});var o=i(77094),a=i.n(o),n=(i(85827),i(67294)),s=i(480),r=i(16489),l=i(24405),d=i(63123),c=i(15070),p=i(8848),u=i(59054),g=i(74181),m=i(56589),h=i(4615),v=i(77420),f=i(9844),b=i(19889),w=i(90965),y=i(97880),S=i(82990),A=i(26111),k=i(29974),M=i(21325),I=i(71935),x=i(38755),P=i(21115),N=i(27832),_=i(10161),C=i(14133),T=i(62213),z=i(78291),F=i(12318),V=i(3403),Z=i(53397),L=i(5366),B=i(82036),W=i(36110),E=i(42922),O=i(63296),R=i(42402);function U(e){const{integrationValue:t,oauthParams:i}=e,o=(0,s.O7)(),{oauthErrorType:n,title:r,body:d,primaryAction:c}=function(e){const t=a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.genericError.title",defaultMessage:"Something went wrong"});if("invalidClientId"===e.type)return{oauthErrorType:B._.invalid_request,title:t,body:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.invalidClientId.body",defaultMessage:"Missing or incomplete Client ID. See <inlinetextlink>developer docs</inlinetextlink> for more help.",values:{inlinetextlink:e=>a()(R.Z,{href:"https://developers.notion.com/#handling-errors"},void 0,e)}})};if("clientNotFound"===e.type)return{oauthErrorType:B._.invalid_request,title:t,body:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.clientNotFound.body",defaultMessage:"Missing or incomplete Client ID. See <inlinetextlink>developer docs</inlinetextlink> for more help.",values:{inlinetextlink:e=>a()(R.Z,{href:"https://developers.notion.com/#handling-errors"},void 0,e)}})};if("invalidResponseType"===e.type)return{oauthErrorType:B._.invalid_request,title:t,body:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.invalidResponseType",defaultMessage:"Missing or invalid response_type. See <inlinetextlink>developer docs</inlinetextlink> for more help.",values:{inlinetextlink:e=>a()(R.Z,{href:"https://developers.notion.com/#handling-errors"},void 0,e)},description:"Do not translate 'response_type', it's code."})};if("integrationAlreadyInstalled"===e.type)return{oauthErrorType:B._.access_denied,title:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.integrationAlreadyInstalled.title",defaultMessage:"This integration has already been added to {workspaceName}",values:{workspaceName:e.spaceName}}),body:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.integrationAlreadyInstalled.body",defaultMessage:"You can review and remove added integrations in Settings."}),primaryAction:{onClick:e.primaryAction,title:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.integrationAlreadyInstalled.openWorkspaceSettingsButton.label",defaultMessage:"Open Settings"})}};if("notAnAdmin"===e.type)return{oauthErrorType:B._.access_denied,title:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.notAnAdmin.title",defaultMessage:"You're not allowed to add integrations to {workspaceName}",values:{workspaceName:e.spaceName}}),body:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.notAnAdmin.body",defaultMessage:"Contact an admin to grant you access, or switch to another workspace."}),primaryAction:{onClick:e.primaryAction,title:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.notAnAdmin.switchWorkspaceButton.label",defaultMessage:"Switch workspace"})}};if("integrationNotApproved"===e.type)return{oauthErrorType:B._.access_denied,title:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.integrationNotApproved.title",defaultMessage:'You are not permitted to add the integration "{integrationName}" to {workspaceName}',values:{integrationName:e.integrationValue.name,workspaceName:e.spaceName}}),body:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.integrationNotApproved.body",defaultMessage:"Contact your system administrator for more information."}),primaryAction:{onClick:e.primaryAction,title:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.notAnAdmin.switchWorkspaceButton.label",defaultMessage:"Switch workspace"})}};if("invalidRedirectUri"===e.type)return{oauthErrorType:B._.invalid_request,title:t,body:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.invalidRedirectUri.body",defaultMessage:"Missing or invalid redirect_uri. See <inlinetextlink>developer docs</inlinetextlink> for more help.",values:{inlinetextlink:e=>a()(R.Z,{href:"https://developers.notion.com/#handling-errors"},void 0,e)},description:"Do not translate 'redirect_uri', it's code."})};(0,y.t1)(e.type)}(e),u=function(){const{isMobile:e}=(0,s.Fy)(),t=e?25:48,i=e?18:20;return(0,l.y)((()=>({container:{textAlign:"center",flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},icon:{fill:p.ZP.red,width:t,height:t,marginBottom:20,display:"inline-block"},title:{fontSize:i,margin:"0 50px 32px",textAlign:"center",fontWeight:S.Z.fontWeight.medium,marginBottom:12},body:{marginTop:0,marginBottom:24,width:"80%"}})),[t,i])}();return a()("section",{style:u.container},void 0,Z.Z.genericError(u.icon),a()("header",{style:u.title},void 0,r),a()("p",{style:u.body},void 0,d),c&&a()("div",{style:u.body},void 0,a()(E.Z,{isLarge:!0,onClick:c.onClick},void 0,c.title)),a()(O.Z,{onClick:()=>{W.VW({environment:o,integration:t,errorType:n,params:i})}},void 0,a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.cancelButton.label",defaultMessage:"Cancel"})))}var D=i(97464),K=i.n(D),j=i(26825),G=i(50906),Y=i(92625),H=i(31278),q=i(67669),$=i(44005);function J(e){const{integrationValue:t,validIntegrationTemplateId:i,botAccessOption:o,setBotAccessOption:s}=e,[{value:r}]=(0,u.r5)((async()=>!!i&&await(0,q.JI)(i)),[i]);n.useEffect((()=>{s(r?"duplicate_template":"pick_pages")}),[r,s]);const d=(0,l.y)((()=>({container:{display:"grid",gridTemplateRows:"1fr 1fr",gap:8,marginTop:8},icon:{fill:p.ZP.red,width:20,height:20,marginRight:12},errorContainer:{display:"flex",alignItems:"center"}})),[]);return a()("div",{style:d.container},void 0,a()(Q,{disabled:!r,title:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.botAccessOption.useTemplate.title",defaultMessage:"Use a template provided by the developer",description:"The user will select this option if they want to duplicate a template when installing an integration."}),subtitle:r?a()(L.FormattedMessage,{id:"oauthAuthorizationPage.botAccessOption.useTemplate.subtitle",defaultMessage:"{integrationName} will duplicate this template into the Private pages of your workspace. The integration will then be able to {capabilities} content in this new page.",description:"Explains what will happen when a user decides to duplicate a template when installing an integration.",values:{capabilities:a()(L.FormattedList,{value:(0,$.O)(t.capabilities),type:"conjunction"}),integrationName:t.name}}):a()("div",{style:d.errorContainer},void 0,a()("div",{},void 0,a()(L.FormattedMessage,{id:"oauthAuthorizationPage.error.invalidTemplate.body",defaultMessage:"The page template is no longer public. <inlinetextlink>Contact the developer</inlinetextlink> for more help.",values:{inlinetextlink:t=>a()(R.Z,{href:`mailto:${e.integrationValue.info.email}`},void 0,t)},description:"This error message appears when a user tries to install an integration with a template but the template is invalid."}))),icon:Z.Z.pageAdd,isSelected:"duplicate_template"===o,selectOption:()=>s("duplicate_template")}),a()(Q,{title:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.botAccessOption.pickPages.title",defaultMessage:"Select pages to share with {integrationName}",description:"The user will select this option if they want to give bot access to existing pages.",values:{integrationName:t.name}}),subtitle:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.botAccessOption.pickPages.subtitle",defaultMessage:"Select one or multiple pages to share with {integrationName}",description:"Explains what will happen when a user decides to give bot access to existing pages.",values:{integrationName:t.name}}),icon:Z.Z.taskList,isSelected:"pick_pages"===o,selectOption:()=>s("pick_pages")}))}function Q(e){const{title:t,subtitle:i,icon:o,isSelected:n,selectOption:s,disabled:r}=e,d=(0,l.y)((e=>({button:{height:"none",padding:12,width:"100%",borderWidth:1,borderColor:e.outlineButtonBorder,borderRadius:4,cursor:r?"not-allowed":void 0},buttonSelected:{background:"white",borderWidth:2,borderColor:p.ZP.blue,padding:11,boxShadow:"0px 4px 8px rgba(66, 129, 219, 0.09), 0px 0px 2px rgba(0, 0, 0, 0.06), 0px 0px 1px rgba(0, 0, 0, 0.04)"},option:{width:"100%",whiteSpace:"normal",display:"grid",gridTemplateColumns:"min-content auto min-content",padding:6},text:{overflowWrap:"normal"},title:{fontSize:14,fontWeight:S.Z.fontWeight.medium,color:p.ZP.frontTextMedium,marginBottom:6},subtitle:{fontSize:12,lineHeight:"140%",color:e.mediumTextColor},icon:{width:14,height:14,color:p.ZP.regularIconColor,marginRight:12}})),[r]);return a()(O.Z,{onClick:s,style:d.button,hovered:n,hoveredStyle:d.buttonSelected,pressedStyle:d.buttonSelected,disabled:r},void 0,a()("div",{style:d.option},void 0,o(d.icon),a()("div",{style:d.text},void 0,a()("div",{style:d.title},void 0,t),a()("div",{style:d.subtitle},void 0,i))))}var X=i(11106);function ee(e){const{integrationValue:t,selectedBlockIdsStore:i}=e,o=(0,l.y)((()=>({subtitle:{fontSize:14,textAlign:"center",fontWeight:S.Z.fontWeight.medium,marginBottom:16}})),[]);return n.createElement(n.Fragment,null,a()("div",{style:o.subtitle},void 0,a()(L.FormattedMessage,{id:"oauthAuthorizationPage.selectPagesStep.title",defaultMessage:'Allow "{integrationName}" to access these pages',values:{integrationName:t.name}})),a()(X.Z,{selectedBlockIdsStore:i}))}function te(e){var t,i,o,s,r,d,c,p,u;const{integrationValue:g,spaceName:m}=e,h=g.info.website_url,v=(0,j.FD)(g.capabilities),f=(0,l.y)((()=>({inlineTextLink:{color:"black",textDecoration:"none"}})),[]);return n.createElement(n.Fragment,null,a()("div",{},void 0,a()(L.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.intro",defaultMessage:"<inlinetextlink>{integrationName}</inlinetextlink> will have permission to",values:{integrationName:g.name,inlinetextlink:e=>h?a()(R.Z,{href:h,style:f.inlineTextLink},void 0,e):e}})),(null===(t=g.capabilities)||void 0===t?void 0:t.read_content)&&a()(ie,{icon:Z.Z.eye,title:a()(L.FormattedMessage,v?{id:"oauthAuthorizationPage.permissionStep.permissionListItem.readContentWithInheritedAccess",defaultMessage:"View pages you have access to",description:"Title for a bot permission that allows the bot to view whatever pages its installing user can view."}:{id:"oauthAuthorizationPage.permissionStep.permissionListItem.readContent",defaultMessage:"View pages you select",description:"This is one of the things an integration can do once it's added to a user's workspace."})},void 0,a()(L.FormattedMessage,v?{id:"oauthAuthorizationPage.permissionStep.permissionListItem.readContentWithInheritedAccess.description",defaultMessage:'"{integrationName}" will be able to view pages you can view.',values:{integrationName:g.name},description:"Description for a bot permission that allows the bot to view whatever pages its installing user can view."}:{id:"oauthAuthorizationPage.permissionStep.permissionListItem.readContent.description",defaultMessage:'"{integrationName}" will be able to view pages you select in the next step. You can also share pages later with "{integrationName}" in Notion.',values:{integrationName:g.name}})),(null===(i=g.capabilities)||void 0===i?void 0:i.update_content)&&a()(ie,{icon:Z.Z.scribble,title:a()(L.FormattedMessage,v?{id:"oauthAuthorizationPage.permissionStep.permissionListItem.updateContentWithInheritedAccess",defaultMessage:"Edit pages you have access to",description:"Title for a bot permission that allows the bot to edit whatever pages its installing user can edit."}:{id:"oauthAuthorizationPage.permissionStep.permissionListItem.updateContent",defaultMessage:"Edit pages you select",description:"This is one of the things an integration can do once it's added to a user's workspace."})},void 0,a()(L.FormattedMessage,v?{id:"oauthAuthorizationPage.permissionStep.permissionListItem.updateContentWithInheritedAccess.description",defaultMessage:'"{integrationName}" will be able to edit pages you can edit.',values:{integrationName:g.name},description:"Description for a bot permission that allows the bot to edit whatever pages its installing user can edit."}:{id:"oauthAuthorizationPage.permissionStep.permissionListItem.updateContent.description",defaultMessage:'"{integrationName}" will be able to edit pages you select in the next step. You can also share pages later with "{integrationName}" in Notion.',values:{integrationName:g.name}})),(null===(o=g.capabilities)||void 0===o?void 0:o.insert_content)&&a()(ie,{icon:Z.Z.pageAdd,title:a()(L.FormattedMessage,v?{id:"oauthAuthorizationPage.permissionStep.permissionListItem.insertContentWithInheritedAccess",defaultMessage:"Create new content within pages you have access to",description:"Title for a bot permission that allows the bot to add new content wherever its installing user can add new content."}:{id:"oauthAuthorizationPage.permissionStep.permissionListItem.insertContent",defaultMessage:"Create new content within pages you select",description:"This is one of the things an integration can do once it's added to a user's workspace."})},void 0,a()(L.FormattedMessage,v?{id:"oauthAuthorizationPage.permissionStep.permissionListItem.insertContentWithInheritedAccess.description",defaultMessage:'"{integrationName}" will be able to add new content or sub-pages wherever you have permission to add new content or sub-pages.',values:{integrationName:g.name,workspaceName:m},description:"Description for a bot permission that allows the bot to add new content wherever its installing user can add new content."}:{id:"oauthAuthorizationPage.permissionStep.permissionListItem.insertContent.description",defaultMessage:'"{integrationName}" will be able to add new content or sub-pages to pages you select in the next step. You can also share pages later with "{integrationName}" in Notion.',values:{integrationName:g.name,workspaceName:m}})),(null===(s=g.capabilities)||void 0===s?void 0:s.read_comment)&&a()(ie,{icon:Z.Z.topbarComment,title:a()(L.FormattedMessage,v?{id:"oauthAuthorizationPage.permissionStep.permissionListItem.readCommentWithInheritedAccess",defaultMessage:"View comments within pages you have access to",description:"Title for a bot permission that allows the bot to view comments within pages its installing user can access."}:{id:"oauthAuthorizationPage.permissionStep.permissionListItem.readComment",defaultMessage:"View comments within pages you select",description:"Title for a bot permission that allows the bot to view comments within pages its installing user selects."})},void 0,a()(L.FormattedMessage,v?{id:"oauthAuthorizationPage.permissionStep.permissionListItem.readCommentWithInheritedAccess.description",defaultMessage:'"{integrationName}" will be able to view comments within pages you can access.',values:{integrationName:g.name},description:"Description for a bot permission that allows the bot to view comments within pages its installing user can access."}:{id:"oauthAuthorizationPage.permissionStep.permissionListItem.readComment.description",defaultMessage:'"{integrationName}" will be able to view comments within pages you select in the next step. You can also share pages later with "{integrationName}" in Notion.',values:{integrationName:g.name},description:"Description for a bot permission that allows the bot to view comments within pages its installing user selects."})),(null===(r=g.capabilities)||void 0===r?void 0:r.insert_comment)&&a()(ie,{icon:Z.Z.topbarCommentFilled,title:a()(L.FormattedMessage,v?{id:"oauthAuthorizationPage.permissionStep.permissionListItem.insertCommentWithInheritedAccess",defaultMessage:"Create comments within pages you have access to",description:"Title for a bot permission that allows the bot to create comments within pages its installing user can access."}:{id:"oauthAuthorizationPage.permissionStep.permissionListItem.insertComment",defaultMessage:"Create comments within pages you select",description:"Title for a bot permission that allows the bot to create comments within pages its installing user selects."})},void 0,a()(L.FormattedMessage,v?{id:"oauthAuthorizationPage.permissionStep.permissionListItem.insertCommentWithInheritedAccess.description",defaultMessage:'"{integrationName}" will be able to create comments within pages you can access.',values:{integrationName:g.name},description:"Description for a bot permission that allows the bot to create comments within pages its installing user can access."}:{id:"oauthAuthorizationPage.permissionStep.permissionListItem.insertComment.description",defaultMessage:'"{integrationName}" will be able to create comments within pages you select in the next step. You can also share pages later with "{integrationName}" in Notion.',values:{integrationName:g.name},description:"Description for a bot permission that allows the bot to create comments within pages its installing user selects."})),((null===(d=g.capabilities)||void 0===d?void 0:d.read_user_without_email)||(null===(c=g.capabilities)||void 0===c?void 0:c.read_user_with_email))&&a()(ie,{icon:Z.Z.settingsMembersFilled,title:null!==(p=g.capabilities)&&void 0!==p&&p.read_user_with_email?a()(L.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.viewUsersAndEmail",defaultMessage:"View workspace users and their emails",description:"This is one of the things an integration can do once it's added to a user's workspace."}):a()(L.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.viewUsers",defaultMessage:"View workspace users",description:"This is one of the things an integration can do once it's added to a user's workspace."})},void 0,null!==(u=g.capabilities)&&void 0!==u&&u.read_user_with_email?a()(L.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.viewUsersAndEmail.detail",defaultMessage:'"{integrationName}" will be able to see basic information about all workspace members and guest data, including their names, profile images, and email addresses.',values:{integrationName:g.name}}):a()(L.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.permissionListItem.viewUsers.detail",defaultMessage:'"{integrationName}" will be able to see basic information about all workspace members and guests, like their names and profile images, but not their email addresses.',values:{integrationName:g.name}})))}function ie(e){const[t,i]=n.useState(!1),o=(0,l.y)((e=>({permissionItem:{border:`1px ${p.FN.dark.gray[850]} solid`,borderRadius:4,marginTop:8},permissionItemTitle:{display:"flex",justifyContent:"space-between",padding:"6px 12px",cursor:"pointer",userSelect:"none"},permissionItemHeading:{display:"flex",alignItems:"center"},permissionItemDetails:{paddingLeft:38,paddingRight:24,transition:"all 0.2s ease",color:e.mediumTextColor},rightStyle:{width:22,height:18},sharedIconStyle:{width:24,height:16,textAlign:"center"}})),[]);return a()("div",{style:o.permissionItem},void 0,a()("div",{style:o.permissionItemTitle,onClick:()=>i(!t)},void 0,a()("div",{style:o.permissionItemHeading},void 0,a()("div",{style:o.sharedIconStyle},void 0,e.icon({width:16,height:16,color:p.ZP.regularIconColor})),a()("div",{},void 0,e.title)),e.children&&a()("div",{style:{display:"flex",alignItems:"center"}},void 0,Z.Z.chevronDownThin({width:12,height:12,color:p.ZP.lightIconColor,transform:t?"rotate(180deg)":void 0,transition:"transform 0.2s ease"}))),a()("div",{style:{...o.permissionItemDetails,opacity:t?1:0,flex:t?1:0,paddingBottom:t?8:0,transform:t?"translate3d(0,-4px,0)":"translate3d(0,-8px,0)"}},void 0,t&&e.children))}const oe={permissions:{header:!0,warning:!0,footer:!0},bot_access_option:{header:!0,warning:!1,footer:!0},page_picker:{header:!1,warning:!1,footer:!1}},ae=(0,L.defineMessages)({loadingMessage:{id:"oauthAuthorization.loadingMessage",defaultMessage:"Authorizing…",description:"Loading modal shown when user is authorizing a Notion Integration from our OAuth screen."}});function ne(e){const{showApprovalWarning:t}=e,[i,o]=n.useState("permissions"),[s,r]=n.useState("duplicate_template"),l=oe[i].header,d=t&&oe[i].warning,c=oe[i].footer;return n.createElement(n.Fragment,null,l&&n.createElement(de,e),n.createElement(ce,K()({},e,{currentStep:i,botAccessOption:s,setBotAccessOption:r})),n.createElement(pe,K()({},e,{currentStep:i,setCurrentStep:o,botAccessOption:s})),d&&a()("div",{style:{display:"flex",alignItems:"center",marginTop:20}},void 0,a()(L.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.integrationApprovalNotice",defaultMessage:"Authorizing this integration will add it to your workspace's approval list. Other workspace members will be able to install this integration."})),c&&n.createElement(ue,e))}function se(){const{isMobile:e}=(0,s.Fy)();return(0,l.y)((t=>({title:{fontSize:e?18:20,margin:"0 50px 32px",textAlign:"center",fontWeight:S.Z.fontWeight.medium},inlineTextLink:{color:"black",textDecoration:"none"},buttonGroup:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:24},footer:{fontSize:S.Z.fontSize.UISmall.desktop,color:t.mediumTextColor,paddingTop:32,paddingBottom:16},innerFooterContainer:{color:t.regularTextColor,fontWeight:S.Z.fontWeight.semibold,marginBottom:4}})),[e])}const re={cancel:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.cancelButton.label",defaultMessage:"Cancel"}),back:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.selectPagesStep.backButton.label",defaultMessage:"Back",description:"Text for a button that will take the user back to the previous page"})},le={bot_access_option:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.nextButton.label",defaultMessage:"Next",description:"This button will take a user to the next screen in the OAuth flow for installing integrations."}),page_picker:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.continueButton.label",defaultMessage:"Select pages",description:"This button will take a user to a screen where they can choose pages to share with an integration."}),authorize:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.selectPagesStep.finishButton.label",defaultMessage:"Allow access",description:"This button, once clicked, adds an integration to a user's workspace and automatically gives it access to a set of pages the user selected."})};function de(e){const{integrationValue:t,spaceName:i}=e,o=t.info.website_url,s=t.info.icon?{pointer:{table:f.K2,id:t.id},icon:t.info.icon}:void 0,r=se();return n.createElement(n.Fragment,null,a()("div",{style:{padding:15}},void 0,a()(H.Z,{icon:s,disabled:!0,title:t.name,size:54,isEmptyPage:!1,style:{margin:"auto"}})),a()("div",{style:r.title},void 0,a()(L.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.title",defaultMessage:"<inlinetextlink>{integrationName}</inlinetextlink> is requesting access to {workspaceName}",values:{integrationName:t.name,workspaceName:i,inlinetextlink:e=>o?a()(R.Z,{style:r.inlineTextLink,href:o},void 0,e):e}})))}function ce(e){const{currentStep:t,integrationValue:i,spaceName:o}=e;return"permissions"===t?a()(te,{integrationValue:i,spaceName:o}):"bot_access_option"===t?n.createElement(J,K()({},e,{integrationValue:i})):"page_picker"===t?n.createElement(ee,K()({},e,{integrationValue:i})):void(0,y.t1)(t)}function pe(e){const{currentStep:t,setCurrentStep:i,integrationValue:o,validIntegrationTemplateId:l,oauthParams:d,botAccessOption:c,spaceId:p,selectedBlockIdsStore:u}=e,m=(0,s.O7)(),[h,v]=n.useState(!1),f=(0,r.VK)((()=>u.state),[u]),b=function(e){const{integrationValue:t,validIntegrationTemplateId:i,botAccessOption:o}=e;if((0,j.FD)(t.capabilities))return["permissions"];if(i){if("duplicate_template"===o)return["permissions","bot_access_option"];if("pick_pages"===o)return["permissions","bot_access_option","page_picker"];(0,y.t1)(o)}return["permissions","page_picker"]}({integrationValue:o,validIntegrationTemplateId:l,botAccessOption:c}),w=b.indexOf(t),S=b[w-1],A=b[w+1],k=S?re.back:re.cancel,M=S?()=>{i(S)}:()=>{!function(e){const{environment:t,oauthParams:i,integrationValue:o}=e;W.VW({environment:t,params:i,integration:o,errorType:B._.access_denied})}({environment:m,oauthParams:d,integrationValue:o})},I=A?le[A]:le.authorize,x=A?()=>{i(A)}:()=>{!async function(e){const{environment:t,botAccessOption:i,integrationValue:o,setIsLoading:a,oauthParams:n,spaceId:s,selectedBlockIds:r}=e;let l;"duplicate_template"!==i||(0,g.s0)(o)||(l=o.info.template_page_id),a(!0),Y.j({message:ae.loadingMessage}),G.trackInstallPublicIntegrationOauth(t,{selection:i}),await W.VW({environment:t,params:n,integration:o,spaceId:s,blockIdsForBot:l?[]:Object.keys(r).filter((e=>r[e])),templatePageId:l}),Y.x(),a(!1)}({environment:m,botAccessOption:c,integrationValue:o,setIsLoading:v,oauthParams:d,spaceId:p,selectedBlockIds:f})},P=se();return a()("div",{style:P.buttonGroup},void 0,a()(O.Z,{isLarge:!0,onClick:M,style:{height:32}},void 0,k),a()(E.Z,{isLarge:!0,onClick:x,disabled:h},void 0,I))}function ue(e){const{integrationValue:t,oauthParams:i}=e,o=t.info.terms_of_use_url,n=t.info.privacy_policy_url,s=(i.redirectUri||t.redirect_uris[0]||"").replace("http://","").replace("https://","").split(/[/?#]/)[0],r=se();return a()("footer",{style:r.footer},void 0,a()("div",{style:r.innerFooterContainer},void 0," ",a()(L.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.warning.title",defaultMessage:'Make sure you trust "{integrationName}" ({redirectUriDomain})',values:{integrationName:t.name,redirectUriDomain:s}})),a()("div",{},void 0,a()(L.FormattedMessage,{id:"oauthAuthorizationPage.permissionStep.warning.body",defaultMessage:'If you continue, you may be sharing sensitive information. Notion does not review third party integrations such as "{integrationName}". Learn how "{integrationName}" handles your data by reviewing their <privacypolicylink>Privacy Policy</privacypolicylink> and <termsofservicelink>Terms of Service</termsofservicelink>.',values:{integrationName:t.name,privacypolicylink:e=>n?a()(R.Z,{href:n},void 0,e):e,termsofservicelink:e=>o?a()(R.Z,{href:o},void 0,e):e}})))}var ge=i(7900),me=i(28125),he=i(45094),ve=i(81236),fe=i(17364),be=i(72495),we=i(1101),ye=i(98285),Se=i(34011),Ae=i(31280);class ke extends Ae.g6{renderAccountHeader(e){const t=fe.Z.getUserEmailAddress(this.environment,e);return t&&a()(we.Z,{emailAddress:t,userId:e,disabled:!1,accountActions:[(0,ge.qu)(e)]})}renderFooter(){return a()("div",{style:this.getFooterStyle()},void 0,a()(be.Z,{},void 0,me.k(this.environment)&&n.createElement(ye.Z,K()({createType:"add-account",disableLoginLink:this.props.disableLoginLink},this.stores))))}getMenuListSections(e){const{device:t}=this.environment;return[{key:"spaces",render:e=>n.createElement(be.Z,K()({},e,{disableMobilePadding:!0,topBorder:t.isMobile,style:{borderBottom:`1px solid ${this.theme.regularDividerColor}`}})),items:this.getSpaceMenuListItems(e)}].filter((e=>e.items.length>0))}getSpaceMenuListItems(e){const{singleSpaceToSelect:t}=this.props,{currentUserRootStore:i,currentSpaceStore:o}=N.default.state,a=[],n=fe.Z.getSpaceViewStores(this.environment,e);if(!i||!o)return[];if(n.sort(((e,t)=>{var i,o;const a=Number(Boolean(null===(i=e.getSpaceStore())||void 0===i?void 0:i.canAdmin()));return Number(Boolean(null===(o=t.getSpaceStore())||void 0===o?void 0:o.canAdmin()))-a})),t){const s=n.find((e=>e.getSpaceId()===t));if(s){const t=s.getSpaceStore();t&&a.push(this.getGeneratedSpaceMenuListItem({currentSpaceStore:o,currentUserRootStore:i,spaceStoreForSpaceView:t,spaceViewStore:s,userId:e}))}}else for(const s of n){const t=s.getSpaceStore();t&&a.push(this.getGeneratedSpaceMenuListItem({currentSpaceStore:o,currentUserRootStore:i,spaceStoreForSpaceView:t,spaceViewStore:s,userId:e}))}return a}getUnreadCountForOtherSpaces(){return 0}getGeneratedSpaceMenuListItem(e){const{onSpaceClick:t}=this.props,{spaceStoreForSpaceView:i,currentSpaceStore:o,currentUserRootStore:s,userId:r,spaceViewStore:l}=e,d=r===s.id&&i.id===o.id,c=(0,x.getSpaceName)(this.environment,i),p=(0,x.isGuestOfSpace)(i);let u;const g=ve.Z.getPublicSpaceData(this.environment,i.id);if(g){const e=g.productId?this.props.intl.formatMessage((0,he.em)(g.subscriptionTier)):this.props.intl.formatMessage("team"===i.getPlanType()?he.js.teamTrialPlan:he.js.personalPlan);u=this.props.intl.formatMessage("personal"===i.getPlanType()?he.js.workspaceSubtitleWithoutMembers:he.js.workspaceSubtitleWithMembers,{numberOfWorkspaceMembers:this.props.intl.formatNumber(g.memberCount),planType:e})}return{key:l.id,render:e=>n.createElement(Se.Z,K()({},e,{id:l.id,icon:(0,x.getSpaceIcon)(this.environment,i),title:c,caption:u,isCheck:d,showDragHandle:!1,disabled:p,disableTooltip:!p,tooltipMessage:a()(L.FormattedMessage,{id:"oauthAuthorizationPage.workspaceSwitcher.disabledWorkspace.tooltip",defaultMessage:"This integration can only be added by a member or admin."})})),action:async e=>{let{event:i}=e;this.close(),d||await t({event:i,spaceViewStore:l})}}}}const Me=(0,L.injectIntl)(ke);function Ie(e){const{onSpaceSwitch:t,disableAccountSwitcher:i,singleSpaceToSelect:o}=e,n=function(){const{isMobile:e}=(0,s.Fy)();return(0,l.y)((()=>({container:{display:"flex",alignItems:"center",justifyContent:"space-between",height:60,paddingLeft:20,paddingRight:8,borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:p.ZP.contentBorder},notionLogo:{width:e?28:30,height:e?28:30,marginRight:10,flexShrink:0},notionTitle:{fontWeight:S.Z.fontWeight.medium,fontSize:16},switcherButton:{borderRadius:3,marginBottom:0}})),[e])}();return a()("div",{style:n.container},void 0,Z.Z.notionLogoStroked(n.notionLogo),a()("div",{style:n.notionTitle},void 0,"Notion"),a()("div",{style:{flexGrow:1,flexShrink:1}}),a()("div",{style:{flexShrink:0}},void 0,a()(Me,{format:Ae._S.Regular,onSpaceClick:e=>{let{spaceViewStore:i}=e;return t(i)},shouldShowUnexpandButton:!1,disableLoginLink:!0,buttonStyle:{borderRadius:3,marginBottom:0},disabled:i,singleSpaceToSelect:o})))}const xe={"929cdebb-09e8-4c5c-bfe5-e8c3c3902987":"development","5dbd3ed0-1160-4532-b10a-1a6749748fc4":"staging"};function Pe(e){const t=e.userId,i=e.spaceId,o=(0,s.O7)(),n=(0,r.VK)((()=>N.default.state.currentUserRootStore),[]),d=(0,r.VK)((()=>N.default.state.currentSpaceStore),[]),c=(0,r.VK)((()=>N.default.state.currentSpaceViewStore),[]),u=(0,r.VK)((()=>!!(t&&i&&c)&&(c.getSpaceId()===i&&c.getUserRootParentId()===t)),[t,i,c]),g=function(e){const{WindowSizeStore:t}=e.environment,i=(0,r.VK)((()=>t.state.width>500),[t]),o=(0,r.VK)((()=>t.state.height<900),[t]);return(0,l.y)((e=>({layoutContainer:{height:"100%",overflow:"auto",backgroundColor:i?p.ZP.frontCreamBackground:p.ZP.white},pageContainer:{display:"flex",justifyContent:"center"},contentBox:{width:"500px",minHeight:"600px",borderRadius:5,backgroundColor:p.ZP.white,boxShadow:i?e.lightBoxShadow:"none",display:"flex",flexDirection:"column",fontSize:S.Z.fontSize.UIRegular.desktop,marginTop:o?16:i?"calc((100vh - 900px) / 2)":0,marginBottom:40,transition:"all 0.2s ease"},contentBody:{paddingLeft:40,paddingRight:40,paddingTop:25,paddingBottom:25,flex:1,display:"flex",flexDirection:"column"}})),[i,o])}({environment:o});return a()("div",{style:g.layoutContainer},void 0,a()("div",{style:g.pageContainer},void 0,a()("div",{style:g.contentBox},void 0,a()(Ie,{disableAccountSwitcher:u,singleSpaceToSelect:i,onSpaceSwitch:async t=>{await(0,k.ce)({environment:o,spaceViewStore:t});const i=t.getSpaceId();if(i&&xe[i]&&e.integrationId&&e.redirectUri){const t=(0,I.LH)({baseUrl:(0,I.k2)(xe[i],!1),clientId:e.integrationId,redirectUri:e.redirectUri});(0,A.navigateToExternalURL)({environment:o,url:t,targetSelf:!0})}}}),a()("div",{style:g.contentBody},void 0,a()(Ne,{oauthParams:e,spaceStore:d,userRootStore:n})))))}function Ne(e){const{oauthParams:t,spaceStore:i,userRootStore:o}=e;return i&&o?a()(_e,{oauthParams:t,spaceStore:i,userRootStore:o}):a()(V.Z,{})}function _e(e){var t;const{oauthParams:i,spaceStore:o,userRootStore:l}=e,{integrationId:p,responseType:S}=i,A=(0,s.O7)(),k=(0,r.VK)((()=>x.getSpaceName(A,o)),[A,o]),[I,N]=n.useState(),Z=(0,r.VK)((()=>{if(p){return(0,C.Kv)(l,{id:p,table:f.K2}).getValue()}}),[p,l]),L=(0,d.V)({value:Z,waitTimeInMs:1e3}),[{value:B}]=(0,u.r5)((async()=>{await M.bi(A);const{data:e}=z.default.state;return e?P.NM(e):[]}),[A]),W=(0,r.VK)((()=>{if(B&&B.length>0){return B.map((e=>{const t=(0,C.Kv)(l,{table:v.cZ,id:e.botId}).getValue();if(t&&t.alive&&(0,c.PO)(t)&&t.created_by_id===l.id&&t.created_by_table===b.KJ&&t.integration_id===p)return{botValue:t,pageIds:e.pageIds}})).filter(y.$K)[0]}}),[B,l,p]),E=(0,r.VK)((()=>{let e={};return W&&(e=W.pageIds.reduce(((e,t)=>(e[t]=!0,e)),{})),new F.default(e)}),[W]),O=(0,r.VK)((()=>{if(!p)return!1;const e=o.getBotSettingsStore().getValue();if(!e)return!0;if((0,w.CJ)(e)){const t=e.integration_approval_statuses;return!(!t||!t[p])&&Boolean("approved"===t[p].status)}return!0}),[p,o]),R=(0,r.VK)((()=>{const e=L.value;if(e&&"on"===_.default.getEligibleGroup({experimentId:"oauth_template_duplication",defaultGroup:"control"}))return(0,g.s0)(e)?void 0:e.info.template_page_id}),[L]),D=(0,r.VK)((()=>x.isGuestOfSpace(o)),[o]),K=(0,r.VK)((()=>o.canAdmin()),[o]);n.useEffect((()=>{L.value&&!I&&N(Z)}),[I,N,Z,L]);const j=null!==(t=L.value)&&void 0!==t?t:I;return"pending"===L.status?a()(V.Z,{}):p&&(0,h.e)(p)?j?"code"!==S?a()(U,{type:"invalidResponseType",oauthParams:i,spaceName:k,integrationValue:j}):D?a()(U,{oauthParams:i,spaceName:k,type:"notAnAdmin",integrationValue:j,primaryAction:()=>{T.Z.setState({...T.Z.state,open:!0})}}):K||O?m._(j,i.redirectUri)?a()(ne,{integrationValue:j,validIntegrationTemplateId:R,spaceName:k,spaceId:o.id,oauthParams:i,showApprovalWarning:K&&!O,selectedBlockIdsStore:E}):a()(U,{oauthParams:i,spaceName:k,type:"invalidRedirectUri",integrationValue:j}):a()(U,{oauthParams:i,spaceName:k,type:"integrationNotApproved",integrationValue:j,primaryAction:()=>{T.Z.setState({...T.Z.state,open:!0})}}):a()(U,{type:"clientNotFound",oauthParams:i,spaceName:k}):a()(U,{type:"invalidClientId",oauthParams:i,spaceName:k})}}}]);