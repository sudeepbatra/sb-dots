"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[1471],{48298:(e,t,i)=>{i.d(t,{kn:()=>p,kj:()=>m,Tr:()=>g});var o=i(58129),r=i(75246),s=i(19889),a=i(50906),n=i(54642),d=i(76464),h=i(9953),l=i(30149),c=i(14133),u=i(98905);const p=async e=>{const{environment:t,store:i,accessRequestStore:o,forActor:r,status:n,from:c}=e,u=t.currentUser.id;if("approved"===n){const e={type:"existingUser",value:r,spaceRole:"read_and_write"};if(!(await d.n_({environment:t,store:i,inviteTargets:[e],inviteRole:"read_and_write",isOnboarding:!1,invite:{inviteOrigin:"membership_request"}})).success)return}l.createAndCommit({userAction:"GrantAccessActivityAction.handleGrantAccess",environment:t,perform:e=>{h.sW({store:o,transaction:e,data:{granted_time:Date.now(),granted_by_table:s.KJ,granted_by_id:u,resolved_time:Date.now(),resolved_by_table:s.KJ,resolved_by_id:u,status:n}})}}),a.trackResolveMembershipRequest(t,{status:n,request_id:o.id,from:c,for_actor_id:r.id,space_role:i.getRole()})};async function m(e){if(u.Z.reset(),!e.canAdmin)return;const{environment:t,spaceId:i}=e,o=await n.getUnreadAccessRequestCount(t,{parentTable:r.bx,parentId:i,size:1});"success"===o.type&&u.Z.setState({spaceId:i,count:o.data.count})}function g(e,t){const i=new Map;for(const r of t){const t=(0,c.Kv)(e,{table:o.J8,id:r}),a=t.getValue();if(!a)continue;if(a.for_actor_table!==s.KJ||a.created_by_table!==s.KJ)continue;const n=(0,c.Kv)(e,{table:a.for_actor_table,id:a.for_actor_id}).getValue();if(!n)continue;const d=(0,c.Kv)(e,{table:a.created_by_table,id:a.created_by_id}).getValue();if(d)if(i.has(a.for_actor_id)){const e=i.get(a.for_actor_id);if(!e)continue;a.created_time>e.latestRequestTime?i.set(a.for_actor_id,{...e,createdByActorsWithReason:[{actor:d,reason:a.message},...e.createdByActorsWithReason],accessRequest:a,accessRequestStore:t,latestRequestTime:a.created_time}):i.set(a.for_actor_id,{...e,createdByActorsWithReason:[...e.createdByActorsWithReason,{actor:d,reason:a.message}]})}else i.set(a.for_actor_id,{forActor:n,createdByActorsWithReason:[{actor:d,reason:a.message}],accessRequest:a,accessRequestStore:t,latestRequestTime:a.created_time})}return Array.from(i.values())}},23351:(e,t,i)=>{i.r(t),i.d(t,{default:()=>et});var o=i(77094),r=i.n(o),s=i(96486),a=i.n(s),n=i(67294),d=i(83355),h=i(40902),l=i(66897),c=i(17215),u=i(41432),p=i(8848),m=i(39068),g=i(55061),v=i(98459),f=i(89101),b=i(58129),A=i(21202),y=i(77420),S=i(6287),k=i(13493),_=i(70279),T=i(33709),O=i(57883),C=i(84683),w=i(75246),M=i(29369),B=i(19889),J=i(94044),R=i(99108),I=i(70203),D=i(97880),N=i(82990),P=i(63143),V=i(5366),x=i(50906),Z=i(19719),F=i(17659),L=i(9953),q=i(4083),U=i(38363),E=i(30149),G=i(4708),K=i(14976),W=i(52821),z=i(17731),H=i(33929),$=i(17652),j=i(98165),X=i(67669),Y=i(14133),Q=i(62820),ee=i(4761),te=i(97464),ie=i.n(te),oe=i(53397),re=i(51118),se=i(43250),ae=i(16402),ne=i(12318),de=i(47323),he=i(73063),le=i(86176),ce=i(58032),ue=i(70301),pe=i(25383),me=i(67706),ge=i(480),ve=i(24405);function fe(e){let{notification:t,rootStore:i}=e;const o=(0,ge.O7)(),s=(0,n.useCallback)((()=>{t&&E.createAndCommit({userAction:"InboxActionsMenu.handleArchive",environment:o,perform:e=>{F.aZ({notification:t,rootStore:i,transaction:e})}})}),[o,t,i]),a=(0,n.useCallback)((()=>{t&&E.createAndCommit({userAction:"InboxActionsMenu.toggleNotificationReadStatus",environment:o,perform:e=>{F.$h({notification:t,rootStore:i,transaction:e,read:!t.read})}})}),[o,t,i]),d=(0,ve.y)((e=>({container:{display:"flex",height:"min-content",background:e.buttonGroupBackground,boxShadow:e.lightBoxShadow,borderRadius:4,padding:2},readIcon:{width:16,height:15,fill:e.mediumTextColor},unreadIcon:{width:18,height:18,fill:e.mediumTextColor},archiveIcon:{width:17,height:17,fill:e.mediumTextColor}})),[]);return t?r()("div",{style:d.container},void 0,r()(ce.Z,{renderTooltip:()=>t.read?r()(V.FormattedMessage,{defaultMessage:"Mark this notification as unread",id:"inboxActionsMenu.markNotificationAsUnread.tooltipMessage",description:"Tooltip message for the icon button to mark a notification as unread. The icon is an image of an empty speech bubble."}):r()(V.FormattedMessage,{defaultMessage:"Mark this notification as read",id:"inboxActionsMenu.markNotificationAsRead.tooltipMessage",description:"Tooltip message for the icon button to mark a notification as read. The icon is an image of a speech bubble with a checkmark in it."}),render:e=>n.createElement(he.Z,ie()({icon:t.read?oe.Z.notificationUnread:oe.Z.notificationRead,iconStyle:t.read?d.unreadIcon:d.readIcon,onClick:a},e))}),r()(ce.Z,{renderTooltip:()=>r()(V.FormattedMessage,{defaultMessage:"Archive this notification",id:"inboxActionsMenu.handleArchive.tooltipMessage",description:"Tooltip message for the icon button to archive a notification. The icon is an image of a storage file box."}),render:e=>n.createElement(he.Z,ie()({icon:oe.Z.archive,iconStyle:d.archiveIcon,onClick:s},e))})):null}const be=n.memo(fe);var Ae=i(32469),ye=i(93963);class Se extends d.Z{constructor(){super(...arguments),this.storeTypes={hovered:ne.default.of(!1),hoveredOverInboxActionsMenu:ne.default.of(!1)},this.handleMouseMove=()=>{this.stores.hovered.set(!0)},this.handleMouseLeave=()=>{this.stores.hovered.set(!1)},this.handleMouseEnterInboxActions=()=>{this.stores.hoveredOverInboxActionsMenu.set(!0)},this.handleMouseLeaveInboxActions=()=>{this.stores.hoveredOverInboxActionsMenu.set(!1)},this.handleArchive=()=>{const{notification:e,rootStore:t,onArchiveClicked:i}=this.props;i(),e&&E.createAndCommit({userAction:"ActivitySection.handleArchive",environment:this.environment,perform:i=>{F.aZ({notification:e,rootStore:t,transaction:i})}})},this.handleMarkAsRead=()=>{const{notification:e,rootStore:t}=this.props;(0,$.sn)()&&e&&!e.read&&(this.stores.hoveredOverInboxActionsMenu.get()||E.createAndCommit({userAction:"ActivitySection.handleMarkAsRead",environment:this.environment,perform:i=>{F.$h({notification:e,rootStore:t,transaction:i,read:!0})}}))},this.handleOpenSnapshot=()=>{if(this.props.navigableBlockId){const e=Y.G.createChildStore(this.props.rootStore,{table:A.iU,id:this.props.navigableBlockId});re.jN({environment:this.environment,blockStore:e,openSnapshotNearTimestamp:this.props.timestamp.toString(),from:"activity"})}}}renderComponent(){const{children:e}=this.props;return r()("div",{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onClick:this.handleMarkAsRead},void 0,r()("div",{style:{...Se.wrapStyle,paddingBottom:e?12:8,paddingLeft:this.environment.device.isMobile?this.environment.WindowSizeStore.state.paddingLeftCSS:0,paddingRight:this.environment.device.isMobile?this.environment.WindowSizeStore.state.paddingRightCSS:0,...this.shouldShowReadNotificationStyle()&&{color:this.theme.mediumTextColor,background:this.theme.accentColors.gray[30]}}},void 0,r()("div",{style:this.getHeaderAndAvatarStyle()},void 0,r()("div",{className:se.FoE,style:{...this.avatarAndStatusDotStyle(),...this.shouldShowReadNotificationStyle()&&{opacity:.5}}},void 0,(0,$.sn)()&&r()("div",{style:{marginRight:4}},void 0,this.renderStatusDot()),this.props.icon),this.renderHeader(),this.renderSnapshotButton(),(0,$.sn)()?this.renderInboxActions():this.renderArchiveAction(),this.renderPrivate()),e&&this.renderChildren()),this.renderDivider())}renderDivider(){const{isLast:e}=this.props;if(!e)return r()("div",{style:this.getBorderBottomStyle()})}renderHeader(){const{timestamp:e,header:t}=this.props,i=(0,ae.IS)(e),o=(0,ae.uy)(e);return r()("div",{style:Se.headerStyle},void 0,r()("div",{className:se.NFf},void 0,t),r()("div",{style:{display:"flex",marginTop:4,marginBottom:this.props.children?8:4}},void 0,r()("div",{style:this.getTimeStyle(),className:se.CZG},void 0,r()(me.Z,{text:i,tooltipText:o,icon:oe.Z.calendar})),this.props.navigableBlockId&&this.props.rootStore&&r()(le.Z,{isLink:!0,innerStyle:this.getPathStyle(),store:Y.G.createChildStore(this.props.rootStore,{table:A.iU,id:this.props.navigableBlockId}),left:r()("div",{style:this.getSeparatorDotStyle()},void 0,"Â·"),onClick:this.props.onBacklinkClicked})))}renderSnapshotButton(){if(this.props.showSnapshotButton&&!(this.props.timestamp<new Date("2018-10-26").getTime()))return this.props.navigableBlockId?r()(ce.Z,{renderTooltip:()=>r()(V.FormattedMessage,{defaultMessage:"View version for this update",id:"activitySection.viewVersionForUpdate.tooltip"}),render:e=>n.createElement(he.Z,ie()({onClick:this.handleOpenSnapshot,icon:oe.Z.versionHistoryThick},e))}):void 0}renderInboxActions(){const{notification:e,rootStore:t}=this.props,{currentTab:i}=ee.Z.state;if("mentions"===i&&e&&!e.visited)return r()("div",{style:this.getStatusLabelContainerStyle(),onMouseEnter:this.handleMouseEnterInboxActions,onMouseLeave:this.handleMouseLeaveInboxActions},void 0,!(0,$.sn)()&&this.renderStatusDot(),r()("div",{style:this.getInboxActionsStyle()},void 0,r()(be,{notification:e,rootStore:t})))}renderStatusDot(){return!this.isSeen()&&r()(ye.z,{style:{...this.getStatusDotStyle(),opacity:1}})}renderArchiveAction(){const{notification:e}=this.props,{device:t}=this.environment,{currentTab:i}=ee.Z.state;if("mentions"===i&&e&&!e.visited)return r()(ce.Z,{renderTooltip:()=>r()(V.FormattedMessage,{defaultMessage:"Archive this notification",id:"activitySection.archiveAction.tooltip"}),render:e=>n.createElement("div",ie()({style:this.getStatusLabelContainerStyle()},e),!this.isSeen()&&r()(ye.z,{style:this.getStatusDotStyle()}),r()(de.Z,{onClick:this.handleArchive,style:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:this.theme.buttonHoveredBackground,width:t.isMobile?24:20,height:t.isMobile?24:20,opacity:this.environment.device.isMobile||this.stores.hovered.get()?1:0},hoveredStyle:{background:this.theme.buttonPressedBackground}},void 0,oe.Z.closeSmall({width:t.isMobile?18:14,fill:this.theme.mediumTextColor})))})}renderPrivate(){if(this.props.isPrivate&&!this.props.notification)return r()(Ae.Z,{style:{marginTop:1,marginBottom:4,marginLeft:8}})}renderChildren(){return r()("div",{className:se.nU_},void 0,this.props.children)}isSeen(){const{notification:e}=this.props;return!e||e.read}shouldShowReadNotificationStyle(){const{currentTab:e}=ee.Z.state;return this.isSeen()&&"mentions"===e&&!this.props.showSnapshotButton&&(0,$.sn)()}avatarAndStatusDotStyle(){return{display:"flex",alignItems:"flex-start",position:"relative"}}getHeaderAndAvatarStyle(){return{display:"flex",paddingLeft:16,paddingRight:16}}getBorderBottomStyle(){return{borderBottom:`1px solid ${this.theme.regularDividerColor}`}}getPathStyle(){return{fontSize:12,color:this.theme.lightTextColor}}getTimeStyle(){return{fontSize:12,color:this.theme.lightTextColor,whiteSpace:"nowrap"}}getSeparatorDotStyle(){return{fontSize:12,color:this.theme.lightTextColor,marginLeft:4,marginRight:4}}getStatusLabelContainerStyle(){return{display:"flex",alignItems:"flex-start",marginTop:1,marginBottom:4,position:"relative",marginLeft:this.environment.device.isMobile?23:8}}getStatusDotStyle(){return(0,$.sn)()?{position:"absolute",opacity:this.stores.hovered.get()?0:1,left:this.environment.device.isMobile?-10:-8,top:(this.environment.device.isMobile,10)}:{marginRight:4,position:"absolute",opacity:this.stores.hovered.get()?0:1,right:this.environment.device.isMobile?28:2.5,top:this.environment.device.isMobile?7.5:5.5}}getInboxActionsStyle(){const{isMobile:e}=this.environment.device;return{transition:"opacity 100ms ease-out",opacity:e||this.stores.hovered.get()?1:0,...!e&&{position:"absolute",top:0,right:0,zIndex:1}}}}Se.wrapStyle={paddingTop:12},Se.headerStyle={fontSize:14,lineHeight:1.4,flexGrow:1,minWidth:0};const ke={fontWeight:N.Z.fontWeight.semibold},_e={marginTop:2,marginRight:8,flexShrink:0};function Te(e){const{authors:t}=e,i=t[0],o=(0,$.ME)()?24:28;return i&&(0,l.z8)(i)?r()(ue.Z,{botValue:i.value,style:_e,size:o}):r()(pe.Z,{userValue:i&&i.value,style:_e,size:o,avatarShouldShowShadow:!0})}function Oe(){return r()("div",{style:{display:"flex",backgroundColor:p.ZP.red,height:28,width:28,borderRadius:"100%",..._e}},void 0,oe.Z.alarmClock({height:16,width:16,fill:p.ZP.white,marginLeft:6,marginTop:5}))}function Ce(e){const t=e.map((e=>(0,l.$4)(H.default.getIntl(),e)));if(1===t.length)return r()("span",{},void 0,r()(V.FormattedMessage,{defaultMessage:"<b>{author}</b>",id:"activitySection.authorPhrase.forOneAuthor.label",values:{author:t[0],b:e=>r()("span",{style:ke},void 0,e)}}));if(2===t.length)return r()("span",{},void 0,r()(V.FormattedMessage,{defaultMessage:"<b>{firstAuthor}</b> and <b>{secondAuthor}</b>",id:"activitySection.authorPhrase.forTwoAuthors.label",values:{firstAuthor:t[0],secondAuthor:t[1],b:e=>r()("span",{style:ke},void 0,e)}}));if(t.length>2){const e=r()(V.FormattedMessage,{defaultMessage:"{numberOfOtherAuthors, plural, one {<b>{firstAuthor}</b>, <b>{secondAuthor}</b>, and {numberOfOtherAuthors} other} other {<b>{firstAuthor}</b>, <b>{secondAuthor}</b>, and {numberOfOtherAuthors} others}}",id:"activitySection.authorPhrase.forMoreThanTwoAuthors.label",values:{numberOfOtherAuthors:t.length-2,firstAuthor:t[0],secondAuthor:t[1],b:e=>r()("span",{style:ke},void 0,e)}});return r()("span",{},void 0,e)}return r()("span",{style:ke},void 0,r()(V.FormattedMessage,{defaultMessage:"Nobody",id:"activitySection.authorPhrase.forNoAuthors.label"}))}const we=Se;var Me=i(48298),Be=i(91376),Je=i(17256),Re=i(64404),Ie=i(61519),De=i(62385),Ne=i(64369);class Pe extends d.Z{constructor(){super(...arguments),this.storeTypes={role:ne.default.of(void 0)}}renderComponent(){const e=this.props.accessRequestStore.getValue();if(e){if((0,b.ce)(e))return this.renderResolvedSpaceMembershipRequest(e);if(this.canResolveMembershipRequests())return r()("div",{style:{display:"flex",alignItems:"center"}},void 0,r()(De.Z,{onClick:()=>this.resolveMembershipRequest("approved"),style:this.getButtonStyle(!1)},void 0,r()(V.FormattedMessage,{defaultMessage:"Approve",id:"approveSpaceMembershipActivityAction.approveButton.label",description:"Button in notification to approve a membership request."})),r()(De.Z,{onClick:()=>this.resolveMembershipRequest("rejected"),style:{height:26,paddingLeft:8,paddingRight:8}},void 0,r()(V.FormattedMessage,{defaultMessage:"Decline",id:"approveSpaceMembershipActivityAction.declineButton.label",description:"Decline space membership request button in notification."})),!this.environment.device.isMobile&&n.createElement(n.Fragment,null,r()(Ie.Z,{size:1,vertical:!0,style:{height:26,paddingLeft:8,paddingRight:8}}),r()(De.Z,{onClick:()=>{x.trackClickViewAllRequests(this.environment,{disable_membership_requests:this.props.spaceStore.getDisableMembershipRequests()}),this.handleOpenSettingsMembersRequests()},style:{height:26,paddingLeft:8,paddingRight:8}},void 0,r()(V.FormattedMessage,{defaultMessage:"View all requests",id:"approveSpaceMembershipActivityAction.viewAllRequests.label",description:"Button that takes user to the settings modal members requests tab to see all existing requests."}))))}}renderResolvedSpaceMembershipRequest(e){const t=("approved"===e.status||"rejected"===e.status)&&this.renderActor(e.resolved_by_table,e.resolved_by_id),i=(0,Je.Z)(Math.min(e.resolved_time,Date.now())).calendar();return n.createElement(n.Fragment,null,r()(Ne.Z,{isSecondaryColor:!0},void 0,"approved"===e.status?r()(V.FormattedMessage,{defaultMessage:"Approved by {grantedBy}",id:"approveSpaceMembershipActivityAction.requestApproved.title",values:{grantedBy:t,time:i},description:"Message showing that space membership request has been approved."}):r()(V.FormattedMessage,{defaultMessage:"Declined by {grantedBy}",id:"approveSpaceMembershipActivityAction.requestDeclined.title",values:{grantedBy:t,time:i},description:"Message showing that space membership request has been declined."})),r()(Ne.Z,{isSmall:!0,isSecondaryColor:!0},void 0,i))}handleOpenSettingsMembersRequests(){(0,Be.r)({currentTab:"members",subtab:Re.Q.Requests})}canResolveMembershipRequests(){return this.props.spaceStore.canEditMembership()}renderActor(e,t){return Ce(a().compact([this.getActor(e,t)]))}getActor(e,t){if(e===B.KJ){const i=this.rootStore.getRecordValue({table:e,id:t});if(i)return(0,l.dp)(i)}if(e===y.cZ){const i=this.rootStore.getRecordValue({table:e,id:t});if(i)return(0,l.D$)(i)}}get rootStore(){return this.props.accessRequestStore}async resolveMembershipRequest(e){if(!this.canResolveMembershipRequests())return;const t=this.environment,{spaceStore:i,accessRequestStore:o}=this.props,r=o.getValue();if(!r)return;const s=this.getActor(B.KJ,r.for_actor_id);s&&s.table===B.KJ&&await(0,Me.kn)({environment:t,store:i,accessRequestStore:o,forActor:s.value,status:e,from:"notification"})}getButtonStyle(e){const t={height:26,paddingLeft:8,paddingRight:8,boxShadow:this.theme.plainButtonBoxShadow,fontSize:12,marginRight:10};return e?t:{...t,color:this.theme.regularTextColor,fontWeight:500}}}const Ve=Pe;var xe=i(1136),Ze=i(45669),Fe=i(84076),Le=i(31278),qe=i(76798),Ue=i(79931),Ee=i(27006),Ge=i(76464),Ke=i(21115),We=i(78291),ze=i(7567);class He extends d.Z{constructor(){super(...arguments),this.storeTypes={role:ne.default.of(void 0)},this.handleApproveMembershipRequest=async()=>{},this.handleGrantPageAccess=async()=>{const{targetBlockStore:e,accessRequestStore:t}=this.props,i=this.getInviteTargetWithNewPermissionItem();if(!("permissionItem"in i))return;const o=this.environment.currentUser.id;if(!o)return;if("type"in i){let t;if("existingUser"===i.type){t=(await Ge.n_({environment:this.environment,store:e,inviteTargets:[i],inviteRole:i.permissionItem.role,isOnboarding:!1,invite:{inviteOrigin:"page_request_access"}})).success}else if("bot"===i.type){t=(await Ge.n_({environment:this.environment,store:e,inviteTargets:[i],inviteRole:void 0,isOnboarding:!1,invite:{inviteOrigin:"page_request_access"}})).success}else(0,D.t1)(i);if(!t)return}E.createAndCommit({userAction:"GrantPageAccessActivityAction.handleGrantPageAccess",environment:this.environment,perform:r=>{"type"in i||Ge.ep({environment:this.environment,transaction:r,store:e,permissionItems:[i.permissionItem]}),L.sW({store:t,transaction:r,data:{granted_time:Date.now(),granted_by_table:B.KJ,granted_by_id:o,resolved_time:Date.now(),resolved_by_table:B.KJ,resolved_by_id:o,status:"approved"}})}});const r=t.getValue(),s=r&&r.created_time&&r.granted_time?r.granted_time-r.created_time:void 0;x.trackGrantAccess(this.environment,{requestId:r&&r.id,timeElapsedSinceRequest:s,newAccessLevel:i.permissionItem.role})},this.handleRoleChange=e=>{const t=this.props.accessRequestStore.id,i=this.stores.role.state;this.stores.role.setState(e),x.trackChangeGrantAccessLevel(this.environment,{requestId:t,previousAccessLevel:i,newAccessLevel:e})},this.handleArchive=()=>{const{notification:e}=this.props;e&&(E.createAndCommit({userAction:"GrantPageAccessActivityAction.handleArchive",environment:this.environment,perform:t=>{(0,F.aZ)({notification:e,rootStore:this.props.accessRequestStore,transaction:t})}}),x.trackIgnoreAccessRequest(this.environment))}}renderComponent(){const e=this.props.accessRequestStore.getValue();if(!e)return;if((0,b.Kc)(e))return this.renderGrantedAccessRequest(e);if(!this.canGrantAccess())return;const t=e.parent_table===w.bx,i=this.getCurrentPermissionItem();if(i&&!t){const t=this.renderActor(e.for_actor_table,e.for_actor_id),o=i.role===this.getRole();return n.createElement(n.Fragment,null,r()(Ne.Z,{isSecondaryColor:!0,style:{marginBottom:6}},void 0,r()(V.FormattedMessage,{defaultMessage:"{requestingUser} already has access.",id:"grantPageAccessActivityAction.alreadyHasAccess.label",description:"Shown if the user who requested access already has access",values:{requestingUser:t}})),r()(ze.Z,{upgradeButtonName:"user_permission_item",role:this.getRole(),table:A.iU,blockType:this.props.targetBlockStore.getType(),type:e.for_actor_table===B.KJ?"user_permission":"bot_permission",onChange:this.handleRoleChange,isInvite:!0,buttonStyle:this.getButtonStyle(!0)}),r()(De.Z,{onClick:this.handleGrantPageAccess,style:this.getButtonStyle(o)},void 0,r()(V.FormattedMessage,{defaultMessage:"Change",id:"grantPageAccessActivityAction.changePermissionButton.label",description:"Change permission button for page access requests in notification."})),this.renderArchiveButton())}return n.createElement(n.Fragment,null,r()(ze.Z,{upgradeButtonName:"user_permission_item",role:this.getRole(),table:A.iU,blockType:this.props.targetBlockStore.getType(),type:e.for_actor_table===B.KJ?"user_permission":"bot_permission",onChange:this.handleRoleChange,isInvite:!0,buttonStyle:this.getButtonStyle(!1)}),r()(De.Z,{onClick:this.handleGrantPageAccess,style:this.getButtonStyle(!1)},void 0,r()(V.FormattedMessage,{defaultMessage:"Grant access",id:"grantPageAccessActivityAction.grantAccessButton.label",description:"Button in notification to grant access to a page access request."})),this.renderArchiveButton())}renderGrantedAccessRequest(e){const t=this.renderActor(e.granted_by_table,e.granted_by_id),i=(0,Je.Z)(Math.min(e.granted_time,Date.now())).calendar();return n.createElement(n.Fragment,null,r()(Ne.Z,{isSecondaryColor:!0},void 0,r()(V.FormattedMessage,{defaultMessage:"Approved by {grantedBy}",id:"grantPageAccessActivityAction.accessGranted.title",description:"Approval message for page access requests in notification.",values:{grantedBy:t,time:i}})),r()(Ne.Z,{isSmall:!0,isSecondaryColor:!0},void 0,i))}renderArchiveButton(){const{notification:e}=this.props;if(e&&!e.visited)return r()(De.Z,{onClick:this.handleArchive,style:{height:26,paddingLeft:8,paddingRight:8}},void 0,r()(V.FormattedMessage,{defaultMessage:"Ignore",id:"grantPageAccessActivityAction.ignoreButton.label",description:"Ignore page access request button in notification."}))}getRole(){const e=this.getCurrentPermissionItem(),t=e&&e.role;return this.stores.role.state||t||this.props.initialRole}getNewPermissionItem(){const e=this.props.accessRequestStore.getValue();if(e)return e.for_actor_table===B.KJ?{type:"user_permission",user_id:e.for_actor_id,role:this.getRole()}:{type:"bot_permission",bot_id:e.for_actor_id,role:this.getRole()}}getInviteTargetWithNewPermissionItem(){const e=this.getNewPermissionItem();if(!e)return{};if(this.getCurrentPermissionItem())return{permissionItem:e};const{data:t}=We.default.state;if("user_permission"===e.type){const i=this.rootStore.getRecordValue({table:B.KJ,id:e.user_id}),o=t?Ke.CM(t):[],r=o&&o.some((t=>t.userId===e.user_id));return i&&!r?{type:"existingUser",value:i,permissionItem:e}:{permissionItem:e}}if("bot_permission"===e.type){const i=this.rootStore.getRecordValue({table:y.cZ,id:e.bot_id}),o=(t?Ke.NM(t):[]).some((t=>t.botId===e.bot_id));return i&&!o?{type:"bot",value:i,permissionItem:e}:{permissionItem:e}}(0,D.t1)(e)}getCurrentPermissionItem(){const e=this.props.accessRequestStore.getValue();if(!e)return;const t=this.props.targetBlockStore.getPermissionItems();for(const i of t){if(e.for_actor_table===B.KJ&&(0,Ee.jg)(i)&&i.user_id===e.for_actor_id)return i;if(e.for_actor_table===y.cZ&&(0,Ee.FB)(i)&&i.bot_id===e.for_actor_id)return i}}canGrantAccess(){return this.props.targetBlockStore.canAdmin()}renderActor(e,t){return Ce(a().compact([this.getActor(e,t)]))}getActor(e,t){if(e===B.KJ){const i=this.rootStore.getRecordValue({table:e,id:t});if(i)return(0,l.dp)(i)}if(e===y.cZ){const i=this.rootStore.getRecordValue({table:e,id:t});if(i)return(0,l.D$)(i)}}get rootStore(){return this.props.accessRequestStore}getButtonStyle(e){const t={height:26,paddingLeft:8,paddingRight:8,boxShadow:this.theme.plainButtonBoxShadow,fontSize:12,marginRight:10};return e?t:{...t,color:this.theme.regularTextColor,fontWeight:500}}}const $e=He;class je extends d.Z{constructor(){super(...arguments),this.storeTypes={open:ne.default.of(!1)},this.handleOpen=()=>{this.stores.open.set(!0)}}renderComponent(){return this.stores.open.get()||this.props.items.length<=this.props.visible?r()("div",{},void 0,this.props.items):r()("div",{},void 0,this.props.items.slice(0,this.props.visible),r()(de.Z,{onClick:this.handleOpen,style:this.getStyle()},void 0,r()(V.FormattedMessage,{defaultMessage:"View {moreCount} more",id:"activity.viewMoreButton.label",values:{moreCount:this.props.items.length-this.props.visible}})))}getStyle(){return{display:"flex",alignItems:"center",height:28,fontSize:12,color:this.theme.lightTextColor,padding:0,paddingLeft:52,paddingRight:16}}}const Xe=je,Ye=r()("div",{style:{width:5,display:"inline-block"}});class Qe extends d.Z{constructor(e){super(e),this.renderBlockEdit=(e,t,i)=>{let o=this.getRecordValue({table:A.iU,id:e.block_id});o&&o.type===u.ZP.tableRow&&(o=this.getRecordValue({table:A.iU,id:o.parent_id}));const s=o?(0,c.Om)({table:"block",value:o,getRecordValue:this.getRecordValue}):f._j.root;return"block-deleted"===e.type?e.block_data.block_value.type===u.ZP.page?r()(Fe.Z,{href:s,onClick:()=>this.track("block_edit"),innerStyle:Qe.editButtonStyle},t,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore})):r()("div",{style:Qe.editButtonStyle},t,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore})):r()(Fe.Z,{href:s,onClick:()=>this.track("block_edit"),innerStyle:Qe.editButtonStyle},t,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore}))},this.renderCollectionPropertyEdit=(e,t)=>{if("collection-property-changed"===e.type)return r()(Fe.Z,{href:t,innerStyle:Qe.editButtonStyle},void 0,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore}))},this.handleUnfollow=()=>this.handleFollowChanged(!1),this.handleFollow=()=>this.handleFollowChanged(!0),this.handleUnarchive=()=>{const{notification:e,rootStore:t}=this.props;e&&(E.createAndCommit({userAction:"Activity.handleUnarchive",environment:this.environment,perform:i=>{F.E1({notificationId:e.id,visited:!1,rootStore:t,transaction:i})}}),(0,Z.F5)(this.getBaseNotificationArgs()))},this.getUserValue=e=>Y.U6.createChildStore(this.props.rootStore,{table:B.KJ,id:e}).getValue(),this.getBotValue=e=>(0,Y.Kv)(this.props.rootStore,{table:y.cZ,id:e}).getValue(),this.getAuthorActor=e=>{if(e.table===B.KJ){const t=this.getUserValue(e.id);if(t)return(0,l.dp)(t)}else{const t=this.getBotValue(e.id);if(t)return(0,l.D$)(t)}},this.getSpaceValue=e=>Y.H2.createChildStore(this.props.rootStore,{table:w.bx,id:e}).getValue(),this.getTeamValue=e=>Y.zX.createChildStore(this.props.rootStore,{table:M.e0,id:e}).getValue(),this.getDiscussionLocation=e=>{let{forReplyMenu:t}=e;const{source:i}=this.props;if("updates_sidebar"===i)return t?"reply_menu_updates_sidebar":"updates_sidebar";return`${t?"reply_menu_":"updates_menu_"}${(0,Z.Jn)()}`},this.getDiscussionContextAndId=()=>{const{activity:e}=this.props;if("commented"!==e.type)return;const t=this.getRecordValue({table:T.qF,id:e.discussion_id,spaceId:e.space_id});if(!t)return;if(!t.context)return;const i=(0,I.VP)(t.context,(e=>!(0,I.xw)(e)||(0,I.h1)(e)===t.id));return{id:t.id,context:i}},this.getDiscussionContext=()=>{const e=this.getDiscussionContextAndId();if(e)return e.context},this.handleTrackBacklinkClick=this.handleTrackBacklinkClick.bind(this),this.handleTrackArchiveClicked=this.handleTrackArchiveClicked.bind(this)}willMountOrUpdate(){this.warmCommentData(),this.environment.KatexStore.loadIfNeeded(this.getDiscussionContext)}warmCommentData(){if("commented"===this.props.activity.type){const e=(0,Y.Kv)(this.props.rootStore,{table:T.qF,id:this.props.activity.discussion_id,spaceId:this.props.activity.space_id}).getValue();if(e){const t=e.comments||[];for(const e of t){const t=(0,Y.Kv)(this.props.rootStore,{table:_.x_,id:e,spaceId:this.props.activity.space_id}).getValue();if(t&&t.created_by_table&&t.created_by_id){(0,Y.Kv)(this.props.rootStore,{table:t.created_by_table,id:t.created_by_id}).getValue()}}}}}renderComponent(){const{activity:e}=this.props;switch(e.type){case"block-edited":return this.renderBlockEditActivity(e);case"collection-row-created":case"collection-row-deleted":return this.renderCollectionRowActivity(e);case"top-level-block-created":case"top-level-block-deleted":return this.renderTopLevelBlockActivity(e);case"permissions-edited":return this.renderPermissionsActivity(e);case"permission-group-edited":return this.renderPermissionGroupActivity(e);case"user-mentioned":return this.renderMentionActivity(e);case"commented":return this.renderCommentActivity(e);case"user-invited":return this.renderUserInvitedActivity(e);case"collection-edited":return this.renderCollectionEdited(e);case"collection-view-edited":return this.renderCollectionViewEdited(e);case"collection-property-edited":return this.renderCollectionPropertyEdited(e);case"reminder":return this.renderReminderActivity(e);case"page-locked":case"page-unlocked":return this.renderPageLockActivity(e);case"email-edited":return this.renderEmailEdited(e);case"access-requested":return this.renderAccessRequested(e);case"page-deleted":case"page-restored":case"page-permanently-deleted":return this.renderPageDeleteOrRestoreActivity(e);case"team-membership-edited":return this.renderTeamMembershipEditedActivity(e);case"private-content-transferred":return this.renderPrivateContentTransferredActivity(e);default:(0,D.t1)(e)}}renderBlockEditActivity(e){if(!e.edits)return;const t=(0,R.hI)(e.edits).filter((e=>{const{block_value:t}="block-changed"===e.type?e.block_data.after:e.block_data;return t.parent_table!==_.x_}));if(0===t.length)return;const i=this.getBlockValue(t[0].navigable_block_id);if(!i)return;const o=this.getAuthors(t),s=Ce(o),a=this.renderTitle("block",i);return r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited {pageTitle}} other {{authorOrAuthors} edited {pageTitle}}}",id:"activity.blockEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)",values:{numberOfAuthors:o.length,authorOrAuthors:s,pageTitle:a}})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:r()(Te,{authors:o}),showSnapshotButton:this.props.isTopbarUpdatesMenu,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,r()(Xe,{visible:5,items:t.map(this.renderBlockEdit)}),this.renderNotificationActions())}renderCollectionRowActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockValue(e.collection_row_id);if(!i)return;if(!i.properties)return;const o=this.getAuthors(e.edits),s=Ce(o),a=this.renderTitle("block",i),n="collection-row-created"===t.type?r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created {pageTitle}} other {{authorOrAuthors} created {pageTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,pageTitle:a},id:"activity.collectionRowCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted {pageTitle}} other {{authorOrAuthors} deleted {pageTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,pageTitle:a},id:"activity.collectionRowDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,n),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:r()(Te,{authors:o}),showSnapshotButton:this.props.isTopbarUpdatesMenu,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,this.renderNotificationActions())}renderTopLevelBlockActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockStore(e.top_level_block_id),o=i.getValue();if(!o)return;const s=i.hasSpacePermission(),a=this.getAuthors(e.edits),n=Ce(a),d=this.renderTitle("block",o);let h;return h=s?"top-level-block-created"===t.type?r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created workspace page {pageTitle}} other {{authorOrAuthors} created workspace page {pageTitle}}}",values:{numberOfAuthors:a.length,authorOrAuthors:n,pageTitle:d},id:"activity.topLevelBlockWorkspaceCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted workspace page {pageTitle}} other {{authorOrAuthors} deleted workspace page {pageTitle}}}",values:{numberOfAuthors:a.length,authorOrAuthors:n,pageTitle:d},id:"activity.topLevelBlockWorkspaceDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"top-level-block-created"===t.type?r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created private page {pageTitle}} other {{authorOrAuthors} created private page {pageTitle}}}",values:{numberOfAuthors:a.length,authorOrAuthors:n,pageTitle:d},id:"activity.topLevelBlockPrivateCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted private page {pageTitle}} other {{authorOrAuthors} deleted private page {pageTitle}}}",values:{numberOfAuthors:a.length,authorOrAuthors:n,pageTitle:d},id:"activity.topLevelBlockPrivateDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,h),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(o.id,"block"),rootStore:this.props.rootStore,notification:this.props.notification,icon:r()(Te,{authors:a}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked})}renderPermissionsActivity(e){if(!e.edits)return;const t=(0,R.hI)(e.edits);if(0===t.length)return;let i,o;const s=t[0];if(s.navigable_block_id){const e=this.getBlockValue(s.navigable_block_id);if(!e)return;o=this.renderTitle("block",e),i=this.getIsRecordPrivateToUser(e.id,"block")}else{const e=this.getSpaceValue(s.space_id);if(!e)return;o=this.renderTitle("space",e),i=this.getIsRecordPrivateToUser(s.space_id,"space")}const{autojoinEdits:a,inheritanceEdits:n,otherEdits:d}=h.md(e.edits),l=[];a.forEach(((e,t)=>{const s=this.getAuthors([e]),a=Ce(s);l.push(r()(we,{timestamp:e.timestamp,header:r()("span",{},void 0,r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} joined {pageOrSpaceName}} other {{authorOrAuthors} joined {pageOrSpaceName}}}",values:{numberOfAuthors:s.length,authorOrAuthors:a,pageOrSpaceName:o},id:"activity.permissionsActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:i,rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:r()(Te,{authors:s}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},`autojoin-${t}`))})),n.forEach(((t,s)=>{const a=this.getAuthors([t]),n=Ce(a);let d;"permission-restriction-created"===t.type?d=r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} restricted access for {pageOrSpaceName}} other {{authorOrAuthors} restricted access for {pageOrSpaceName}}}{inSudoMode, select, true { using administrator privileges} other {}}",values:{numberOfAuthors:a.length,authorOrAuthors:n,pageOrSpaceName:o,inSudoMode:t.inSudoMode},id:"activity.restrictPermissionsForActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"permission-restriction-deleted"===t.type&&(d=r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} restored inherited access for {pageOrSpaceName}} other {{authorOrAuthors} restored inherited access for {pageOrSpaceName}}}{inSudoMode, select, true { using administrator privileges} other {}}",values:{numberOfAuthors:a.length,authorOrAuthors:n,pageOrSpaceName:o,inSudoMode:t.inSudoMode},id:"activity.restorePermissionsForActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),l.push(r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,d),isLast:this.props.isLast,isPrivate:i,rootStore:this.props.rootStore,navigableBlockId:t.navigable_block_id,notification:this.props.notification,icon:r()(Te,{authors:a}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},`inheritance-${s}`,r()("div",{style:Qe.editButtonStyle},void 0,r()(Ue.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions()))}));const c=(t,o,a)=>{if(t.length>0){const n=this.getAuthors(t);l.push(r()(we,{timestamp:parseInt(e.end_time),header:a,isLast:this.props.isLast,isPrivate:i,rootStore:this.props.rootStore,navigableBlockId:s.navigable_block_id,notification:this.props.notification,icon:r()(Te,{authors:n}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},o,t.map(((e,t,i)=>r()("div",{style:Qe.editButtonStyle},t,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore},t)))),this.renderNotificationActions()))}},u=d.filter((e=>!e.inSudoMode));if(u.length>0){const e=this.getAuthors(u),t=Ce(e);c(u,"other",r()("span",{},void 0,r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} updated permission for {pageOrSpaceName}} other {{authorOrAuthors} updated permission for {pageOrSpaceName}}}",values:{numberOfAuthors:e.length,authorOrAuthors:t,pageOrSpaceName:o},id:"activity.updatedPermissionsForActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})))}const p=d.filter((e=>e.inSudoMode));if(p.length>0){const e=this.getAuthors(p),t=Ce(e);c(p,"other-sudo",r()("span",{},void 0,r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} updated permission for {pageOrSpaceName}} other {{authorOrAuthors} updated permission for {pageOrSpaceName}}} using administrator privileges",values:{numberOfAuthors:e.length,authorOrAuthors:t,pageOrSpaceName:o},id:"activity.updatedPermissionsForActivityInSudoMode.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})))}return l}renderPermissionGroupActivity(e){if(!e.edits)return;const t=(0,R.hI)(e.edits)[0];if(!t)return;const i=this.getSpaceValue(t.space_id);if(!i)return;const o=(0,c.Om)({table:"space",value:i,getRecordValue:this.getRecordValue}),s=this.renderPermissionGroupTitle((0,g.c_)({activity:e,getRecordValue:this.getRecordValue}),e.space_id),a=this.getAuthors(e.edits);return r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,this.renderPermissionGroupEditedHeader({activity:e,authors:a,groupName:s})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.space_id,"space"),rootStore:this.props.rootStore,notification:this.props.notification,icon:r()(Te,{authors:a}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,r()(Fe.Z,{href:o,onClick:()=>this.track("group_edit"),innerStyle:Qe.editButtonStyle},void 0,r()(Ue.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions())}renderMentionActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockValue(t.navigable_block_id);if(!i)return;const o=this.getBlockValue(e.mentioned_block_id);if(!o)return;const s=(0,c.Om)({table:"block",value:o,getRecordValue:this.getRecordValue}),a=this.getAuthors(e.edits),n=Ce(a);return r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} mentioned you in {pageName}} other {{authorOrAuthors} mentioned you in {pageName}}}",values:{numberOfAuthors:a.length,authorOrAuthors:n,pageName:this.renderTitle("block",i)},id:"activity.mentionActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:r()(Te,{authors:a}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,r()(Fe.Z,{href:s,onClick:()=>this.track("mention_edit"),innerStyle:Qe.editButtonStyle},void 0,r()(Ue.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions())}renderCommentActivity(e){if(!e.edits)return;let t=e.edits.filter((e=>{switch(e.type){case"comment-changed":return!(0,$.qe)();case"comment-created":case"comment-deleted":return!0;default:(0,D.t1)(e)}}));if(0===t.length&&0!==e.edits.length&&"updates_sidebar"!==this.props.source&&(t=e.edits),0===t.length)return;const i=(0,Y.Kv)(this.props.rootStore,{table:T.qF,id:e.discussion_id,spaceId:e.space_id}),o=i.getValue();if(!o)return;const s=Y.G.createChildStore(this.props.rootStore,{table:A.iU,id:o.parent_id}),a=(0,j.qA)(s),n=(0,j.Zg)(a),d=s.getValue();if(!d)return;const h=this.getBlockValue(e.navigable_block_id);if(!h)return;const l=n?(0,c.Om)({table:"block",value:d,getRecordValue:this.getRecordValue,discussionId:e.discussion_id}):void 0,u=this.getAuthors(t),p=Ce(u),m=e=>{if(this.track("comment_edit"),!n){const t=e.target;(0,q.oK)({environment:this.environment,discussionStore:i,rect:t.getBoundingClientRect(),blockStore:s,discussionLocation:this.getDiscussionLocation({forReplyMenu:!0})})}};return r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} commented in {blockName}} other {{authorOrAuthors} commented in {blockName}}}",values:{numberOfAuthors:u.length,authorOrAuthors:p,blockName:this.renderTitle("block",h)},id:"activity.commentActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.navigable_block_id,"block"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:r()(Te,{authors:u}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,this.renderCommentContext({activity:e,url:l,onClick:m}),r()(Xe,{visible:5,items:t.map(((e,t,i)=>r()(Fe.Z,{onClick:m,href:l,innerStyle:Qe.editButtonStyle},t,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore,type:"comment-edit",discussionLocation:this.getDiscussionLocation({forReplyMenu:!1})}))))}),this.renderCommentActions(e,n))}renderCommentContext(e){const{url:t,onClick:i}=e,o=this.getDiscussionContextAndId();if(!o)return;const{id:s,context:a}=o,n=0===(0,I.ll)(a).length,d=(0,K.IY)({environment:this.environment,textValue:{value:a,spaceId:this.props.activity.space_id},parentStore:this.props.rootStore,disableHover:!0,disableStyleAnnotations:!1,disableDateStyleAnnotations:!1,disabled:!0,highlightDiscussionId:s,theme:this.theme,emojiType:(0,z.e)(this.environment),katex:this.environment.KatexStore.getKatex(),enableEndOfLineMarker:!1,formulaValueTypes:[]});return r()(Fe.Z,{href:t,onClick:i,innerStyle:{...Qe.editButtonStyle,display:"flex",alignItems:"flex-start",fontSize:14,...n&&{color:this.theme.mediumTextColor},paddingTop:2,paddingBottom:6,marginBottom:0}},void 0,n&&r()("div",{style:{flexShrink:0,alignSelf:"center",width:3,borderRadius:3,marginLeft:2,marginRight:8,height:20,background:p.DB}}),r()("div",{style:{...N.Z.textOverflowStyle}},void 0,d))}renderCommentActions(e,t){const i=this.getRecordValue({table:T.qF,id:e.discussion_id,spaceId:e.space_id});if(!i)return;const o=(0,Y.Kv)(this.props.rootStore,{table:T.qF,id:i.id,spaceId:(0,v.CG)(this.props.rootStore.pointer.spaceId)}),s=Y.G.createChildStore(this.props.rootStore,{table:A.iU,id:i.parent_id});return r()("div",{style:{paddingLeft:52,paddingTop:12,paddingBottom:4}},void 0,r()(De.Z,{onClick:e=>{const t=e.target;(0,q.oK)({environment:this.environment,discussionStore:o,rect:t.getBoundingClientRect(),blockStore:s,discussionLocation:this.getDiscussionLocation({forReplyMenu:!0})})},style:this.getActionButtonStyle()},void 0,r()(V.FormattedMessage,{defaultMessage:"Reply",id:"activity.replyButton.label"})),this.canUnarchive()&&r()(n.Fragment,{},void 0,Ye,r()(De.Z,{onClick:this.handleUnarchive,style:this.getActionSecondaryButtonStyle()},void 0,r()(V.FormattedMessage,{defaultMessage:"Unarchive",id:"activity.unarchiveButton.label"}))))}renderAccessRequestedActions(e){const{rootStore:t}=this.props;if(!(e.edits||[])[0])return;const i=(0,Y.Kv)(t,{table:b.J8,id:e.access_request_id}),o=i.getValue();if(o)switch(o.parent_table){case A.iU:const e=Y.G.createChildStore(t,{table:o.parent_table,id:o.parent_id});if(!e.canAdmin())return;return r()("div",{style:Qe.actionPrimaryContainerStyle},void 0,r()($e,{accessRequestStore:i,targetBlockStore:e,initialRole:"reader",buttonStyle:this.getActionButtonStyle(),notification:this.props.notification}));case w.bx:const s=Y.H2.createChildStore(t,{table:o.parent_table,id:o.parent_id});return r()("div",{style:Qe.actionPrimaryContainerStyle},void 0,r()(Ve,{accessRequestStore:i,spaceStore:s,initialRole:"reader",buttonStyle:this.getActionButtonStyle(),notification:this.props.notification}));default:(0,D.t1)(o)}}renderNotificationActions(){if(this.canUnarchive())return r()("div",{style:Qe.actionContainerStyle},void 0,r()(De.Z,{onClick:this.handleUnarchive,style:this.getActionSecondaryButtonStyle()},void 0,r()(V.FormattedMessage,{defaultMessage:"Unarchive",id:"activity.actions.unarchiveButton.label"})));const e=this.getFollowStore();if(!e)return;const t=e.getValue();return t?t.following?r()("div",{style:Qe.actionPrimaryContainerStyle},void 0,r()(De.Z,{onClick:this.handleUnfollow,style:this.getActionButtonStyle()},void 0,r()(V.FormattedMessage,{defaultMessage:"Unfollow this page",id:"activity.unfollowPageButton.label"}))):r()("div",{style:Qe.actionPrimaryContainerStyle},void 0,r()(De.Z,{onClick:this.handleFollow,style:this.getActionButtonStyle()},void 0,r()(V.FormattedMessage,{defaultMessage:"Re-follow this page",id:"activity.refollowPageButton.label"}))):void 0}renderUserInvitedActivity(e){if(!e.edits)return;let t,i,o;const s=this.getAuthors(e.edits),a=Ce(s),n=0===s.filter(l.uC).length,d=parseInt(e.end_time),h=e.edits[0];if(h.navigable_block_id){const l=this.getBlockValue(h.navigable_block_id);if(!l)return;const u=this.renderTitle("block",l),p=(0,J.$e)(l,e);if(p){const t=this.getRecordValue({table:C.Tu,id:p,spaceId:e.space_id});t&&t.message&&t.created_time<=d+5*P.hM&&(o={message:null==t?void 0:t.message,url:(0,c.Om)({table:A.iU,value:l,getRecordValue:this.getRecordValue})})}i=r()(V.FormattedMessage,n?{defaultMessage:"You have been invited to {blockName}",values:{blockName:u},id:"activity.userInvitedActivityNavigableBlockByBot.header"}:{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} invited you to {blockName}} other {{authorOrAuthors} invited you to {blockName}}}",values:{numberOfAuthors:s.length,authorOrAuthors:a,blockName:u},id:"activity.userInvitedActivityNavigableBlock.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),t=this.getIsRecordPrivateToUser(l.id,"block")}else if(h.permission_group_id){const e=(0,g.Bg)({spaceId:h.space_id,permissionGroupId:h.permission_group_id,getRecordValue:this.getRecordValue}),o=this.renderPermissionGroupTitle(e,h.space_id);i=r()(V.FormattedMessage,n?{defaultMessage:"You have been added to group {groupName}",values:{groupName:o},id:"activity.userInvitedActivityGroupIdByBot.header"}:{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} added you to group {groupName}} other {{authorOrAuthors} added you to group {groupName}}}",values:{numberOfAuthors:s.length,authorOrAuthors:a,groupName:o},id:"activity.userInvitedActivityGroupId.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),t=this.getIsRecordPrivateToUser(h.space_id,"space")}else{const e=this.getSpaceValue(h.space_id);if(!e)return;const o=this.renderTitle("space",e);i=r()(V.FormattedMessage,n?{defaultMessage:"You have been invited to {spaceName}",values:{spaceName:o},id:"activity.userInvitedActivityOtherInviteByBot.header"}:{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} invited you to {spaceName}} other {{authorOrAuthors} invited you to {spaceName}}}",values:{numberOfAuthors:s.length,authorOrAuthors:a,spaceName:o},id:"activity.userInvitedActivityOtherInvite.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),t=this.getIsRecordPrivateToUser(h.space_id,"space")}const u=n?void 0:r()(Te,{authors:s});return r()(we,{timestamp:d,header:r()("span",{},void 0,i),isLast:this.props.isLast,isPrivate:t,rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:u,showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,o&&r()(Fe.Z,{href:o.url,onClick:()=>this.track("click_user_invited"),innerStyle:this.getInviteMessageStyle()},void 0,o.message))}renderTeamMembershipEditedActivity(e){if(!e.edits)return;const t=this.getAuthors(e.edits),i=Ce(t),o=e.edits[0],s=this.getTeamValue(o.team_id);if(!s)return;const a=this.renderTeamTitle("team",s),n=r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} invited you to teamspace {teamName}} other {{authorOrAuthors} invited you to {teamName}}}",values:{numberOfAuthors:t.length,authorOrAuthors:i,teamName:a},id:"activity.userInvitedToTeamActivity.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,n),isLast:this.props.isLast,isPrivate:!1,rootStore:this.props.rootStore,notification:this.props.notification,icon:r()(Te,{authors:t}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked})}renderPrivateContentTransferredActivity(e){if(!e.edits)return;const t=e.edits[0],i=t.from_user_id,o=this.getRecordValue({table:B.KJ,id:i});if(!o)return;const s=t.to_user_id;if(!this.getRecordValue({table:B.KJ,id:s}))return;const a=this.getBlockValue(e.navigable_block_id);if(!a)return;const n=(0,l.$4)(H.default.getIntl(),{table:B.KJ,value:o}),d=this.getAuthors(e.edits),h=Ce(d),c=r()(V.FormattedMessage,{defaultMessage:"{authorPhrase} transferred private content from {fromUserName} to you: {pageName}",values:{authorPhrase:h,fromUserName:n,pageName:this.renderTitle("block",a)},id:"activity.privateContentTransferred.header",description:"Notification header for when private content is transferred from one user to another."});return r()(we,{timestamp:parseInt(e.end_time),header:c,isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(a.id,"block"),rootStore:this.props.rootStore,notification:this.props.notification,icon:r()(Te,{authors:d}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked})}renderCollectionEdited(e){if(!e.edits)return;const t=this.getRecordValue({table:S.v,id:e.collection_id,spaceId:e.space_id});if(!t)return;const i=e.edits[0];if(!i)return;const o=(0,c.Om)({table:S.v,value:t,getRecordValue:this.getRecordValue}),s=this.getAuthors(e.edits),a=Ce(s),n=this.renderTitle("collection",t),d="collection-created"===i.type?r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created {collectionTitle}} other {{authorOrAuthors} created {collectionTitle}}}",values:{numberOfAuthors:s.length,authorOrAuthors:a,collectionTitle:n},id:"activity.collectionCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited {collectionTitle}} other {{authorOrAuthors} edited {collectionTitle}}}",values:{numberOfAuthors:s.length,authorOrAuthors:a,collectionTitle:n},id:"activity.collectionEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,d),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.collection_id,"collection"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:r()(Te,{authors:s}),showSnapshotButton:this.props.isTopbarUpdatesMenu,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,h.OC(i)&&this.renderCollectionDescriptionEdit(i,o),this.renderNotificationActions())}renderCollectionDescriptionEdit(e,t){return r()(Fe.Z,{href:t,innerStyle:Qe.editButtonStyle},void 0,r()(Ue.Z,{edit:e,rootStore:this.props.rootStore}))}renderCollectionViewEdited(e){if(!e.edits)return;const t=this.getRecordValue({table:S.v,id:e.collection_id,spaceId:e.space_id});if(!t)return;const i=this.getRecordValue({table:k.n,id:e.collection_view_id,spaceId:e.space_id});if(!i)return;const o=(0,R.hI)(e.edits)[0];if(!o)return;const s=this.renderCollectionViewTitle(i),a=this.renderTitle("collection",t),n=this.getAuthors(e.edits),d=Ce(n);let h;return h="collection-view-created"===o.type?r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created view {collectionViewTitle} in {collectionTitle}} other {{authorOrAuthors} created view {collectionViewTitle} in {collectionTitle}}}",values:{numberOfAuthors:n.length,authorOrAuthors:d,collectionTitle:a,collectionViewTitle:s},id:"activity.collectionViewCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"collection-view-deleted"===o.type?r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted view {collectionViewTitle} in {collectionTitle}} other {{authorOrAuthors} deleted view {collectionViewTitle} in {collectionTitle}}}",values:{numberOfAuthors:n.length,authorOrAuthors:d,collectionTitle:a,collectionViewTitle:s},id:"activity.collectionViewDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited view {collectionViewTitle} in {collectionTitle}} other {{authorOrAuthors} edited view {collectionViewTitle} in {collectionTitle}}}",values:{numberOfAuthors:n.length,authorOrAuthors:d,collectionTitle:a,collectionViewTitle:s},id:"activity.collectionViewEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,h),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.collection_id,"collection"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:r()(Te,{authors:n}),showSnapshotButton:this.props.isTopbarUpdatesMenu,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,this.renderNotificationActions())}renderCollectionPropertyEdited(e){if(!e.edits)return;const t=(0,R.hI)(e.edits),i=t[0];if(!i)return;const o=this.getRecordValue({table:S.v,id:e.collection_id,spaceId:e.space_id});if(!o)return;const s=(0,c.Om)({table:S.v,value:o,getRecordValue:this.getRecordValue}),a="collection-property-changed"===i.type?i.collection_property_data.after:i.collection_property_data,n=this.getAuthors(e.edits),d=Ce(n),h=this.renderTitle("collection",o),l=this.renderCollectionPropertyTitle(a);let u;return u="collection-property-created"===i.type?r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created property {collectionPropertyTitle} in {collectionTitle}} other {{authorOrAuthors} created property {collectionPropertyTitle} in {collectionTitle}}}",values:{numberOfAuthors:n.length,authorOrAuthors:d,collectionTitle:h,collectionPropertyTitle:l},id:"activity.collectionPropertyCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"collection-property-deleted"===i.type?r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted property {collectionPropertyTitle} in {collectionTitle}} other {{authorOrAuthors} deleted property {collectionPropertyTitle} in {collectionTitle}}}",values:{numberOfAuthors:n.length,authorOrAuthors:d,collectionTitle:h,collectionPropertyTitle:l},id:"activity.collectionPropertyDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited property {collectionPropertyTitle} in {collectionTitle}} other {{authorOrAuthors} edited property {collectionPropertyTitle} in {collectionTitle}}}",values:{numberOfAuthors:n.length,authorOrAuthors:d,collectionTitle:h,collectionPropertyTitle:l},id:"activity.collectionPropertyEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}),r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,u),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(e.collection_id,"collection"),rootStore:this.props.rootStore,navigableBlockId:e.navigable_block_id,notification:this.props.notification,icon:r()(Te,{authors:n}),showSnapshotButton:this.props.isTopbarUpdatesMenu,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,r()(Xe,{visible:5,items:t.map((e=>this.renderCollectionPropertyEdit(e,s)))}),this.renderNotificationActions())}renderReminderActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockValue(t.navigable_block_id);if(!i)return;const o=this.getBlockValue(e.reminder_block_id);if(!o)return;const s=(0,c.Om)({table:"block",value:o,getRecordValue:this.getRecordValue});return r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,r()(V.FormattedMessage,{defaultMessage:"Reminder in {pageTitle}",id:"activity.reminderInActivity.header",values:{pageTitle:this.renderTitle("block",i)}})),isLast:this.props.isLast,isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:r()(Oe,{}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,r()(Fe.Z,{href:s,onClick:()=>this.track("reminder_edit"),innerStyle:Qe.editButtonStyle},void 0,r()(Ue.Z,{edit:t,rootStore:this.props.rootStore})),this.renderNotificationActions())}renderPageLockActivity(e){if(!e.edits)return;const t=e.edits[0],i=this.getBlockValue(t.navigable_block_id);if(!i)return;const o=this.getAuthors(e.edits),s=Ce(o),a=this.renderTitle("block",i),n="page-locked"===e.type?r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} locked {blockTitle}} other {{authorOrAuthors} locked {blockTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,blockTitle:a},id:"activity.pageLocked.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} unlocked {blockTitle}} other {{authorOrAuthors} unlocked {blockTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,blockTitle:a},id:"activity.pageUnlocked.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"});return r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,n),isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),isLast:this.props.isLast,rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:r()(Te,{authors:o}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,this.renderNotificationActions())}renderEmailEdited(e){if(!e.edits)return;const t=e.edits[0];if(!t)return;const i=this.getAuthors(e.edits),o=Ce(i);return r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} changed email from {oldEmail} to {newEmail}} other {{authorOrAuthors} changed email from {oldEmail} to {newEmail}}}",values:{numberOfAuthors:i.length,authorOrAuthors:o,oldEmail:t.old_email,newEmail:t.new_email},id:"activity.emailEdited.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})),isLast:this.props.isLast,isPrivate:!1,rootStore:this.props.rootStore,notification:this.props.notification,icon:r()(Te,{authors:i}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked})}renderMembershipRequestHeader(e){if(!e.edits)return;const t=this.getRecordValue({table:b.J8,id:e.access_request_id});if(!t||t.for_actor_table!==B.KJ)return;const i=this.getRecordValue({table:t.for_actor_table,id:t.for_actor_id});if(!i)return;if(t.for_actor_id===t.created_by_id){const e=i.name?`${i.name} (${i.email})`:i.email;return r()(V.FormattedMessage,{defaultMessage:"{invitee} requested to become a workspace member",values:{invitee:r()("span",{style:{fontWeight:N.Z.fontWeight.semibold}},void 0,e)},id:"activity.accessRequestedMembershipFromGuest.header",description:"Notification header describing that a user created a membership request for themself."})}const o=this.getAuthors(e.edits),s=Ce(o);return r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} requested {invitee} to become a workspace member} other {{authorOrAuthors} requested {invitee} to become a workspace member}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,invitee:r()("span",{style:{fontWeight:N.Z.fontWeight.semibold}},void 0,i.email)},id:"activity.accessRequestedMembership.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})}renderAccessRequestedHeader(e){if(!e.edits)return;if(!e.navigable_block_id)return;const t=this.getBlockValue(e.navigable_block_id);if(!t)return;const i=this.getAuthors(e.edits),o=Ce(i);return r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} requested access to {pageName}} other {{authorOrAuthors} requested access to {pageName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:o,pageName:this.renderTitle(A.iU,t)},id:"activity.accessRequested.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})}renderAccessRequested(e){if(!e.edits)return;const t=e.edits[0];if(!t)return;const i=this.getRecordValue({table:b.J8,id:e.access_request_id});if(!i)return;if(i.parent_table===w.bx&&!(0,G.p1)(this.environment))return;const o=i.parent_table===w.bx?this.renderMembershipRequestHeader(e):this.renderAccessRequestedHeader(e),{message:s}=t,a=this.getAuthors(e.edits),n=Ce(a);return r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,o),isLast:this.props.isLast,isPrivate:!1,rootStore:this.props.rootStore,notification:this.props.notification,icon:r()(Te,{authors:a}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,s&&r()("div",{style:{paddingLeft:52,paddingRight:16,marginTop:8,marginBottom:8}},void 0,r()(Ne.Z,{isSmall:!0},void 0,r()(V.FormattedMessage,{id:"activity.accessRequested.messageLabel",defaultMessage:"Message from {author}",values:{author:n}})),r()(Ne.Z,{isMultiline:!0,style:{whiteSpace:"pre-wrap"}},void 0,s)),this.renderAccessRequestedActions(e),this.renderNotificationActions())}renderPageDeleteOrRestoreActivity(e){if(!e.edits)return;const t=e.edits[0];if(!t)return;const i=this.getRecordValue({table:A.iU,id:t.navigable_block_id,spaceId:t.space_id});if(!i)return;const o=this.getAuthors(e.edits),s=Ce(o),a=this.renderTitle(A.iU,i);let n;return"page-deleted"===e.type?n=r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted {blockTitle}} other {{authorOrAuthors} deleted {blockTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,blockTitle:a},id:"emailActivity.pageDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"page-restored"===e.type?n=r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} restored {blockTitle}} other {{authorOrAuthors} restored {blockTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,blockTitle:a},id:"emailActivity.pageRestored.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"page-permanently-deleted"===e.type?n=r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} permanently deleted {blockTitle}} other {{authorOrAuthors} permanently deleted {blockTitle}}}",values:{numberOfAuthors:o.length,authorOrAuthors:s,blockTitle:a},id:"emailActivity.pagePermanentlyDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):(0,D.t1)(e),r()(we,{timestamp:parseInt(e.end_time),header:r()("span",{},void 0,n),isPrivate:this.getIsRecordPrivateToUser(i.id,"block"),isLast:this.props.isLast,rootStore:this.props.rootStore,navigableBlockId:i.id,notification:this.props.notification,icon:r()(Te,{authors:o}),showSnapshotButton:!1,onBacklinkClicked:this.handleTrackBacklinkClick,onArchiveClicked:this.handleTrackArchiveClicked},void 0,this.renderNotificationActions())}renderCollectionPropertyTitle(e){return r()("span",{style:{...Qe.boldStyle,whiteSpace:"nowrap"}},void 0,r()(m.ZP,{icon:e.icon,type:e.type,size:12,style:Qe.svgIconStyle,theme:this.theme}),e.name)}renderCollectionViewTitle(e){const t=this.getStore("view",e.id),i=(0,c.WE)({collectionView:e,getRecordValue:this.getRecordValue});return r()(Fe.Z,{href:i,onClick:()=>this.track("click_title"),external:!1,innerStyle:{...Qe.pageLinkStyle,...Qe.boldStyle},inline:!0},void 0,r()(xe.F,{collectionViewStore:t,color:"light",style:{display:"inline-block",verticalAlign:"middle",marginRight:4,marginBottom:2},size:12}),r()(Ze.Z,{collectionViewName:e.name,collectionViewType:e.type}))}renderCollectionViewTypeIcon(e){const t=Qe.svgIconStyle;return W.aW[e](t)}getStore(e,t){return"collection"===e?Y.NW.createChildStore(this.props.rootStore,{table:S.v,id:t}):"view"===e?Y.Xr.createChildStore(this.props.rootStore,{table:k.n,id:t}):"space"===e?Y.H2.createChildStore(this.props.rootStore,{table:w.bx,id:t}):"team"===e?Y.zX.createChildStore(this.props.rootStore,{table:M.e0,id:t}):"block"===e?Y.G.createChildStore(this.props.rootStore,{table:A.iU,id:t}):void(0,D.t1)(e)}renderTitle(e,t){const i=this.getStore(e,t.id),o=(0,c.Al)({table:e,value:t,getRecordValue:this.getRecordValue}),s=(0,c.Om)({table:e,value:t,getRecordValue:this.getRecordValue});return r()(Fe.Z,{href:s,onClick:()=>this.track("click_title"),external:!1,innerStyle:Qe.pageLinkStyle,inline:!0},void 0,o&&n.createElement(n.Fragment,null,r()(Le.Z,{disabled:!0,icon:o,isEmptyPage:!1,size:18,style:Qe.recordIconStyle}),r()("span",{},void 0," ")),r()(qe.Z,{store:i,style:this.getActivityTitleStyle(void 0!==o)}))}renderTeamTitle(e,t){const i=Y.zX.createChildStore(this.props.rootStore,{table:M.e0,id:t.id}),o=(0,c.Al)({table:e,value:t,getRecordValue:this.getRecordValue});return r()(Fe.Z,{onClick:e=>{this.track("click_user_invited_to_team"),(0,U.hI)({environment:this.environment,teamStore:i,shouldScroll:!0}),Q.Z.setState({...Q.Z.state,open:!1}),F.go(this.environment)},external:!1,innerStyle:Qe.pageLinkStyle,inline:!0},void 0,o&&n.createElement(n.Fragment,null,r()(Le.Z,{disabled:!0,icon:o,isEmptyPage:!1,size:18,style:Qe.recordIconStyle}),r()("span",{},void 0," ")),r()(qe.Z,{store:i,style:this.getActivityTitleStyle(void 0!==o)}))}renderPermissionGroupTitle(e,t){let i,o;return e?(i=e.icon,o=e.name||r()(V.FormattedMessage,{defaultMessage:"Untitled group",id:"activity.permissionGroupTitles.untitledGroup"})):o=r()(V.FormattedMessage,{defaultMessage:"Deleted group",id:"activity.permissionGroupTitles.deletedGroup"}),r()("span",{},void 0,i&&r()(Le.Z,{disabled:!0,icon:{icon:i,pointer:{table:"space",id:t}},isEmptyPage:!1,size:18,style:Qe.recordIconStyle}),r()("span",{style:this.getActivityTitleStyle(void 0!==i)},void 0,o))}renderPermissionGroupEditedHeader(e){const{activity:t,authors:i,groupName:o}=e,s=Ce(i),a=(0,R.hI)(t.edits||[])[0];return a?"permission-group-created"===a.type?r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} created group {groupName}} other {{authorOrAuthors} created group {groupName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,groupName:r()("span",{style:Qe.boldStyle},void 0,o)},id:"activity.updatedPermissionGroupCreated.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):"permission-group-deleted"===a.type?r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} deleted group {groupName}} other {{authorOrAuthors} deleted group {groupName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,groupName:r()("span",{style:Qe.boldStyle},void 0,o)},id:"activity.updatedPermissionGroupDeleted.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited group {groupName}} other {{authorOrAuthors} edited group {groupName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,groupName:r()("span",{style:Qe.boldStyle},void 0,o)},id:"activity.updatedPermissionGroupEditedDefault.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"}):r()(V.FormattedMessage,{defaultMessage:"{numberOfAuthors, plural, one {{authorOrAuthors} edited group {groupName}} other {{authorOrAuthors} edited group {groupName}}}",values:{numberOfAuthors:i.length,authorOrAuthors:s,groupName:r()("span",{style:Qe.boldStyle},void 0,o)},id:"activity.updatedPermissionGroupEdit.header",description:"Notification header for updates. The authorOrAuthors variable will be either a name (eg John Doe), two names (eg John Doe and Jane Smith), or more than three (eg John Doe, Jane Smith, and 3 others)"})}canUnarchive(){const{notification:e}=this.props;return!!e&&!!e.visited}getFollowStore(){if("following"!==ee.Z.state.currentTab)return;const{notification:e}=this.props;if(!e)return;let t=e.navigable_block_id;if(!t){if(!e.collection_id)return;const i=(0,Y.Kv)(this.props.rootStore,{table:S.v,id:e.collection_id,spaceId:e.space_id}).getValue();if(!i)return;t=i.parent_id}const i=this.environment.currentUser.id;if(!i)return;const o=(0,O.$j)({user_id:i,navigable_block_id:t});return(0,Y.Kv)(this.props.rootStore,{table:O.t0,id:o,spaceId:e.space_id})}handleFollowChanged(e){this.setFollowing(e),(0,Z.XI)({newFollowState:e,...this.getBaseNotificationArgs()})}setFollowing(e){const t=this.getFollowStore();t&&E.createAndCommit({userAction:"Activity.setFollowing",environment:this.environment,perform:i=>{L.sW({store:t,transaction:i,data:{following:e}})}})}get getRecordValue(){return this.props.rootStore.getRecordValue}getBlockStore(e){return Y.G.createChildStore(this.props.rootStore,{table:A.iU,id:e})}getBlockValue(e){return this.getBlockStore(e).getValue()}getAuthors(e){const t=a().uniqWith(a().flatten(e.map((e=>e.authors||[]))),a().isEqual);return a().compact(t.map(this.getAuthorActor))}handleTrackBacklinkClick(e){(0,Z.EQ)({...this.getBaseNotificationArgs(),backlinkPageId:e})}handleTrackArchiveClicked(){(0,Z._b)(this.getBaseNotificationArgs())}getBaseNotificationArgs(){const{notification:e,analyticsContext:t,activity:i}=this.props;return{environment:this.environment,activity:i,activityContext:t,notificationId:null==e?void 0:e.id}}track(e){var t;(0,Z.pw)({environment:this.environment,target:e}),(0,x.trackActivityAction)(this.environment,this.props.analyticsContext,{target:e,type:h.Fb(this.props.activity),activity_id:this.props.activity.id,notification_id:null===(t=this.props.notification)||void 0===t?void 0:t.id})}getIsRecordPrivateToUser(e,t){const{source:i}=this.props;if("notifications_tab_all"===i){if(!e)return!1;let i;return i="block"===t?Y.G.createChildStore(this.props.rootStore,{table:A.iU,id:e}):"collection"===t?Y.NW.createChildStore(this.props.rootStore,{table:S.v,id:e}):Y.H2.createChildStore(this.props.rootStore,{table:w.bx,id:e}),(0,X.yi)(this.environment,i)}return!1}getActionButtonStyle(){return{boxShadow:this.theme.plainButtonBoxShadow,height:26,paddingLeft:8,paddingRight:8,fontWeight:500,color:this.theme.regularTextColor}}getActionSecondaryButtonStyle(){return{height:26,paddingLeft:8,paddingRight:8,color:this.theme.mediumTextColor}}getInviteMessageStyle(){return{paddingLeft:52,paddingTop:8,paddingBottom:8,paddingRight:12,fontSize:14}}getActivityTitleStyle(e){return{display:"inline",whiteSpace:"normal",marginRight:e?3:0,wordBreak:"break-word",...Qe.boldStyle}}}Qe.actionContainerStyle={paddingLeft:44,paddingTop:4},Qe.actionPrimaryContainerStyle={paddingLeft:52,paddingTop:12,paddingBottom:8},Qe.canSelectStyle={userSelect:"text",WebkitUserSelect:"text"},Qe.boldStyle={fontWeight:N.Z.fontWeight.semibold},Qe.pageLinkStyle={padding:1,...Qe.canSelectStyle},Qe.recordIconStyle={display:"inline-flex",marginRight:2,verticalAlign:"text-top"},Qe.svgIconStyle={width:12,height:12,display:"inline-block",verticalAlign:"middle",marginBottom:2,marginRight:4},Qe.editButtonStyle={padding:0,paddingLeft:52,paddingRight:16,...Qe.canSelectStyle};const et=Qe},98905:(e,t,i)=>{i.d(t,{Z:()=>s});var o=i(49085);class r extends o.Z{getInitialState(){return{count:0}}}const s=new r}}]);